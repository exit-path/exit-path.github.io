{"version":3,"sources":["webpack://@exit-path/game/./node_modules/@babel/runtime/helpers/arrayLikeToArray.js","webpack://@exit-path/game/./node_modules/@babel/runtime/helpers/arrayWithHoles.js","webpack://@exit-path/game/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://@exit-path/game/./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","webpack://@exit-path/game/./node_modules/@babel/runtime/helpers/nonIterableRest.js","webpack://@exit-path/game/./node_modules/@babel/runtime/helpers/slicedToArray.js","webpack://@exit-path/game/./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","webpack://@exit-path/game/./node_modules/@babel/runtime/regenerator/index.js","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/ImageInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/SoundInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/character/styles.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/shapes.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/gradient.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/ShapeInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/MorphShapeInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/SpriteInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/FontInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/StaticTextInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/EditTextInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/AssetLibrary.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/ClassRegistry.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/FontRegistry.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/avm2/AVMObject.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/avm2/Runtime.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/avm2/XML.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/avm2/Class.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/character/EditText.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/character/Sprite.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/text/Container.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/text/layout.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/DisplayObject.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/DisplayObjectContainer.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/Graphics.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/InteractiveObject.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/MorphShape.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/MovieClip.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/Shape.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/Sprite.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/frame.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/Canvas.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/RenderContext.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/signal.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/gl/GLState.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/gl/Renderbuffer.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/gl/Framebuffer.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/RenderPool.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/Atlas.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/CachedRender.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/Renderer.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/programs/render.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/Ticker.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/Stage.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/SimpleButton.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/BitmapData.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/Bitmap.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/display/Loader.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/Event.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/EventDispatcher.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/KeyboardEvent.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/MouseEvent.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/TimerEvent.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/TextEvent.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/ErrorEvent.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/IOErrorEvent.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/SecurityErrorEvent.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/events/FocusEvent.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/filters/BitmapFilter.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/filter/BlurFilter.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/filters/BlurFilter.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/filters/DropShadowFilter.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/geom/ColorTransform.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/geom/Matrix.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/geom/Point.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/geom/Rectangle.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/geom/Transform.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/media/context.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/media/channels.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/media/SoundChannel.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/media/SoundTransform.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/media/Sound.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/media/SoundMixer.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/text/StaticText.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/text/TextFormat.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/text/TextFormatAlign.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/text/TextFieldType.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/text/TextField.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/ui/Keyboard.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/filters/GlowFilter.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/net/URLRequest.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/net/SharedObject.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/net/navigateToURL.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/utils/Timer.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/flash/utils/utils.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/index.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/audio.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/ButtonInstance.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/classes/__internal/character/filter.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/character/frame.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/math/color.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/math/matrix.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/math/rect.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/RenderObject.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/SceneNode.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/filter/DropShadowFilter.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/filter/programs.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/programs/blur.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/programs/shadow.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/gl/Buffer.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/gl/Uniform.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/gl/Program.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/gl/Texture.ts","webpack://@exit-path/game/./node_modules/@kiootic/swf-lib/src/internal/render2/gl/VertexArray.ts","webpack://@exit-path/game/./node_modules/gl-matrix/esm/common.js","webpack://@exit-path/game/./node_modules/gl-matrix/esm/mat2d.js","webpack://@exit-path/game/./node_modules/gl-matrix/esm/vec2.js","webpack://@exit-path/game/./node_modules/gl-matrix/esm/vec4.js","webpack://@exit-path/game/./node_modules/regenerator-runtime/runtime.js"],"names":["module","exports","arr","len","length","i","arr2","Array","isArray","obj","key","value","Object","defineProperty","enumerable","configurable","writable","Symbol","iterator","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","err","TypeError","arrayWithHoles","iterableToArrayLimit","unsupportedIterableToArray","nonIterableRest","arrayLikeToArray","o","minLen","n","prototype","toString","call","slice","constructor","name","from","test","ImageInstance","id","image","SoundInstance","audio","GradientMode","FillStyleKind","makeShapeRenderObject","contour","lib","vertices","Float32Array","map","v","indices","Uint16Array","minX","Infinity","minY","maxX","maxY","x","y","Math","min","max","bounds","rect","texture","color","uvMatrix","mat2d","fill","kind","SolidColor","LinearGradient","RadicalGradient","gradient","mode","points","ratio","join","gradientCache","get","canvas","document","createElement","width","height","ctx","getContext","lg","createLinearGradient","a","r","g","b","addColorStop","fillStyle","fillRect","makeGradientTexture","set","matrix","convertMatrix","ClippedBitmap","resolveImage","characterId","colors","Uint32Array","RenderObject","mat","offset","ShapeInstance","def","this","renderObjects","contours","c","container","__node","setRenderObjects","MorphShapeInstance","frames","Map","shape","frame","__ratio","console","warn","SpriteInstance","sprite","library","numFrames","prevFrameNum","thisFrameNum","effectiveActions","soundActions","setActions","frameNum","find","f","action","actions","ea","depth","child","__children","__depth","values","__soundContext","FontInstance","font","charMap","glyphs","glyph","renderObject","transform","char","layout","ascent","descent","leading","advances","StaticTextInstance","text","instances","resolveFont","fontId","index","size","object","staticText","EditTextInstance","fontHeight","leftMargin","rightMargin","indent","layoutBounds","textField","wordWrap","isWordWrap","multiline","isMultiline","type","isReadonly","TextFieldType","selectable","noSelect","__container","align","defaultTextFormat","TextFormatAlign","textColor","fontID","isHTML","htmlText","initialText","async","fetchData","url","progress","reader","fetch","body","getReader","chunks","received","result","read","Uint8Array","chunk","loadManifest","manifest","progresses","entries","assets","reportProgress","loaded","allLoaded","allSize","l","s","dataAsset","data","bundle","JSON","parse","TextDecoder","decode","AssetLibrary","properties","Promise","all","images","charId","asset","img","resolve","reject","report","Image","onload","onerror","e","onprogress","src","Number","sounds","buf","buffer","shapes","morphShape","morphShapes","instance","sprites","fonts","FontRegistry","staticTexts","editText","editTexts","button","buttons","ButtonInstance","className","linkages","classFn","ClassRegistry","Error","linkedClasses","linkCharacters","link","characters","defaultClassFactory","assign","__character","Sound","Shape","MorphShape","MovieClip","Sprite","StaticText","TextField","SimpleButton","classes","root","addPackage","pack","entryName","isItalic","isBold","classMethods","AVMObject","proto","Reflect","getPrototypeOf","methods","protoMethods","ownKeys","has","desc","getOwnPropertyDescriptor","delete","fn","bind","__preInit","Runtime","args","log","iface","__IMPL","XML","Class","Function","TextAlign","FrameActionKind","htmlParser","DOMParser","Container","node","segments","htmlRoot","parseFromString","documentElement","__text","__htmlText","textContent","parseHTML","innerHTML","walker","ownerDocument","createTreeWalker","NodeFilter","SHOW_ELEMENT","SHOW_TEXT","currentSegment","format","__clone","segmentStack","beginElement","element","tagName","toLowerCase","bold","attributes","attr","parseInt","italic","endElement","pop","nextNode","Text","Element","firstChild","nextSibling","parentNode","filter","wrap","lines","currentLine","resolveGlyph","advance","splitLines","resultBounds","resultObjects","line","lineResult","layoutLine","fontSize","placeholderGlyph","boundsX","boundsWidth","spacing","baseline","tmpVec2","charInit","DisplayObject","initChar","super","init","__clipDepth","__parent","__mask","__maskRefs","__filters","__setNode","visible","oldStage","stage","newStage","__displayListDirty","__onAddedToStage","__onRemovedFromStage","__setEventParent","parent","isMask","mask","markRenderDirty","filters","__filter","isEffective","cacheAsBitmap","transformLocal","markLayoutDirty","atan2","PI","delta","rotation","ensureLayout","abs","boundsLocal","scaleX","sign","scaleY","__globalToLocal","__mousePosition","out","pt","ensure","transformWorldInvert","point","local","__value","shapeFlag","hitTest","boundsWorld","dispatchEvent","DisplayObjectContainer","removeChild","setParent","children","splice","indexOf","beginIndex","endIndex","removedChildren","includes","__onRender","Graphics","__x","__y","__lineThickness","__lineColor","__bounds","__renderObjects","thickness","NaN","alpha","isNaN","floor","InteractiveObject","tabEnabled","tabIndex","__isPointerCursor","___ratio","applyTo","__lastFrame","__constructed","__frameScripts","__scriptFrame","currentFrame","isPlaying","__initFrame","newFrame","totalFrames","__constructionQueue","__runFrameScript","frameScript","frameId","frameNumber","label","__resolveFrame","__constructFrame","graphics","buttonMode","frameScriptQueue","enqueueFrameScript","script","runFrame","isRoot","__ensureDisplayList","__displayList","queue","scripts","Canvas","style","setProperty","window","devicePixelRatio","appendChild","cursor","clientX","clientY","getBoundingClientRect","left","top","colorMulIdentity","vec4","colorAddIdentity","RenderContext","viewport","renders","transformStack","allTransforms","view","colorMul","colorAdd","renderMask","useMask","renderBounds","render","paddings","opts","nodeTransform","baseViewMat","then","cache","dupTransform","viewMatrix","scale","vec2","translate","popTransform","Signal","listeners","handler","disabled","h","GLState","attrs","contextLost","resetRender","maxTextures","textureLimit","maxSamples","sampleLimit","clearColor","bindings","textureUnits","activeTexture","vertexArray","program","capacity","blendEquation","blendFuncs","gl","addEventListener","preventDefault","emit","reset","getParameter","MAX_TEXTURE_IMAGE_UNITS","MAX_SAMPLES","clear","unit","TEXTURE0","bindTexture","TEXTURE_2D","textures","tex","target","bindBuffer","va","bindVertexArray","renderbuffer","bindRenderbuffer","framebuffer","bindFramebuffer","FRAMEBUFFER","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER","useProgram","red","green","blue","cap","enable","disable","modeRGB","modeAlpha","blendEquationSeparate","srcRGB","dstRGB","srcAlpha","dstAlpha","blendFuncSeparate","Renderbuffer","state","onContextLost","unsubscribe","onResetRender","glFormat","DEPTH_COMPONENT16","RGBA8","RGB8","rb","createRenderbuffer","RENDERBUFFER","renderbufferStorageMultisample","renderbufferStorage","subscribe","deleteRenderbuffer","Framebuffer","colorAttachment","fb","createFramebuffer","Texture","framebufferTexture2D","COLOR_ATTACHMENT0","framebufferRenderbuffer","deleteFramebuffer","RenderPool","texturePool","renderbufferPool","items","insertAt","Date","item","threshold","toBeDeleted","Atlas","rowHeight","CachedRender","pool","returned","returnTexture","indexLimit","atlasSize","tmpRect","renderTextureSize","ceil","Renderer","textureMap","renderPool","textureReturnBox","renderbufferReturnBox","indexData","attributeData","ArrayBuffer","vertexLimit","Buffer","attrFloat","attrUint","renderVertexArray","VertexArray","components","stride","normalized","integer","backgroundColor","glState","premultipliedAlpha","antialias","renderProgram","Program","_","Int32Array","defaultFramebuffer","renderNode","setClearColor","COLOR_BUFFER_BIT","isContextLost","blitFramebuffer","NEAREST","logicalWidth","logicalHeight","clearFb","projectionMat","returnRenderbuffer","cleanLRU","caches","classifyRenders","resolved","renderCaches","renderTextures","renderFilters","atlas","atlasContext","atlasItems","flush","texItem","takeTexture","rbItem","takeRenderbuffer","renderView","pushTransform","atlasBounds","add","renderContext","cacheTexture","tmpFramebuffer","filterInputs","apply","outBounds","filterGroups","group","groupFilter","input","inBounds","objects","setViewport","returnRbs","returnTexs","masks","token","maskRenders","maskTextures","maskGroups","overlapped","nextID","maskTex","maskID","maskFb","doRenderObjects","idRenders","maskToken","BLEND","setBlendEquation","FUNC_ADD","setBlendFunc","ONE","ONE_MINUS_SRC_ALPHA","projA","projB","projC","projD","projTX","projTY","numVertex","numIndex","update","boundUnits","bindTextures","uniform","drawElements","TRIANGLES","UNSIGNED_SHORT","objectNumVertex","objectNumIndex","loadTexture","textureIndex","maskTextureIndex","fillMode","maskMode","roundVertex","base","viewA","viewB","viewC","viewD","viewTX","viewTY","uvA","uvB","uvC","uvD","uvTX","uvTY","colorMulR","colorMulG","colorMulB","colorMulA","colorAddR","colorAddG","colorAddB","colorAddA","vx","vy","samples","round","Ticker","fps","onFrame","onRender","channel","MessageChannel","lastTimestamp","needRender","_onFrame","error","_onRender","timestamp","last","targetMS","port2","postMessage","animationHandle","requestAnimationFrame","port1","onmessage","end","cancelAnimationFrame","Stage","__mouseOn","__mouseTrackTarget","focus","__quality","__onFrame","__withContext","__doRender","__renderer","renderFrame","blitFrame","sourceEvent","__canvas","resolveCoords","__hitTestObject","dispatchMouseEvent","event","MouseEvent","buttonDown","localX","localY","stageX","stageY","keyCode","Keyboard","code","KeyboardEvent","Event","__ticker","begin","bytesTotal","bytesLoaded","location","href","resetRenderState","p","__current","hitSelf","hit","j","__state","B","trackAsMenu","useHandCursor","newState","isMouseDown","hitTestPoint","oldState","buttonState","instantiateState","stateTransition","__states","upState","overState","downState","BitmapData","transparent","fillColor","__root","SceneNode","__needRender","__needPixel","__pixels","__target","Rectangle","source","colorTransform","blendMode","sourceNode","clone","colorTransformLocalMul","__mul","colorTransformLocalAdd","__add","trx","__render","__rect","addPatch","patch","invertY","pixels","readPixels","RGBA","UNSIGNED_BYTE","pixel","sourceBitmapData","sourceRect","destPoint","dst","srcX","srcY","dstX","dstY","renderer","onRemoveFromStage","Bitmap","bitmapData","texWidth","texHeight","Loader","bubbles","cancelable","fields","field","ENTER_FRAME","ADDED_TO_STAGE","REMOVED_FROM_STAGE","SOUND_COMPLETE","DEACTIVATE","forBroadcast","broadcastEvents","EventDispatcher","isCapturing","listener","useCapture","priority","useWeakReference","__broadcastDispatcher","oldListeners","newListeners","sort","removeEventListener","currentTarget","path","current","KEY_DOWN","KEY_UP","CLICK","MOUSE_DOWN","MOUSE_MOVE","MOUSE_OUT","MOUSE_OVER","MOUSE_UP","TimerEvent","TextEvent","ErrorEvent","IOErrorEvent","IO_ERROR","SecurityErrorEvent","SECURITY_ERROR","FocusEvent","BitmapFilter","outProjection","inTexScale","outTexScale","blurX","blurY","texA","texB","batchInput","radius","passes","blurProgram","numRect","front","back","passFront","passBack","texUnit","tmp","deltaX","deltaY","attrI","vertex","inTexCoords","outTexCoords","inBoundsMin","inBoundsMax","outBoundsMin","outBoundsMax","BlurFilter","quality","DropShadowFilter","strength","angle","distance","knockout","hideObject","inner","ColorTransform","redMul","greenMul","blueMul","alphaMul","redAdd","greenAdd","blueAdd","alphaAdd","Matrix","d","tx","ty","dx","dy","sx","sy","u","sin","cos","Point","__empty","Transform","__matrix","__colorTransform","SoundContext","soundChannels","info","syncNoMultiple","syncStop","stop","sound","instantiateCharacter","playTime","loops","inPoint","sampleRate","loopCount","play","channels","Set","SoundChannel","soundTransform","startTime","isStopped","__audioNode","__volumeNode","connect","__soundTransform","__source","__updateSoundTransform","currentTime","__beginTime","__duration","duration","loop","loopStart","start","onended","disconnect","gain","setValueAtTime","volume","SoundTransform","__volume","SoundMixer","TextFormat","DYNAMIC","NUMBER_0","NUMBER_1","NUMBER_2","NUMBER_3","NUMBER_4","NUMBER_5","NUMBER_6","NUMBER_7","NUMBER_8","NUMBER_9","A","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","SEMICOLON","EQUAL","COMMA","MINUS","PERIOD","SLASH","BACKQUOTE","LEFTBRACKET","BACKSLASH","RIGHTBRACKET","QUOTE","ALTERNATE","BACKSPACE","CAPS_LOCK","COMMAND","CONTROL","DELETE","DOWN","END","ENTER","ESCAPE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","HOME","INSERT","LEFT","NUMPAD","NUMPAD_0","NUMPAD_1","NUMPAD_2","NUMPAD_3","NUMPAD_4","NUMPAD_5","NUMPAD_6","NUMPAD_7","NUMPAD_8","NUMPAD_9","NUMPAD_ADD","NUMPAD_DECIMAL","NUMPAD_DIVIDE","NUMPAD_ENTER","NUMPAD_MULTIPLY","NUMPAD_SUBTRACT","PAGE_DOWN","PAGE_UP","RIGHT","SHIFT","SPACE","TAB","UP","RED","GREEN","YELLOW","BLUE","CHANNEL_UP","CHANNEL_DOWN","RECORD","PLAY","PAUSE","STOP","FAST_FORWARD","REWIND","SKIP_FORWARD","SKIP_BACKWARD","NEXT","PREVIOUS","LIVE","LAST","MENU","INFO","GUIDE","EXIT","BACK","AUDIO","SUBTITLE","DVR","VOD","INPUT","SETUP","HELP","MASTER_SHELL","SEARCH","codeMap","Digit0","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","KeyA","KeyB","KeyC","KeyD","KeyE","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","KeyM","KeyN","KeyO","KeyP","KeyQ","KeyR","KeyS","KeyT","KeyU","KeyV","KeyW","KeyX","KeyY","KeyZ","Semicolon","Equal","Comma","Minus","Period","Slash","Backquote","BracketLeft","Backslash","BracketRight","Quote","AltLeft","AltRight","Backspace","CapsLock","ControlLeft","ControlRight","Delete","ArrowDown","End","Enter","Escape","Home","Insert","ArrowLeft","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadAdd","NumpadDecimal","NumpadDivide","NumpadEnter","NumpadMultiply","NumpadSubtract","PageDown","PageUp","ArrowRight","ShiftLeft","ShiftRight","Space","Tab","ArrowUp","GlowFilter","URLRequest","SharedObject","localStorage","stringify","navigateToURL","request","open","Timer","delay","repeatCount","getTimer","getDefinitionByName","Audio","AudioContext","globalVolumeNode","createGain","destination","ButtonState","Up","Over","Down","HitTest","stateContainer","inState","record","up","over","down","moveCharacter","version","hitTestState","to","overUpToIdle","idleToOverUp","overUpToOverDown","soundInfo","FilterID","executeActionPlaceObject","character","findIndex","oldCharacter","removeChildAt","setupCharacter","addChildAt","executeActionRemoveObject","executeActionStartSound","syncSound","clipDepth","Blur","DropShadow","updateFrameMasks","clips","clip","preMultiplyAlpha","decomposeColorVec","multiplyColorTransform","outMul","outAdd","parentMul","parentAdd","childMul","childAdd","projection","epsilon","create","of","fromValues","copy","equals","intersects","contains","factor","t","vec","ax","ay","bx","by","norm","sqrt","normal","exact","numTriangles","cx","cy","d1","d2","d3","hasPositive","subInput","doMerge","vertexI","indexI","outV","subarray","inV","Flags","roundTwips","tmpRect1","tmpRect2","tmpMat2d1","tmpMat2d2","flags","DirtyAll","boundsIntrinsic","cachedRender","transformRender","transformWorld","DirtyRender","dirtyTransform","DirtyBounds","DirtyChildTransform","nodes","DirtyTransform","updated","renderDirty","dirtyParent","dirtyNode","needChildrenBounds","IsRoot","intrinsicBounds","renderRecursive","doRender","return","doRenderMask","doRenderFilter","viewMat","onRenderTexture","nextFilter","shift","renderFilter","renderCache","renderTexture","doRenderContent","worldPt","some","nodeMap","clonedChild","texUnits","programBlurCache","programBlur","blurRadius","kernelWidth","prog","unshift","toFixed","blurFragmentShader","programShadow","maxRect","attrData","binding","usage","createBuffer","bufferData","bufferSubData","toTypedArray","cls","array","arrayEquals","oldArray","newArray","Uniform","typeDef","FLOAT","setter","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","INT","INT_VEC2","INT_VEC3","INT_VEC4","UNSIGNED_INT","UNSIGNED_INT_VEC2","UNSIGNED_INT_VEC3","UNSIGNED_INT_VEC4","BOOL","BOOL_VEC2","BOOL_VEC3","BOOL_VEC4","FLOAT_MAT2","FLOAT_MAT3","FLOAT_MAT4","SAMPLER_2D","newValue","vertexShader","fragmentShader","uniforms","createShader","VERTEX_SHADER","shaderSource","trim","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","numUniforms","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","createTexture","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","HTMLElement","texImage2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","deleteTexture","WHITE","indexBuffer","createVertexArray","glType","vertexAttribIPointer","vertexAttribPointer","enableVertexAttribArray","EPSILON","ARRAY_TYPE","random","hypot","arguments","identity","invert","aa","ab","ac","ad","atx","aty","det","multiply","a0","a1","a2","a3","a4","a5","b0","b1","b2","b3","b4","b5","rotate","rad","v0","v1","fromTranslation","exactEquals","transformMat2d","m","p0","p1","sinC","cosC","mul","z","w","runtime","Op","hasOwn","hasOwnProperty","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","context","Context","_invoke","GenStateSuspendedStart","method","arg","GenStateExecuting","GenStateCompleted","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","tryCatch","GenStateSuspendedYield","makeInvokeMethod","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","NativeIteratorPrototype","Gp","defineIteratorMethods","forEach","AsyncIterator","PromiseImpl","invoke","__await","unwrapped","previousPromise","callInvokeWithMethodAndArg","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","iterable","iteratorMethod","displayName","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","iter","keys","reverse","skipTempReset","prev","charAt","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode"],"mappings":"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","file":"785.0b61ebc4.js","sourcesContent":["function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray;","function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableRest;","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray;","module.exports = require(\"regenerator-runtime\");\n","import { CharacterInstance } from \"./CharacterInstance\";\n\nexport class ImageInstance implements CharacterInstance {\n  constructor(readonly id: number, readonly image: HTMLImageElement) {}\n}\n","import { CharacterInstance } from \"./CharacterInstance\";\n\nexport class SoundInstance implements CharacterInstance {\n  constructor(readonly id: number, readonly audio: AudioBuffer) {}\n}\n","import { Matrix } from \"./primitives\";\n\nexport enum GradientMode {\n  Pad = 0,\n}\n\nexport interface Gradient {\n  mode: GradientMode;\n  points: [number, number][];\n}\n\nexport enum FillStyleKind {\n  SolidColor = 0,\n  LinearGradient = 1,\n  RadicalGradient = 2,\n  ClippedBitmap = 3,\n}\n\nexport type FillStyle =\n  | FillStyleSolidColor\n  | FillStyleGradient\n  | FillStyleBitmap;\n\nexport interface FillStyleSolidColor {\n  kind: FillStyleKind.SolidColor;\n  color: number;\n}\n\nexport interface FillStyleGradient {\n  kind: FillStyleKind.LinearGradient | FillStyleKind.RadicalGradient;\n  matrix: Matrix;\n  gradient: Gradient;\n}\n\nexport interface FillStyleBitmap {\n  kind: FillStyleKind.ClippedBitmap;\n  matrix: Matrix;\n  characterId: number;\n}\n","import { mat2d } from \"gl-matrix\";\nimport { RenderObject } from \"../render2/RenderObject\";\nimport type { AssetLibrary } from \"../../classes/__internal/AssetLibrary\";\nimport { ShapeContour } from \"../../classes/__internal/character/Shape\";\nimport { FillStyleKind } from \"../../classes/__internal/character/styles\";\nimport { makeGradientTexture, gradientKey } from \"./gradient\";\nimport { rect } from \"../math/rect\";\nimport { preMultiplyAlpha } from \"../math/color\";\n\nexport function makeShapeRenderObject(\n  contour: ShapeContour,\n  lib: AssetLibrary\n): RenderObject {\n  const vertices = new Float32Array(contour.vertices).map((v) => v / 20);\n  const indices = new Uint16Array(contour.indices);\n\n  let minX = Infinity,\n    minY = Infinity,\n    maxX = -Infinity,\n    maxY = -Infinity;\n  for (let i = 0; i < contour.vertices.length; i += 2) {\n    const x = vertices[i + 0];\n    const y = vertices[i + 1];\n\n    minX = Math.min(minX, x);\n    minY = Math.min(minY, y);\n    maxX = Math.max(maxX, x);\n    maxY = Math.max(maxY, y);\n  }\n  const bounds = rect.fromValues(minX, minY, maxX - minX, maxY - minY);\n\n  let texture = null;\n  let color: number = 0xffffffff;\n  const uvMatrix = mat2d.identity(mat2d.create());\n  switch (contour.fill.kind) {\n    case FillStyleKind.SolidColor:\n      color = preMultiplyAlpha(contour.fill.color);\n      break;\n\n    case FillStyleKind.LinearGradient:\n    case FillStyleKind.RadicalGradient:\n      const key = gradientKey(contour.fill.gradient);\n      texture = lib.gradientCache.get(key);\n      if (!texture) {\n        texture = makeGradientTexture(contour.fill.gradient);\n        lib.gradientCache.set(key, texture);\n      }\n\n      mat2d.set(uvMatrix, ...contour.fill.matrix);\n      convertMatrix(uvMatrix, 32768, 32768, 0.5);\n      break;\n\n    case FillStyleKind.ClippedBitmap:\n      texture = lib.resolveImage(contour.fill.characterId);\n\n      mat2d.set(uvMatrix, ...contour.fill.matrix);\n      convertMatrix(uvMatrix, texture.width, texture.height, 0);\n      break;\n  }\n\n  const colors = new Uint32Array(vertices.length / 2);\n  colors.fill(color);\n\n  return new RenderObject(\n    \"shape\",\n    vertices,\n    colors,\n    indices,\n    uvMatrix,\n    texture,\n    contour.fill.kind,\n    bounds\n  );\n}\n\n// https://github.com/ruffle-rs/ruffle/blob/09ca11f788ef5c5efa45a40d96e3cbe5be9e940b/render/common_tess/src/lib.rs#L344\nfunction convertMatrix(\n  mat: mat2d,\n  width: number,\n  height: number,\n  offset: number\n) {\n  mat2d.invert(mat, mat);\n  mat2d.scale(mat, mat, [20 / width, 20 / height]);\n  mat[4] = mat[4] / width + offset;\n  mat[5] = mat[5] / height + offset;\n}\n","import { Gradient } from \"../../classes/__internal/character/styles\";\n\nexport function gradientKey(gradient: Gradient) {\n  return `${gradient.mode};${gradient.points\n    .map(([ratio, color]) => `${ratio}:${color}`)\n    .join(\";\")}`;\n}\n\nexport function makeGradientTexture(gradient: Gradient): HTMLCanvasElement {\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = 256;\n  canvas.height = 256;\n\n  const ctx = canvas.getContext(\"2d\")!;\n\n  const lg = ctx.createLinearGradient(0, 0, canvas.width, 0);\n  for (const [ratio, color] of gradient.points) {\n    const a = (color >>> 24) & 0xff;\n    const r = (color >>> 16) & 0xff;\n    const g = (color >>> 8) & 0xff;\n    const b = (color >>> 0) & 0xff;\n    lg.addColorStop(ratio / 255, `rgba(${r}, ${g}, ${b}, ${a / 255})`);\n  }\n\n  ctx.fillStyle = lg;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  return canvas;\n}\n","import { Shape } from \"../../classes/flash/display/Shape\";\nimport type { AssetLibrary } from \"../../classes/__internal/AssetLibrary\";\nimport { ShapeCharacter } from \"../../classes/__internal/character/Shape\";\nimport { CharacterInstance } from \"./CharacterInstance\";\nimport { makeShapeRenderObject } from \"./shapes\";\nimport { RenderObject } from \"../render2/RenderObject\";\nimport { rect } from \"../math/rect\";\n\nexport class ShapeInstance implements CharacterInstance {\n  readonly renderObjects: RenderObject[];\n  readonly bounds: rect;\n\n  constructor(readonly id: number, def: ShapeCharacter, lib: AssetLibrary) {\n    this.renderObjects = def.contours.map((c) => makeShapeRenderObject(c, lib));\n    this.bounds = rect.create();\n    for (const def of this.renderObjects) {\n      rect.union(this.bounds, this.bounds, def.bounds);\n    }\n  }\n\n  applyTo(container: Shape) {\n    container.__node.setRenderObjects(this.renderObjects, this.bounds);\n  }\n}\n","import { MorphShape } from \"../../classes/flash/display/MorphShape\";\nimport type { AssetLibrary } from \"../../classes/__internal/AssetLibrary\";\nimport { MorphShapeCharacter } from \"../../classes/__internal/character/MorphShape\";\nimport { CharacterInstance } from \"./CharacterInstance\";\nimport { makeShapeRenderObject } from \"./shapes\";\nimport { RenderObject } from \"../render2/RenderObject\";\nimport { rect } from \"../math/rect\";\n\ninterface MorphShapeFrame {\n  renderObjects: RenderObject[];\n  bounds: rect;\n}\n\nexport class MorphShapeInstance implements CharacterInstance {\n  readonly frames = new Map<number, MorphShapeFrame>();\n\n  constructor(\n    readonly id: number,\n    def: MorphShapeCharacter,\n    lib: AssetLibrary\n  ) {\n    for (const [ratio, shape] of def.frames) {\n      const renderObjects = shape.contours.map((c) =>\n        makeShapeRenderObject(c, lib)\n      );\n      const bounds = rect.create();\n      for (const def of renderObjects) {\n        rect.union(bounds, bounds, def.bounds);\n      }\n      this.frames.set(ratio, { renderObjects, bounds });\n    }\n  }\n\n  applyTo(container: MorphShape) {\n    const frame = this.frames.get(container.__ratio);\n    if (!frame) {\n      console.warn(\n        `no ratio frame #${container.__ratio} for morph shape #${this.id}`\n      );\n      return;\n    }\n\n    container.__node.setRenderObjects(frame.renderObjects, frame.bounds);\n  }\n}\n","import { Sprite } from \"../../classes/flash/display/Sprite\";\nimport {\n  SpriteCharacter,\n  SpriteFrame,\n  FrameActionKind,\n  FrameAction,\n  FrameActionStartSound,\n} from \"../../classes/__internal/character/Sprite\";\nimport type { AssetLibrary } from \"../../classes/__internal\";\nimport { CharacterInstance } from \"./CharacterInstance\";\nimport {\n  executeActionPlaceObject,\n  executeActionRemoveObject,\n  updateFrameMasks,\n  executeActionStartSound,\n} from \"./frame\";\n\nexport class SpriteInstance implements CharacterInstance {\n  readonly numFrames: number;\n  readonly frames: SpriteFrame[];\n\n  constructor(\n    readonly id: number,\n    sprite: SpriteCharacter,\n    readonly library: AssetLibrary\n  ) {\n    this.numFrames = sprite.numFrames;\n    this.frames = sprite.frames;\n  }\n\n  applyTo(sprite: Sprite, prevFrameNum: number, thisFrameNum: number) {\n    const effectiveActions = new Map<number, FrameAction>();\n    const soundActions: FrameActionStartSound[] = [];\n    const setActions = (frameNum: number) => {\n      const frame = this.frames.find((f) => f.frame === frameNum);\n      if (!frame) {\n        return;\n      }\n\n      soundActions.length = 0;\n      for (const action of frame.actions) {\n        if (action.kind === FrameActionKind.StartSound) {\n          soundActions.push(action);\n          continue;\n        }\n\n        const ea = effectiveActions.get(action.depth);\n        if (!ea || ea.kind !== action.kind) {\n          effectiveActions.set(action.depth, action);\n        } else if (ea.kind === FrameActionKind.PlaceObject) {\n          effectiveActions.set(action.depth, {\n            ...ea,\n            ...action,\n          });\n        }\n      }\n    };\n\n    if (thisFrameNum >= prevFrameNum) {\n      for (let i = prevFrameNum; i <= thisFrameNum; i++) {\n        setActions(i);\n      }\n    } else {\n      // Reset timeline on frame 1\n      for (const child of sprite.__children) {\n        if (child.__depth >= 0) {\n          effectiveActions.set(child.__depth, {\n            kind: FrameActionKind.RemoveObject,\n            depth: child.__depth,\n          });\n        }\n      }\n      for (let i = 1; i <= thisFrameNum; i++) {\n        setActions(i);\n      }\n    }\n\n    for (const action of effectiveActions.values()) {\n      switch (action.kind) {\n        case FrameActionKind.PlaceObject:\n          executeActionPlaceObject(this.library, sprite, action);\n          break;\n        case FrameActionKind.RemoveObject:\n          executeActionRemoveObject(sprite, action);\n          break;\n      }\n    }\n\n    for (const action of soundActions) {\n      executeActionStartSound(this.library, sprite.__soundContext, action);\n    }\n\n    updateFrameMasks(sprite);\n  }\n}\n","import { mat2d } from \"gl-matrix\";\nimport { makeShapeRenderObject } from \"./shapes\";\nimport { CharacterInstance } from \"./CharacterInstance\";\nimport { FontCharacter, FontLayout } from \"../../classes/__internal/character\";\nimport type { AssetLibrary } from \"../../classes/__internal\";\nimport { RenderObject } from \"../render2/RenderObject\";\n\nexport interface FontGlyph {\n  renderObjects: RenderObject[];\n}\n\nexport class FontInstance implements CharacterInstance {\n  readonly glyphs: FontGlyph[];\n  readonly charMap = new Map<string, number>();\n  readonly layout?: FontLayout;\n\n  constructor(\n    readonly id: number,\n    readonly font: FontCharacter,\n    lib: AssetLibrary\n  ) {\n    this.glyphs = font.glyphs.map((glyph) => {\n      const renderObjects = glyph.shape.contours.map((c) =>\n        makeShapeRenderObject(c, lib)\n      );\n      return {\n        renderObjects: RenderObject.merge(\n          \"text\",\n          renderObjects.map((renderObject) => ({\n            renderObject,\n            transform: mat2d.identity(mat2d.create()),\n          }))\n        ),\n      };\n    });\n    for (let i = 0; i < font.glyphs.length; i++) {\n      const char = font.glyphs[i].char;\n      if (char) {\n        this.charMap.set(char, i);\n      }\n    }\n\n    this.layout = font.layout && {\n      ascent: font.layout.ascent / 20 / 1024,\n      descent: font.layout.descent / 20 / 1024,\n      leading: font.layout.ascent / 20 / 1024,\n      advances: font.layout.advances.map((v) => v / 20 / 1024),\n    };\n  }\n}\n","import { mat2d, vec2, vec4 } from \"gl-matrix\";\nimport { StaticText } from \"../../classes/flash/text/StaticText\";\nimport { CharacterInstance } from \"./CharacterInstance\";\nimport { StaticTextCharacter } from \"../../classes/__internal/character\";\nimport { AssetLibrary } from \"../../classes/__internal\";\nimport { RenderObject } from \"../render2/RenderObject\";\nimport { rect } from \"../math/rect\";\nimport { preMultiplyAlpha } from \"../math/color\";\n\nexport class StaticTextInstance implements CharacterInstance {\n  readonly renderObjects: RenderObject[] = [];\n  readonly bounds: rect;\n\n  constructor(\n    readonly id: number,\n    text: StaticTextCharacter,\n    lib: AssetLibrary\n  ) {\n    this.bounds = rect.scale(\n      rect.create(),\n      rect.fromValues(...text.bounds),\n      1 / 20\n    );\n\n    const matrix = mat2d.fromValues(...text.matrix);\n    matrix[4] /= 20;\n    matrix[5] /= 20;\n\n    interface GlyphInstance {\n      renderObject: RenderObject;\n      color: number;\n      transform: mat2d;\n    }\n\n    const instances: GlyphInstance[] = [];\n    for (const g of text.glyphs) {\n      const font = lib.resolveFont(g.fontId);\n      const glyph = font.glyphs[g.index];\n\n      const transform = mat2d.create();\n      mat2d.translate(transform, matrix, [g.x / 20, g.y / 20]);\n      mat2d.scale(transform, transform, [\n        g.size / 1024 / 20,\n        g.size / 1024 / 20,\n      ]);\n\n      const color = preMultiplyAlpha(g.color);\n\n      for (const object of glyph.renderObjects) {\n        instances.push({\n          renderObject: object,\n          color,\n          transform,\n        });\n      }\n    }\n\n    this.renderObjects = RenderObject.merge(\"text\", instances);\n  }\n\n  applyTo(staticText: StaticText) {\n    staticText.__node.setRenderObjects(this.renderObjects, this.bounds);\n  }\n}\n","import { EditTextCharacter } from \"../../classes/__internal/character\";\nimport { TextField } from \"../../classes/flash/text/TextField\";\nimport { rect } from \"../math/rect\";\nimport { CharacterInstance } from \"./CharacterInstance\";\nimport { TextFieldType, TextFormatAlign } from \"../../classes/flash/text\";\nimport { AssetLibrary } from \"../../classes/__internal\";\n\nexport class EditTextInstance implements CharacterInstance {\n  readonly def: EditTextCharacter;\n  readonly layoutBounds: rect;\n\n  constructor(\n    readonly id: number,\n    text: EditTextCharacter,\n    readonly lib: AssetLibrary\n  ) {\n    this.def = {\n      ...text,\n      fontHeight: text.fontHeight && text.fontHeight / 20,\n      leftMargin: text.leftMargin && text.leftMargin / 20,\n      rightMargin: text.rightMargin && text.rightMargin / 20,\n      indent: text.indent && text.indent / 20,\n      leading: text.leading && text.leading / 20,\n    };\n    this.layoutBounds = rect.scale(\n      rect.create(),\n      rect.fromValues(...text.bounds),\n      1 / 20\n    );\n  }\n\n  applyTo(textField: TextField) {\n    textField.wordWrap = this.def.isWordWrap;\n    textField.multiline = this.def.isMultiline;\n    textField.type = this.def.isReadonly\n      ? TextFieldType.DYNAMIC\n      : TextFieldType.INPUT;\n    textField.selectable = !this.def.noSelect;\n    rect.copy(textField.__container.layoutBounds, this.layoutBounds);\n\n    switch (this.def.align) {\n      case 0:\n        textField.defaultTextFormat.align = TextFormatAlign.LEFT;\n        break;\n      case 1:\n        textField.defaultTextFormat.align = TextFormatAlign.RIGHT;\n        break;\n      case 2:\n        textField.defaultTextFormat.align = TextFormatAlign.CENTER;\n        break;\n      case 3:\n        textField.defaultTextFormat.align = TextFormatAlign.JUSTIFY;\n        break;\n    }\n    if (this.def.textColor != null) {\n      textField.defaultTextFormat.color = this.def.textColor;\n    }\n    if (this.def.fontID != null) {\n      textField.defaultTextFormat.font = this.lib.resolveFont(\n        this.def.fontID\n      ).font.name;\n    }\n    if (this.def.fontHeight != null) {\n      textField.defaultTextFormat.size = this.def.fontHeight;\n    }\n    if (this.def.leading != null) {\n      textField.defaultTextFormat.leading = this.def.leading;\n    }\n\n    if (this.def.isHTML) {\n      textField.htmlText = this.def.initialText ?? \"\";\n    } else {\n      textField.text = this.def.initialText ?? \"\";\n    }\n  }\n}\n","import { Shape } from \"../flash/display/Shape\";\nimport { MorphShape } from \"../flash/display/MorphShape\";\nimport { Sprite } from \"../flash/display/Sprite\";\nimport { MovieClip } from \"../flash/display/MovieClip\";\nimport { StaticText } from \"../flash/text/StaticText\";\nimport { TextField } from \"../flash/text\";\nimport { Sound } from \"../flash/media\";\nimport { ImageInstance } from \"../../internal/character/ImageInstance\";\nimport { SoundInstance } from \"../../internal/character/SoundInstance\";\nimport { ShapeInstance } from \"../../internal/character/ShapeInstance\";\nimport { MorphShapeInstance } from \"../../internal/character/MorphShapeInstance\";\nimport { SpriteInstance } from \"../../internal/character/SpriteInstance\";\nimport { FontInstance } from \"../../internal/character/FontInstance\";\nimport { StaticTextInstance } from \"../../internal/character/StaticTextInstance\";\nimport { EditTextInstance } from \"../../internal/character/EditTextInstance\";\nimport { ButtonInstance } from \"../../internal/character/ButtonInstance\";\nimport { AssetBundle } from \"./AssetBundle\";\nimport { FontRegistry } from \"./FontRegistry\";\nimport { SimpleButton } from \"../flash/display\";\nimport { ClassRegistry } from \"./ClassRegistry\";\nimport { Audio } from \"../../internal/audio\";\nimport { Manifest } from \"./Manifest\";\nimport { Properties } from \"./Properties\";\n\nasync function fetchData(\n  url: string,\n  size: number,\n  progress: (loaded: number, size: number) => void\n): Promise<Uint8Array> {\n  progress(0, size);\n\n  const resp = await fetch(url);\n  const reader = resp.body!.getReader();\n\n  const chunks: Uint8Array[] = [];\n  let received = 0;\n  while (true) {\n    const result = await reader.read();\n\n    if (result.done) {\n      break;\n    }\n\n    chunks.push(result.value);\n    received += result.value.length;\n    progress(received, size);\n  }\n\n  const result = new Uint8Array(received);\n  let i = 0;\n  for (const chunk of chunks) {\n    result.set(chunk, i);\n    i += chunk.length;\n  }\n\n  progress(received, received);\n  return result;\n}\n\nexport async function loadManifest(\n  manifest: Manifest,\n  progress?: (value: number) => void\n): Promise<AssetLibrary> {\n  const progresses = new Map<string, [number, number]>();\n  for (const [id, { size }] of Object.entries(manifest.assets)) {\n    progresses.set(id, [0, size]);\n  }\n  const reportProgress = (id: string) => (loaded: number, size: number) => {\n    progresses.set(id, [loaded, size]);\n    let allLoaded = 0;\n    let allSize = 0;\n    for (const [l, s] of progresses.values()) {\n      allLoaded += l;\n      allSize += s;\n    }\n    progress?.(allLoaded / allSize);\n  };\n\n  const dataAsset = manifest.assets[manifest.data];\n  const data = await fetchData(\n    dataAsset.url.toString(),\n    dataAsset.size,\n    reportProgress(manifest.data)\n  );\n  const bundle: AssetBundle = JSON.parse(new TextDecoder().decode(data));\n\n  const library = new AssetLibrary(manifest.properties);\n\n  await Promise.all([\n    ...Array.from(Object.entries(bundle.images)).map(\n      async ([charId, { id }]) => {\n        const asset = manifest.assets[id];\n        const img = await new Promise<HTMLImageElement>((resolve, reject) => {\n          const report = reportProgress(id);\n          report(0, asset.size);\n          let loaded = 0;\n\n          const img = new Image();\n          img.onload = () => {\n            report(loaded, loaded);\n            resolve(img);\n          };\n          img.onerror = (e) => reject(e);\n          img.onprogress = (e) => {\n            loaded = e.loaded;\n            report(loaded, asset.size);\n          };\n          img.src = asset.url.toString();\n        });\n        library.images.set(\n          Number(charId),\n          new ImageInstance(Number(charId), img)\n        );\n      }\n    ),\n    ...Array.from(Object.entries(bundle.sounds)).map(\n      async ([charId, { id }]) => {\n        const asset = manifest.assets[id];\n        const data = await fetchData(\n          asset.url.toString(),\n          asset.size,\n          reportProgress(id)\n        );\n        const buf = await Audio.decodeAudioData(data.buffer);\n        library.sounds.set(\n          Number(charId),\n          new SoundInstance(Number(charId), buf)\n        );\n      }\n    ),\n  ]);\n\n  for (const [id, shape] of Object.entries(bundle.shapes)) {\n    const charId = Number(id);\n    library.shapes.set(charId, new ShapeInstance(charId, shape, library));\n  }\n\n  for (const [id, morphShape] of Object.entries(bundle.morphShapes)) {\n    const charId = Number(id);\n    const instance = new MorphShapeInstance(charId, morphShape, library);\n    library.morphShapes.set(charId, instance);\n  }\n\n  for (const [id, sprite] of Object.entries(bundle.sprites)) {\n    const charId = Number(id);\n    library.sprites.set(charId, new SpriteInstance(charId, sprite, library));\n  }\n\n  for (const [id, font] of Object.entries(bundle.fonts)) {\n    const charId = Number(id);\n    const instance = new FontInstance(charId, font, library);\n    library.fonts.set(charId, instance);\n    FontRegistry.instance.registerFont(instance);\n  }\n\n  for (const [id, staticText] of Object.entries(bundle.staticTexts)) {\n    const charId = Number(id);\n    const instance = new StaticTextInstance(charId, staticText, library);\n    library.staticTexts.set(charId, instance);\n  }\n\n  for (const [id, editText] of Object.entries(bundle.editTexts)) {\n    const charId = Number(id);\n    const instance = new EditTextInstance(charId, editText, library);\n    library.editTexts.set(charId, instance);\n  }\n\n  for (const [id, button] of Object.entries(bundle.buttons)) {\n    const charId = Number(id);\n    const instance = new ButtonInstance(charId, button, library);\n    library.buttons.set(charId, instance);\n  }\n\n  for (const [id, className] of Object.entries(bundle.linkages)) {\n    const classFn = ClassRegistry.instance.classes.get(className);\n    if (!classFn) {\n      throw new Error(`Linked class ${className} not found`);\n    }\n    const charId = Number(id);\n    library.linkedClasses.set(charId, classFn);\n  }\n\n  library.linkCharacters();\n  return library;\n}\n\nexport class AssetLibrary {\n  readonly images = new Map<number, ImageInstance>();\n  readonly sounds = new Map<number, SoundInstance>();\n  readonly shapes = new Map<number, ShapeInstance>();\n  readonly morphShapes = new Map<number, MorphShapeInstance>();\n  readonly sprites = new Map<number, SpriteInstance>();\n  readonly fonts = new Map<number, FontInstance>();\n  readonly staticTexts = new Map<number, StaticTextInstance>();\n  readonly editTexts = new Map<number, EditTextInstance>();\n  readonly buttons = new Map<number, ButtonInstance>();\n  readonly linkedClasses = new Map<number, Function>();\n\n  readonly gradientCache = new Map<string, HTMLCanvasElement>();\n\n  constructor(readonly properties: Properties) {}\n\n  resolveImage(id: number): HTMLImageElement {\n    const instance = this.images.get(id);\n    if (!instance) {\n      throw new Error(`Image character #${id} not found`);\n    }\n\n    return instance.image;\n  }\n\n  resolveFont(id: number): FontInstance {\n    const instance = this.fonts.get(id);\n    if (!instance) {\n      throw new Error(`Font character #${id} not found`);\n    }\n\n    return instance;\n  }\n\n  linkCharacters() {\n    type Class = new () => object;\n    const link = <T>(\n      characters: Map<number, T>,\n      defaultClassFactory: (char: T) => Class\n    ) => {\n      for (const [id, char] of characters) {\n        let classFn = this.linkedClasses.get(id);\n        if (!classFn) {\n          const className = `Character${id}`;\n          classFn = class extends defaultClassFactory(char) {};\n          Object.defineProperty(classFn, \"name\", { value: className });\n          this.linkedClasses.set(id, classFn);\n        }\n        Object.assign(classFn, { __character: char });\n      }\n    };\n\n    link(this.sounds, () => Sound);\n    link(this.shapes, () => Shape);\n    link(this.morphShapes, () => MorphShape);\n    link(this.sprites, (s) => (s.numFrames > 1 ? MovieClip : Sprite));\n    link(this.staticTexts, () => StaticText);\n    link(this.editTexts, () => TextField);\n    link(this.buttons, () => SimpleButton);\n  }\n\n  instantiateCharacter<T>(id: number): T {\n    const classFn = this.linkedClasses.get(id) as new () => T;\n    if (!classFn) {\n      throw new Error(`Character ${id} not found`);\n    }\n\n    return new classFn();\n  }\n}\n","export class ClassRegistry {\n  static readonly instance = new ClassRegistry();\n\n  readonly classes = new Map<string, Function>();\n\n  private constructor() {}\n\n  addClassRoot(root: object) {\n    const addPackage = (name: string, pack: object) => {\n      for (const [key, value] of Object.entries(pack)) {\n        const entryName = name === \"\" ? key : `${name}.${key}`;\n        if (typeof value === \"function\") {\n          this.classes.set(entryName, value);\n        } else if (typeof value === \"object\") {\n          addPackage(entryName, value);\n        }\n      }\n    };\n    addPackage(\"\", root);\n  }\n}\n","import { FontInstance } from \"../../internal/character/FontInstance\";\n\nexport class FontRegistry {\n  static readonly instance = new FontRegistry();\n\n  readonly fonts = new Map<string, FontInstance[]>();\n\n  private constructor() {}\n\n  registerFont(font: FontInstance) {\n    const instances = this.fonts.get(font.font.name) || [];\n    instances.push(font);\n    this.fonts.set(font.font.name, instances);\n  }\n\n  resolve(\n    name: string,\n    isItalic: boolean,\n    isBold: boolean\n  ): FontInstance | null {\n    const instances = this.fonts.get(name) || [];\n\n    for (const instance of instances) {\n      if (\n        instance.font.isItalic === isItalic &&\n        instance.font.isBold === isBold\n      ) {\n        return instance;\n      }\n    }\n    return null;\n  }\n}\n","const classMethods = new Map<unknown, [string, Function][]>();\n\nexport class AVMObject {\n  constructor() {\n    let proto: any = Reflect.getPrototypeOf(this);\n    let methods = classMethods.get(proto);\n    if (!methods) {\n      const protoMethods = new Map<string, Function>();\n      while (proto && proto !== AVMObject.prototype) {\n        for (const key of Reflect.ownKeys(proto)) {\n          if (protoMethods.has(key as string)) {\n            continue;\n          }\n          const desc = Reflect.getOwnPropertyDescriptor(proto, key);\n          if (desc && typeof desc.value === \"function\") {\n            protoMethods.set(key as string, desc.value);\n          }\n        }\n        proto = Reflect.getPrototypeOf(proto);\n      }\n      protoMethods.delete(\"constructor\");\n      methods = Array.from(protoMethods.entries());\n      classMethods.set(Reflect.getPrototypeOf(this), methods);\n    }\n\n    for (const [name, fn] of methods) {\n      (this as any)[name] = fn.bind(this);\n    }\n\n    this.__preInit();\n  }\n\n  __preInit() {}\n}\n","interface InterfaceClass<T> {\n  readonly __IMPL: symbol;\n  readonly prototype: T;\n}\n\nexport class Runtime {\n  static trace(...args: any[]) {\n    console.log(...args);\n  }\n\n  static uint(value: any): number {\n    return (value | 0) >>> 0;\n  }\n\n  static int(value: any): number {\n    return value | 0;\n  }\n\n  static isInterface<T>(value: any, iface: InterfaceClass<T>): value is T {\n    return iface.__IMPL in value;\n  }\n}\n","export class XML {}\n","export const Class = Function;\nexport type Class = Function;\n","import { Rect } from \"./primitives\";\n\nexport enum TextAlign {\n  Left = 0,\n  Right = 1,\n  Center = 2,\n  Justify = 3,\n}\n\nexport interface EditTextCharacter {\n  bounds: Rect;\n\n  isWordWrap: boolean;\n  isMultiline: boolean;\n  isPassword: boolean;\n  isReadonly: boolean;\n  isAutoSize: boolean;\n  noSelect: boolean;\n  border: boolean;\n  wasStatic: boolean;\n  isHTML: boolean;\n  useOutlines: boolean;\n\n  fontID?: number;\n  fontHeight?: number;\n  textColor?: number;\n  maxLength?: number;\n  align?: TextAlign;\n  leftMargin?: number;\n  rightMargin?: number;\n  indent?: number;\n  leading?: number;\n  variableName?: string;\n  initialText?: string;\n}\n","import { Matrix, ColorTransform } from \"./primitives\";\nimport { Filter } from \"./filter\";\nimport { SoundInfo } from \"./Sound\";\n\nexport interface SpriteCharacter {\n  numFrames: number;\n  frames: SpriteFrame[];\n}\n\nexport interface SpriteFrame {\n  frame: number;\n  label?: string;\n  actions: FrameAction[];\n}\n\nexport type FrameAction =\n  | FrameActionPlaceObject\n  | FrameActionRemoveObject\n  | FrameActionStartSound;\n\nexport enum FrameActionKind {\n  PlaceObject = 0,\n  RemoveObject = 1,\n  StartSound = 2,\n}\n\nexport interface FrameActionPlaceObject {\n  kind: FrameActionKind.PlaceObject;\n  depth: number;\n  version: 1 | 2 | 3;\n  moveCharacter: boolean;\n  characterId?: number;\n\n  matrix?: Matrix;\n  colorTransform?: ColorTransform;\n  ratio?: number;\n  name?: string;\n  clipDepth?: number;\n\n  filters?: Filter[];\n  blendMode?: number;\n  cacheAsBitmap?: boolean;\n  visible?: boolean;\n}\n\nexport interface FrameActionRemoveObject {\n  kind: FrameActionKind.RemoveObject;\n  depth: number;\n}\n\nexport interface FrameActionStartSound {\n  kind: FrameActionKind.StartSound;\n  characterId: number;\n  soundInfo: SoundInfo;\n}\n","import { TextFormat } from \"../../flash/text/TextFormat\";\nimport { TextFormatAlign } from \"../../flash/text\";\nimport { TextSegment } from \"./TextSegment\";\nimport { layout } from \"./layout\";\nimport { rect } from \"../../../internal/math/rect\";\nimport { SceneNode } from \"../../../internal/render2/SceneNode\";\n\nconst htmlParser = new DOMParser();\n\nexport class Container {\n  segments: TextSegment[] = [];\n\n  readonly htmlRoot = htmlParser.parseFromString(\"<root />\", \"text/xml\")\n    .documentElement;\n\n  defaultTextFormat = new TextFormat();\n\n  wordWrap = false;\n\n  multiline = false;\n\n  readonly layoutBounds = rect.create();\n\n  constructor(readonly node: SceneNode) {}\n\n  private __text = \"\";\n\n  get text() {\n    return this.__text;\n  }\n  set text(value) {\n    if (this.__text !== value) {\n      this.htmlRoot.textContent = value;\n      this.parseHTML();\n    }\n  }\n\n  private __htmlText = \"\";\n\n  get htmlText() {\n    return this.__htmlText;\n  }\n  set htmlText(value) {\n    if (this.__htmlText !== value) {\n      try {\n        this.htmlRoot.innerHTML = value;\n      } catch {}\n      this.parseHTML();\n    }\n  }\n\n  parseHTML() {\n    const walker = this.htmlRoot.ownerDocument.createTreeWalker(\n      this.htmlRoot,\n      NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT\n    );\n\n    let currentSegment: TextSegment = {\n      format: this.defaultTextFormat.__clone(),\n      text: \"\",\n    };\n    const segmentStack = [currentSegment];\n    const segments: TextSegment[] = [];\n\n    const beginElement = (element: Element) => {\n      const format = currentSegment.format.__clone();\n      let text = \"\";\n      switch (element.tagName.toLowerCase()) {\n        case \"b\":\n          format.bold = true;\n          break;\n        case \"br\":\n          text = \"\\n\";\n          break;\n        case \"font\":\n          for (let i = 0; i < element.attributes.length; i++) {\n            const attr = element.attributes[i];\n            switch (attr.name.toLowerCase()) {\n              case \"color\":\n                if (/^#[0-9a-fA-F]{6}$/.test(attr.value)) {\n                  format.color = parseInt(attr.value.slice(1), 16) + 0xff000000;\n                }\n                break;\n              case \"face\":\n                format.font = attr.value;\n                break;\n              case \"size\":\n                if (/^\\d+$/.test(attr.value)) {\n                  format.size = Number(attr.value);\n                }\n                break;\n            }\n          }\n          break;\n        case \"i\":\n          format.italic = true;\n          break;\n        case \"p\":\n          for (let i = 0; i < element.attributes.length; i++) {\n            const attr = element.attributes[i];\n            switch (attr.name.toLowerCase()) {\n              case \"align\":\n                switch (attr.value) {\n                  case \"left\":\n                    format.align = TextFormatAlign.LEFT;\n                    break;\n                  case \"right\":\n                    format.align = TextFormatAlign.RIGHT;\n                    break;\n                  case \"justify\":\n                    format.align = TextFormatAlign.JUSTIFY;\n                    break;\n                  case \"center\":\n                    format.align = TextFormatAlign.CENTER;\n                    break;\n                }\n                break;\n            }\n            break;\n          }\n          break;\n      }\n\n      currentSegment = { format, text };\n      segmentStack.push(currentSegment);\n      segments.push(currentSegment);\n    };\n\n    const endElement = (element: Element) => {\n      segmentStack.pop();\n      currentSegment = segmentStack[segmentStack.length - 1];\n    };\n\n    const onText = (text: Text) => {\n      currentSegment.text += text.textContent;\n    };\n\n    let node: Node | null = walker.root;\n    while (node) {\n      if (node instanceof Text) {\n        onText(node);\n      } else if (node instanceof Element) {\n        beginElement(node);\n      }\n\n      let nextNode: Node | null;\n      if ((nextNode = walker.firstChild())) {\n        node = nextNode;\n        continue;\n      } else if ((nextNode = walker.nextSibling())) {\n        node = nextNode;\n        continue;\n      }\n\n      while ((nextNode = walker.parentNode())) {\n        if (nextNode instanceof Element) {\n          endElement(nextNode);\n        }\n        if ((nextNode = walker.nextSibling())) {\n          break;\n        }\n      }\n      if (!nextNode && node instanceof Element) {\n        endElement(node);\n      }\n      node = nextNode;\n    }\n\n    this.segments = segments.filter((s) => s.text.length > 0);\n    this.__text = this.htmlRoot.textContent ?? \"\";\n    this.__htmlText = this.htmlRoot.innerHTML;\n    this.layout();\n  }\n\n  layout() {\n    const result = layout(\n      this.segments,\n      this.layoutBounds,\n      this.wordWrap,\n      this.multiline\n    );\n    this.node.setRenderObjects(result.renderObjects, this.layoutBounds);\n  }\n}\n","import { vec2, mat2d } from \"gl-matrix\";\nimport { TextFormat, TextFormatAlign } from \"../../flash/text\";\nimport { RenderObject } from \"../../../internal/render2/RenderObject\";\nimport { preMultiplyAlpha } from \"../../../internal/math/color\";\nimport { rect } from \"../../../internal/math/rect\";\nimport { FontRegistry } from \"../FontRegistry\";\nimport { TextSegment } from \"./TextSegment\";\n\nexport interface LayoutResult {\n  bounds: rect;\n  renderObjects: RenderObject[];\n}\n\ninterface Glyph {\n  renderObjects: RenderObject[];\n  color: number;\n  align: TextFormatAlign;\n  size: number;\n  leading: number;\n  advance: number;\n  ascent: number;\n  descent: number;\n}\n\ninterface Line {\n  glyphs: Glyph[];\n  width: number;\n}\n\nexport function layout(\n  segments: TextSegment[],\n  bounds: rect,\n  wrap: boolean,\n  multiline: boolean\n): LayoutResult {\n  const lines = splitLines(segments, bounds, wrap, multiline);\n\n  const resultBounds = rect.create();\n  const resultObjects: RenderObject[] = [];\n  let y = 0;\n  for (const line of lines) {\n    const lineResult = layoutLine(line, y, bounds);\n    resultObjects.push(...lineResult.renderObjects);\n    rect.union(resultBounds, resultBounds, lineResult.bounds);\n    y += lineResult.bounds[3];\n  }\n\n  return { bounds: resultBounds, renderObjects: resultObjects };\n}\n\nfunction fontSize(format: TextFormat) {\n  // http://www.moock.org/blog/archives/000284.html\n  return Math.min(127, format.size);\n}\n\nfunction placeholderGlyph(format: TextFormat): Glyph {\n  return {\n    renderObjects: [],\n    color: format.color,\n    align: format.align,\n    size: fontSize(format),\n    leading: format.leading,\n    advance: fontSize(format),\n    ascent: fontSize(format),\n    descent: 0,\n  };\n}\n\nfunction resolveGlyph(format: TextFormat, char: string): Glyph {\n  const font = FontRegistry.instance.resolve(\n    format.font,\n    format.italic,\n    format.bold\n  );\n  if (!font) {\n    return placeholderGlyph(format);\n  }\n  const index = font.charMap.get(char);\n  if (index == null) {\n    return placeholderGlyph(format);\n  }\n\n  return {\n    renderObjects: font.glyphs[index].renderObjects,\n    color: format.color,\n    align: format.align,\n    size: fontSize(format),\n    leading: format.leading,\n    advance: (font.layout?.advances[index] ?? 0) * fontSize(format),\n    ascent: font.layout?.ascent ?? 0,\n    descent: font.layout?.descent ?? 0,\n  };\n}\n\nfunction splitLines(\n  segments: TextSegment[],\n  bounds: rect,\n  wrap: boolean,\n  multiline: boolean\n): Line[] {\n  let currentLine: Line = { glyphs: [], width: 0 };\n  const lines = [currentLine];\n\n  for (const { format, text } of segments) {\n    for (const char of text) {\n      if (multiline && char === \"\\n\") {\n        currentLine = { glyphs: [], width: 0 };\n        lines.push(currentLine);\n        continue;\n      }\n\n      const glyph = resolveGlyph(format, char);\n      const advance = glyph.advance;\n      if (wrap && currentLine.width + advance > bounds[2]) {\n        currentLine = { glyphs: [], width: 0 };\n        lines.push(currentLine);\n      }\n      currentLine.glyphs.push(glyph);\n      currentLine.width += advance;\n    }\n  }\n  return lines;\n}\n\nfunction layoutLine(line: Line, y: number, bounds: rect): LayoutResult {\n  if (line.glyphs.length === 0) {\n    return { bounds: rect.create(), renderObjects: [] };\n  }\n\n  const boundsX = bounds[0] + 2;\n  const boundsWidth = bounds[2] - 4;\n\n  const alignment = line.glyphs[0].align;\n  let spacing: number, x: number;\n  switch (alignment) {\n    case TextFormatAlign.RIGHT:\n      spacing = 0;\n      x = boundsX + boundsWidth - line.width;\n      break;\n    case TextFormatAlign.CENTER:\n      spacing = 0;\n      x = boundsX + (boundsWidth - line.width) / 2;\n      break;\n    case TextFormatAlign.JUSTIFY:\n      spacing =\n        line.glyphs.length > 0\n          ? boundsX + (boundsWidth - line.width) / (line.glyphs.length - 1)\n          : 0;\n      x = 0;\n      break;\n    default:\n      spacing = 0;\n      x = boundsX;\n      break;\n  }\n\n  interface GlyphInstance {\n    renderObject: RenderObject;\n    color: number;\n    transform: mat2d;\n  }\n\n  const instances: GlyphInstance[] = [];\n\n  let baseline = 0;\n  let leading = 0;\n  for (const glyph of line.glyphs) {\n    baseline = Math.max(baseline, glyph.ascent * glyph.size);\n  }\n  for (const glyph of line.glyphs) {\n    leading = Math.max(\n      leading,\n      baseline + glyph.descent * glyph.size + glyph.leading\n    );\n  }\n\n  const v = vec2.create();\n  for (const g of line.glyphs) {\n    const transform = mat2d.create();\n    mat2d.fromTranslation(transform, [x, y + baseline]);\n    mat2d.scale(transform, transform, [g.size / 1024, g.size / 1024]);\n\n    const color = preMultiplyAlpha(g.color);\n\n    for (const renderObject of g.renderObjects) {\n      instances.push({\n        renderObject,\n        color,\n        transform,\n      });\n    }\n    x += g.advance + spacing;\n  }\n\n  return {\n    bounds: rect.fromValues(0, y, x, y + leading),\n    renderObjects: RenderObject.merge(\"text\", instances),\n  };\n}\n","import { mat2d, vec2 } from \"gl-matrix\";\nimport { CharacterInstance } from \"../../../internal/character/CharacterInstance\";\nimport { rect } from \"../../../internal/math/rect\";\nimport type { DisplayObjectContainer } from \"./DisplayObjectContainer\";\nimport type { Stage } from \"./Stage\";\nimport { EventDispatcher } from \"../events/EventDispatcher\";\nimport { Event } from \"../events/Event\";\nimport { Transform } from \"../geom/Transform\";\nimport { Point } from \"../geom/Point\";\nimport { BitmapFilter } from \"../filters/BitmapFilter\";\nimport { SceneNode, roundTwips } from \"../../../internal/render2/SceneNode\";\n\nconst tmpRect = rect.create();\nconst tmpVec2 = vec2.create();\n\ninterface CharacterInit<T> {\n  fn: (char: T) => void;\n}\nlet charInit: CharacterInit<any> | null = null;\n\nexport class DisplayObject extends EventDispatcher {\n  private __parent!: DisplayObjectContainer | null;\n  __character!: CharacterInstance | null;\n  __depth!: number;\n  __clipDepth!: number;\n  transform!: Transform;\n  name!: string;\n  private __mask!: DisplayObject | null;\n  private __maskRefs!: number;\n  private __filters!: BitmapFilter[];\n\n  __node!: SceneNode;\n\n  static __initChar<T>(fn: () => T, init: (char: T) => void): T {\n    charInit = { fn: init };\n    return fn();\n  }\n\n  // @ts-ignore\n  constructor() {\n    const initChar = charInit;\n    charInit = null;\n    super();\n    initChar?.fn(this);\n  }\n\n  __preInit() {\n    this.__character = null;\n    this.__depth = -1;\n    this.__clipDepth = -1;\n    this.__parent = null;\n    this.name = \"\";\n    this.__mask = null;\n    this.__maskRefs = 0;\n    this.__filters = [];\n\n    this.__node = new SceneNode(this);\n    this.transform = new Transform();\n    this.transform.__setNode(this.__node);\n    super.__preInit();\n  }\n\n  get visible() {\n    return this.__node.visible;\n  }\n  set visible(value) {\n    this.__node.visible = value;\n  }\n\n  get parent() {\n    return this.__parent;\n  }\n  set parent(value) {\n    const oldStage = this.stage;\n    this.__parent = value;\n    const newStage = this.stage;\n\n    if (newStage !== oldStage) {\n      if (newStage) {\n        newStage.__displayListDirty = true;\n        this.__onAddedToStage(newStage);\n      } else if (oldStage) {\n        this.__onRemovedFromStage(oldStage);\n      }\n    }\n    this.__setEventParent(this.parent);\n  }\n\n  get stage(): Stage | null {\n    return this.parent?.stage ?? null;\n  }\n\n  get mask() {\n    return this.__mask;\n  }\n\n  set mask(value) {\n    if (this.__mask) {\n      this.__mask.__maskRefs--;\n      this.__mask.__node.isMask = this.__mask.__maskRefs > 0;\n    }\n\n    this.__mask = value;\n    this.__node.mask = value?.__node ?? null;\n    this.__node.markRenderDirty();\n\n    if (this.__mask) {\n      this.__mask.__maskRefs++;\n      this.__mask.__node.isMask = this.__mask.__maskRefs > 0;\n    }\n  }\n\n  get filters() {\n    return this.__filters;\n  }\n\n  set filters(value) {\n    this.__filters = value;\n    this.__node.filters = value\n      .map((f) => f.__filter)\n      .filter((f) => f.filter.isEffective(f));\n    this.__node.markRenderDirty();\n  }\n\n  get cacheAsBitmap() {\n    return this.__node.cacheAsBitmap || this.__node.filters.length > 0;\n  }\n  set cacheAsBitmap(value) {\n    this.__node.cacheAsBitmap = value;\n  }\n\n  get x(): number {\n    return this.__node.transformLocal[4];\n  }\n  set x(value: number) {\n    value = roundTwips(value);\n    if (this.__node.transformLocal[4] !== value) {\n      this.__node.transformLocal[4] = value;\n      this.__node.markLayoutDirty();\n    }\n  }\n\n  get y(): number {\n    return this.__node.transformLocal[5];\n  }\n  set y(value: number) {\n    value = roundTwips(value);\n    if (this.__node.transformLocal[5] !== value) {\n      this.__node.transformLocal[5] = value;\n      this.__node.markLayoutDirty();\n    }\n  }\n\n  get scaleX(): number {\n    return this.__node.transformLocal[0];\n  }\n  set scaleX(value: number) {\n    if (this.__node.transformLocal[0] !== value) {\n      this.__node.transformLocal[0] = value;\n      this.__node.markLayoutDirty();\n    }\n  }\n\n  get scaleY(): number {\n    return this.__node.transformLocal[3];\n  }\n  set scaleY(value: number) {\n    if (this.__node.transformLocal[3] !== value) {\n      this.__node.transformLocal[3] = value;\n      this.__node.markLayoutDirty();\n    }\n  }\n\n  get rotation(): number {\n    const angle = Math.atan2(\n      this.__node.transformLocal[1],\n      this.__node.transformLocal[3]\n    );\n    return (angle * 180) / Math.PI;\n  }\n  set rotation(value: number) {\n    const rotation = this.rotation;\n    const delta = ((value - rotation) / 180) * Math.PI;\n    if (delta !== 0) {\n      mat2d.rotate(\n        this.__node.transformLocal,\n        this.__node.transformLocal,\n        delta\n      );\n      this.__node.markLayoutDirty();\n    }\n  }\n\n  get width(): number {\n    this.__node.ensureLayout();\n    return Math.abs(this.__node.boundsLocal[2] * this.__node.transformLocal[0]);\n  }\n  set width(value: number) {\n    this.__node.ensureLayout();\n    let scaleX =\n      this.__node.boundsLocal[2] === 0 ? 1 : value / this.__node.boundsLocal[2];\n    if (this.__node.transformLocal[0] !== 0) {\n      scaleX *= Math.sign(this.__node.transformLocal[0]);\n    }\n    if (this.__node.transformLocal[0] !== scaleX) {\n      this.__node.transformLocal[0] = scaleX;\n      this.__node.markLayoutDirty();\n    }\n  }\n\n  get height(): number {\n    this.__node.ensureLayout();\n    return this.__node.boundsLocal[3] * this.__node.transformLocal[3];\n  }\n  set height(value: number) {\n    this.__node.ensureLayout();\n    let scaleY =\n      this.__node.boundsLocal[3] === 0 ? 1 : value / this.__node.boundsLocal[3];\n    if (this.__node.transformLocal[3] !== 0) {\n      scaleY *= Math.sign(this.__node.transformLocal[3]);\n    }\n    if (this.__node.transformLocal[3] !== scaleY) {\n      this.__node.transformLocal[3] = scaleY;\n      this.__node.markLayoutDirty();\n    }\n  }\n\n  get mouseX(): number {\n    const stage = this.stage;\n    if (!stage) {\n      return 0;\n    }\n    this.__globalToLocal(tmpVec2, stage.__mousePosition, true);\n    return tmpVec2[0];\n  }\n\n  get mouseY(): number {\n    const stage = this.stage;\n    if (!stage) {\n      return 0;\n    }\n    this.__globalToLocal(tmpVec2, stage.__mousePosition, true);\n    return tmpVec2[1];\n  }\n\n  __globalToLocal(out: vec2, pt: vec2, ensure: boolean) {\n    if (ensure) {\n      this.__node.ensureLayout();\n    }\n    vec2.transformMat2d(out, pt, this.__node.transformWorldInvert);\n  }\n\n  globalToLocal(point: Point): Point {\n    const local = new Point();\n    this.__globalToLocal(local.__value, point.__value, true);\n    return local;\n  }\n\n  hitTestPoint(x: number, y: number, shapeFlag = false): boolean {\n    if (!this.visible) {\n      return false;\n    }\n    this.__node.ensureLayout();\n    vec2.set(tmpVec2, x, y);\n    return this.__node.hitTest(tmpVec2, shapeFlag);\n  }\n\n  hitTestObject(obj: DisplayObject): boolean {\n    this.__node.ensureLayout();\n    obj.__node.ensureLayout();\n    return rect.intersects(obj.__node.boundsWorld, this.__node.boundsWorld);\n  }\n\n  __initFrame(stage: Stage) {}\n\n  __onRender() {}\n\n  __onAddedToStage(stage: Stage) {\n    this.dispatchEvent(new Event(Event.ADDED_TO_STAGE, false, false));\n  }\n\n  __onRemovedFromStage(stage: Stage) {\n    this.dispatchEvent(new Event(Event.REMOVED_FROM_STAGE, false, false));\n  }\n}\n","import { DisplayObject } from \"./DisplayObject\";\nimport { InteractiveObject } from \"./InteractiveObject\";\nimport { Stage } from \"./Stage\";\n\nexport class DisplayObjectContainer extends InteractiveObject {\n  __children!: DisplayObject[];\n\n  __preInit() {\n    this.__children = [];\n    super.__preInit();\n  }\n\n  get numChildren(): number {\n    return this.__children.length;\n  }\n\n  addChild(child: DisplayObject) {\n    child.parent?.removeChild(child);\n\n    this.__children.push(child);\n    child.parent = this;\n    child.__node.setParent(this.__node, this.__node.children.length);\n    return child;\n  }\n\n  addChildAt(child: DisplayObject, index: number) {\n    child.parent?.removeChild(child);\n\n    this.__children.splice(index, 0, child);\n    child.parent = this;\n    child.__node.setParent(this.__node, index);\n    return child;\n  }\n\n  getChildByName(name: string) {\n    return this.__children.find((c) => c.name === name) ?? null;\n  }\n\n  getChildAt(index: number) {\n    return this.__children[index] ?? null;\n  }\n\n  removeChild(child: DisplayObject) {\n    const i = this.__children.indexOf(child);\n    if (i < 0) {\n      return null;\n    }\n    this.__children.splice(i, 1);\n    child.parent = null;\n    child.__node.setParent(null, 0);\n    return child;\n  }\n\n  removeChildAt(index: number) {\n    const child = this.__children.splice(index, 1)[0] ?? null;\n    if (child) {\n      child.parent = null;\n      child.__node.setParent(null, 0);\n    }\n    return child;\n  }\n\n  removeChildren(beginIndex = 0, endIndex = this.__children.length) {\n    const removedChildren = this.__children.splice(\n      beginIndex,\n      endIndex - beginIndex\n    );\n    for (const child of removedChildren) {\n      child.parent = null;\n      child.__node.setParent(null, 0);\n    }\n  }\n\n  contains(child: DisplayObject) {\n    return this.__children.includes(child);\n  }\n\n  __onAddedToStage(stage: Stage) {\n    for (const child of this.__children) {\n      child.__onAddedToStage(stage);\n    }\n    super.__onAddedToStage(stage);\n  }\n\n  __onRemovedFromStage(stage: Stage) {\n    super.__onRemovedFromStage(stage);\n    for (const child of this.__children) {\n      child.__onRemovedFromStage(stage);\n    }\n  }\n\n  __onRender() {\n    super.__onRender();\n    for (const child of this.__children) {\n      child.__onRender();\n    }\n  }\n}\n","import { AVMObject } from \"../../__internal/avm2/AVMObject\";\nimport { SceneNode } from \"../../../internal/render2/SceneNode\";\nimport { preMultiplyAlpha } from \"../../../internal/math/color\";\nimport { RenderObject } from \"../../../internal/render2/RenderObject\";\nimport { rect } from \"../../../internal/math/rect\";\n\nexport class Graphics extends AVMObject {\n  private __x = 0;\n  private __y = 0;\n  private __lineThickness = -1;\n  private __lineColor = 0xff000000;\n  private readonly __bounds = rect.create();\n  private readonly __renderObjects: RenderObject[] = [];\n\n  constructor(readonly __node: SceneNode) {\n    super();\n  }\n\n  clear() {\n    this.__x = 0;\n    this.__y = 0;\n    this.__lineThickness = -1;\n    this.__lineColor = 0xff000000;\n    rect.clear(this.__bounds);\n    this.__renderObjects.length = 0;\n    this.__node.setRenderObjects([], this.__bounds);\n  }\n\n  lineStyle(thickness = NaN, color = 0, alpha = 1.0) {\n    this.__lineThickness = isNaN(thickness) ? -1 : thickness;\n    this.__lineColor = preMultiplyAlpha(\n      color + Math.floor(alpha * 0xff) * 0x1000000\n    );\n  }\n\n  moveTo(x: number, y: number) {\n    this.__x = x;\n    this.__y = y;\n  }\n\n  lineTo(x: number, y: number) {\n    const line = RenderObject.line(\n      this.__x,\n      this.__y,\n      x,\n      y,\n      this.__lineThickness,\n      this.__lineColor\n    );\n    this.__renderObjects.push(line);\n    rect.union(this.__bounds, this.__bounds, line.bounds);\n    this.__node.setRenderObjects(this.__renderObjects.slice(), this.__bounds);\n\n    this.__x = x;\n    this.__y = y;\n  }\n}\n","import { DisplayObject } from \"./DisplayObject\";\n\nexport abstract class InteractiveObject extends DisplayObject {\n  constructor() {\n    super();\n  }\n\n  get __isPointerCursor(): boolean {\n    return this.parent ? this.parent.__isPointerCursor : false;\n  }\n\n  tabEnabled = false;\n\n  tabIndex = -1;\n}\n","import { DisplayObject } from \"./DisplayObject\";\nimport { MorphShapeInstance } from \"../../../internal/character/MorphShapeInstance\";\n\nexport class MorphShape extends DisplayObject {\n  static __character?: MorphShapeInstance;\n\n  declare __character: MorphShapeInstance | null;\n\n  constructor() {\n    super();\n\n    this.__character =\n      (this.constructor as typeof MorphShape).__character ?? null;\n    this.__character?.applyTo(this);\n  }\n\n  private ___ratio = 0;\n\n  get __ratio() {\n    return this.___ratio;\n  }\n\n  set __ratio(value) {\n    this.___ratio = value;\n    this.__character?.applyTo(this);\n  }\n}\n","import { Sprite } from \"./Sprite\";\nimport { runFrame, enqueueFrameScript } from \"./frame\";\nimport { Stage } from \"./Stage\";\n\nexport type MovieClipT<T> = MovieClip & T;\n\nexport class MovieClip extends Sprite {\n  __lastFrame = 1;\n  __constructed = false;\n  __frameScripts = new Map<number, () => void>();\n  __scriptFrame = 0;\n\n  currentFrame = 1;\n\n  isPlaying = true;\n\n  constructor() {\n    super();\n  }\n\n  get totalFrames(): number {\n    return this.__character?.numFrames ?? 1;\n  }\n\n  __initFrame(stage: Stage) {\n    super.__initFrame(stage);\n\n    if (this.isPlaying && this.__constructed) {\n      let newFrame = this.currentFrame + 1;\n      if (newFrame > this.totalFrames || newFrame < 1) {\n        newFrame = 1;\n      }\n      if (this.currentFrame !== newFrame) {\n        this.currentFrame = newFrame;\n        stage.__constructionQueue.push(this);\n      }\n    } else if (!this.__constructed) {\n      stage.__constructionQueue.push(this);\n    }\n  }\n\n  __constructFrame() {\n    if (this.__lastFrame !== this.currentFrame) {\n      this.__character?.applyTo(this, this.__lastFrame, this.currentFrame);\n      this.__lastFrame = this.currentFrame;\n    }\n    this.__constructed = true;\n\n    if (this.__scriptFrame !== this.currentFrame) {\n      enqueueFrameScript(() => this.__runFrameScript());\n    }\n  }\n\n  __runFrameScript() {\n    if (this.__scriptFrame !== this.currentFrame) {\n      this.__scriptFrame = this.currentFrame;\n      const frameScript = this.__frameScripts.get(this.__scriptFrame);\n      frameScript?.();\n    }\n  }\n\n  addFrameScript(...args: unknown[]) {\n    for (let i = 0; i < args.length; i += 2) {\n      this.__frameScripts.set(\n        (args[i] as number) + 1,\n        args[i + 1] as () => void\n      );\n    }\n  }\n\n  __resolveFrame(frameId: unknown): number | null {\n    const frameNumber = Number(frameId);\n    if (!isNaN(frameNumber)) {\n      return frameNumber;\n    }\n    const frame = this.__character?.frames?.find((f) => f.label === frameId);\n    if (frame) {\n      return frame.frame;\n    }\n    return null;\n  }\n\n  gotoAndPlay(frame: unknown) {\n    const frameNumber = this.__resolveFrame(frame);\n    if (frameNumber) {\n      this.currentFrame = frameNumber;\n    }\n    this.isPlaying = true;\n\n    const stage = this.stage;\n    if (stage) {\n      stage.__constructionQueue.push(this);\n      runFrame(false, stage);\n    } else {\n      this.__constructFrame();\n      this.__runFrameScript();\n    }\n  }\n\n  gotoAndStop(frame: unknown) {\n    const frameNumber = this.__resolveFrame(frame);\n    if (frameNumber) {\n      this.currentFrame = frameNumber;\n    }\n    this.isPlaying = false;\n\n    const stage = this.stage;\n    if (stage) {\n      stage.__constructionQueue.push(this);\n      runFrame(false, stage);\n    } else {\n      this.__constructFrame();\n      this.__runFrameScript();\n    }\n  }\n\n  play() {\n    this.isPlaying = true;\n  }\n\n  stop() {\n    this.isPlaying = false;\n  }\n\n  __onAddedToStage(stage: Stage) {\n    super.__onAddedToStage(stage);\n    stage.__constructionQueue.push(this);\n  }\n}\n","import { DisplayObject } from \"./DisplayObject\";\nimport { ShapeInstance } from \"../../../internal/character/ShapeInstance\";\nimport { Graphics } from \"./Graphics\";\n\nexport class Shape extends DisplayObject {\n  static __character?: ShapeInstance;\n\n  declare __character: ShapeInstance | null;\n\n  readonly graphics: Graphics;\n\n  constructor() {\n    super();\n\n    this.graphics = new Graphics(this.__node);\n    this.__character = (this.constructor as typeof Shape).__character ?? null;\n    this.__character?.applyTo(this);\n  }\n}\n","import { DisplayObjectContainer } from \"./DisplayObjectContainer\";\nimport { SpriteInstance } from \"../../../internal/character/SpriteInstance\";\nimport { Graphics } from \"./Graphics\";\nimport { SoundContext } from \"../media/context\";\n\nexport class Sprite extends DisplayObjectContainer {\n  static __character?: SpriteInstance;\n\n  declare __character: SpriteInstance | null;\n\n  readonly graphics: Graphics;\n  __soundContext!: SoundContext;\n\n  constructor() {\n    super();\n\n    this.graphics = new Graphics(this.__node);\n  }\n\n  __preInit() {\n    super.__preInit();\n    this.__soundContext = new SoundContext();\n    this.__character = (this.constructor as typeof Sprite).__character ?? null;\n    this.__character?.applyTo(this, 1, 1);\n  }\n\n  buttonMode = false;\n\n  get __isPointerCursor() {\n    return this.buttonMode || super.__isPointerCursor;\n  }\n}\n","import type { Stage } from \"./Stage\";\nimport type { DisplayObject } from \"./DisplayObject\";\nimport type { MovieClip } from \"./MovieClip\";\nimport { Event } from \"../events/Event\";\nimport { __broadcastDispatcher } from \"../events/EventDispatcher\";\nimport { SceneNode } from \"../../../internal/render2/SceneNode\";\n\nconst frameScriptQueue: Array<() => void> = [];\n\nexport function enqueueFrameScript(script: () => void) {\n  frameScriptQueue.push(script);\n}\n\n// ref: https://github.com/mozilla/shumway/blob/16451d8836fa85f4b16eeda8b4bda2fa9e2b22b0/src/flash/display/DisplayObject.ts#L422\nexport function runFrame(isRoot: boolean, stage: Stage) {\n  if (isRoot) {\n    stage.__ensureDisplayList();\n    for (const o of stage.__displayList.slice()) {\n      o.__initFrame(stage);\n    }\n\n    __broadcastDispatcher.dispatchEvent(\n      new Event(Event.ENTER_FRAME, false, false)\n    );\n  }\n\n  while (stage.__constructionQueue.length > 0) {\n    const queue = stage.__constructionQueue.slice();\n    stage.__constructionQueue.length = 0;\n    for (const o of queue) {\n      o.__constructFrame();\n    }\n  }\n\n  const scripts = frameScriptQueue.slice();\n  frameScriptQueue.length = 0;\n  for (const script of scripts) {\n    script();\n  }\n}\n","import { vec2 } from \"gl-matrix\";\n\nexport class Canvas {\n  readonly container = document.createElement(\"div\");\n  readonly element = document.createElement(\"canvas\");\n  #cursor = \"\";\n\n  constructor(readonly width: number, readonly height: number) {\n    this.container.style.setProperty(\"width\", `${width}px`);\n    this.container.style.setProperty(\"height\", `${height}px`);\n    this.container.style.setProperty(\"position\", \"relative\");\n\n    this.element.tabIndex = 0;\n    this.element.style.setProperty(\"outline\", \"none\", \"important\");\n    this.element.style.setProperty(\"position\", \"absolute\");\n    this.element.style.setProperty(\"width\", `${width}px`);\n    this.element.style.setProperty(\"height\", `${height}px`);\n    this.element.width = width * window.devicePixelRatio;\n    this.element.height = height * window.devicePixelRatio;\n\n    this.container.appendChild(this.element);\n  }\n\n  get cursor(): string {\n    return this.#cursor;\n  }\n\n  set cursor(value: string) {\n    if (value !== this.#cursor) {\n      this.element.style.cursor = value;\n      this.#cursor = value;\n    }\n  }\n\n  resolveCoords(out: vec2, clientX: number, clientY: number) {\n    const rect = this.element.getBoundingClientRect();\n    out[0] = clientX - rect.left;\n    out[1] = clientY - rect.top;\n  }\n}\n","import { mat2d, vec4, vec2 } from \"gl-matrix\";\nimport { RenderObject } from \"./RenderObject\";\nimport { rect } from \"../math/rect\";\nimport { multiplyColorTransform } from \"../math/color\";\nimport { Texture } from \"./gl/Texture\";\nimport { FilterInstance } from \"./filter/Filter\";\nimport { CachedRender } from \"./CachedRender\";\n\nexport interface Transform {\n  view: mat2d;\n  colorMul: vec4;\n  colorAdd: vec4;\n  renderMask: unknown;\n  useMask: unknown[];\n}\n\nexport type DeferredRender =\n  | DeferredRenderObject\n  | DeferredRenderCache\n  | DeferredRenderTexture\n  | DeferredRenderFilter;\n\nexport interface DeferredRenderObject {\n  transform: Transform;\n  object: RenderObject;\n}\n\nexport interface DeferredRenderCache {\n  transform: Transform;\n  cache: {\n    texture: Texture;\n    bounds: rect;\n    view: mat2d;\n    then: (render: CachedRender) => void;\n  };\n}\n\nexport interface DeferredRenderTexture {\n  transform: Transform;\n  texture: {\n    bounds: rect;\n    paddings: vec2;\n    scale: vec2;\n    translate: vec2;\n    fn: (ctx: RenderContext) => void;\n    then: (ctx: RenderContext, texture: Texture, bounds: rect) => void;\n  };\n}\n\nexport interface DeferredRenderFilter {\n  transform: Transform;\n  filter: {\n    texture: Texture;\n    bounds: rect;\n    instance: FilterInstance;\n    then: (ctx: RenderContext, texture: Texture, bounds: rect) => void;\n  };\n}\n\nconst colorMulIdentity = vec4.fromValues(1, 1, 1, 1);\nconst colorAddIdentity = vec4.fromValues(0, 0, 0, 0);\n\nexport class RenderContext {\n  readonly viewport: rect | null;\n  readonly renders: DeferredRender[] = [];\n  readonly transformStack: Transform[] = [];\n  readonly allTransforms: Transform[] = [];\n\n  get transform(): Transform {\n    return this.transformStack[this.transformStack.length - 1];\n  }\n  set transform(transform: Transform) {\n    this.transformStack[this.transformStack.length - 1] = transform;\n  }\n\n  get bounds(): rect {\n    const bounds = rect.create();\n    const renderBounds = rect.create();\n    for (const render of this.renders) {\n      if (\"object\" in render) {\n        rect.apply(renderBounds, render.object.bounds, render.transform.view);\n      } else if (\"texture\" in render) {\n        rect.copy(renderBounds, render.texture.bounds);\n        renderBounds[0] -= render.texture.paddings[0];\n        renderBounds[1] -= render.texture.paddings[1];\n        renderBounds[2] += render.texture.paddings[0] * 2;\n        renderBounds[3] += render.texture.paddings[1] * 2;\n        rect.apply(renderBounds, renderBounds, render.transform.view);\n      } else if (\"filter\" in render) {\n        rect.apply(renderBounds, render.filter.bounds, render.transform.view);\n      }\n      rect.union(bounds, bounds, renderBounds);\n    }\n    return bounds;\n  }\n\n  constructor(viewport: rect | null) {\n    this.transformStack.push({\n      view: mat2d.identity(mat2d.create()),\n      colorMul: vec4.set(vec4.create(), 1, 1, 1, 1),\n      colorAdd: vec4.set(vec4.create(), 0, 0, 0, 0),\n      renderMask: null,\n      useMask: [],\n    });\n    this.allTransforms.push(this.transformStack[0]);\n    this.viewport = viewport;\n  }\n\n  pushTransform(\n    view: mat2d,\n    opts?: Partial<\n      Pick<Transform, \"colorAdd\" | \"colorMul\" | \"useMask\" | \"renderMask\">\n    >\n  ) {\n    const transform = this.transformStack[this.transformStack.length - 1];\n    const nodeTransform: Transform = {\n      view: mat2d.create(),\n      colorAdd: vec4.create(),\n      colorMul: vec4.create(),\n      renderMask: opts?.renderMask ?? transform.renderMask,\n      useMask: transform.useMask.slice(),\n    };\n    mat2d.multiply(nodeTransform.view, transform.view, view);\n    multiplyColorTransform(\n      nodeTransform.colorMul,\n      nodeTransform.colorAdd,\n      transform.colorMul,\n      transform.colorAdd,\n      opts?.colorMul ?? colorMulIdentity,\n      opts?.colorAdd ?? colorAddIdentity\n    );\n    if (opts?.useMask) {\n      nodeTransform.useMask.push(opts.useMask);\n    }\n    this.transformStack.push(nodeTransform);\n    this.allTransforms.push(nodeTransform);\n  }\n\n  dupTransform() {\n    const transform = this.transform;\n    const nodeTransform: Transform = {\n      view: mat2d.clone(transform.view),\n      colorAdd: vec4.clone(transform.colorAdd),\n      colorMul: vec4.clone(transform.colorMul),\n      renderMask: transform.renderMask,\n      useMask: transform.useMask.slice(),\n    };\n    this.transformStack.push(nodeTransform);\n    this.allTransforms.push(nodeTransform);\n  }\n\n  popTransform() {\n    this.transformStack.pop();\n  }\n\n  renderContext(ctx: RenderContext) {\n    const { view, colorMul, colorAdd } = this.transform;\n    for (const transform of ctx.allTransforms) {\n      mat2d.multiply(transform.view, view, transform.view);\n      multiplyColorTransform(\n        transform.colorMul,\n        transform.colorAdd,\n        colorMul,\n        colorAdd,\n        transform.colorMul,\n        transform.colorAdd\n      );\n      this.allTransforms.push(transform);\n    }\n    this.renders.push(...ctx.renders);\n  }\n\n  renderObject(object: RenderObject) {\n    this.renders.push({\n      transform: this.transform,\n      object,\n    });\n  }\n\n  renderCache(\n    texture: Texture,\n    bounds: rect,\n    baseViewMat: mat2d,\n    then: (render: CachedRender) => void\n  ) {\n    // Extract correct view matrix for rendering cached texture.\n    const view = mat2d.invert(mat2d.create(), baseViewMat);\n    mat2d.multiply(view, view, this.transform.view);\n    this.renders.push({\n      transform: this.transform,\n      cache: { view, texture, bounds, then },\n    });\n  }\n\n  renderTexture(\n    bounds: rect,\n    paddings: vec2,\n    fn: (ctx: RenderContext) => void,\n    then: (ctx: RenderContext, texture: Texture, bounds: rect) => void\n  ) {\n    this.dupTransform();\n\n    const viewMatrix = this.transform.view;\n    mat2d.translate(viewMatrix, viewMatrix, [bounds[0], bounds[1]]);\n\n    const scale = vec2.fromValues(\n      Math.abs(viewMatrix[0]),\n      Math.abs(viewMatrix[3])\n    );\n    if (scale[0] !== 0 && scale[1] !== 0) {\n      mat2d.scale(viewMatrix, viewMatrix, [1 / scale[0], 1 / scale[1]]);\n    }\n    mat2d.translate(viewMatrix, viewMatrix, [-paddings[0], -paddings[1]]);\n\n    const translate = vec2.fromValues(viewMatrix[4], viewMatrix[5]);\n    viewMatrix[4] = Math.floor(viewMatrix[4]);\n    viewMatrix[5] = Math.floor(viewMatrix[5]);\n\n    this.renders.push({\n      transform: this.transform,\n      texture: {\n        bounds: rect.copy(rect.create(), bounds),\n        paddings,\n        scale,\n        translate,\n        fn,\n        then,\n      },\n    });\n    this.popTransform();\n  }\n\n  renderFilter(\n    texture: Texture,\n    bounds: rect,\n    instance: FilterInstance,\n    then: (ctx: RenderContext, texture: Texture, bounds: rect) => void\n  ) {\n    this.renders.push({\n      transform: this.transform,\n      filter: {\n        texture,\n        bounds,\n        instance,\n        then,\n      },\n    });\n  }\n}\n","interface ListenerSlot<T extends (...args: unknown[]) => void> {\n  disabled: boolean;\n  handler: T;\n}\n\nexport class Signal<T extends (...args: unknown[]) => void> {\n  private listeners: ListenerSlot<T>[] = [];\n\n  subscribe(handler: T) {\n    this.listeners.push({ disabled: false, handler });\n  }\n\n  unsubscribe(handler: T) {\n    for (const l of this.listeners) {\n      if (l.handler === handler) {\n        l.disabled = true;\n      }\n    }\n    this.listeners = this.listeners.filter((h) => !h.disabled);\n  }\n\n  emit(...args: Parameters<T>) {\n    for (const { disabled, handler } of this.listeners) {\n      if (!disabled) {\n        handler(...args);\n      }\n    }\n  }\n}\n","import { vec4 } from \"gl-matrix\";\nimport { Signal } from \"../../signal\";\n\nexport class GLState {\n  readonly gl: WebGL2RenderingContext;\n  readonly contextLost = new Signal();\n  readonly resetRender = new Signal();\n\n  maxTextures = 1;\n  textureLimit = 16;\n  maxSamples = 0;\n  sampleLimit = 4;\n\n  readonly clearColor = vec4.fromValues(NaN, NaN, NaN, NaN);\n  readonly viewport = vec4.fromValues(NaN, NaN, NaN, NaN);\n  readonly bindings = new Map<GLenum, unknown>();\n  readonly textureUnits = new Map<number, WebGLTexture | null>();\n  activeTexture: GLenum = NaN;\n  vertexArray: WebGLVertexArrayObject | null = null;\n  program: WebGLProgram | null = null;\n  capacity: number = NaN;\n  readonly blendEquation: [GLenum, GLenum] = [NaN, NaN];\n  readonly blendFuncs: [GLenum, GLenum, GLenum, GLenum] = [NaN, NaN, NaN, NaN];\n\n  constructor(\n    readonly canvas: HTMLCanvasElement,\n    readonly attrs: WebGLContextAttributes\n  ) {\n    const gl = canvas.getContext(\"webgl2\", attrs);\n    if (!gl) {\n      throw new Error(\"Cannot create WebGL2 context\");\n    }\n    this.gl = gl;\n    canvas.addEventListener(\n      \"webglcontextlost\",\n      (e) => {\n        e.preventDefault();\n        this.contextLost.emit();\n      },\n      false\n    );\n    canvas.addEventListener(\n      \"webglcontextrestored\",\n      (e) => {\n        e.preventDefault();\n        this.reset();\n      },\n      false\n    );\n\n    this.reset();\n  }\n\n  reset() {\n    this.maxTextures = Math.min(\n      this.textureLimit,\n      this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)\n    );\n    this.maxSamples = Math.min(\n      this.sampleLimit,\n      this.gl.getParameter(this.gl.MAX_SAMPLES)\n    );\n    vec4.set(this.clearColor, NaN, NaN, NaN, NaN);\n    vec4.set(this.viewport, NaN, NaN, NaN, NaN);\n    this.bindings.clear();\n    this.textureUnits.clear();\n    this.activeTexture = NaN;\n    this.vertexArray = null;\n    this.program = null;\n    this.capacity = NaN;\n    this.blendEquation.fill(NaN);\n    this.blendFuncs.fill(NaN);\n  }\n\n  resetRenderState() {\n    this.reset();\n    this.resetRender.emit();\n  }\n\n  // FIXME: Disabled bound texture unit memorization since it's crashy on macOS.\n  // ref: https://stackoverflow.com/questions/34277156/webgl-on-osx-using-wrong-texture-in-all-browsers\n  bindTexture(unit: number, texture: WebGLTexture | null) {\n    this.gl.activeTexture(this.gl.TEXTURE0 + unit);\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n    this.textureUnits.set(unit, texture);\n  }\n\n  bindTextures(textures: (WebGLTexture | null)[]): GLenum[] {\n    return textures.map((tex, i) => {\n      this.bindTexture(i, tex);\n      return i;\n    });\n  }\n\n  bindBuffer(target: GLenum, buffer: WebGLBuffer | null) {\n    if (this.bindings.get(target) === buffer) {\n      return;\n    }\n    this.gl.bindBuffer(target, buffer);\n    this.bindings.set(target, buffer);\n  }\n\n  bindVertexArray(va: WebGLVertexArrayObject | null) {\n    if (this.vertexArray === va) {\n      return;\n    }\n    this.gl.bindVertexArray(va);\n    this.vertexArray = va;\n    this.bindings.clear();\n  }\n\n  bindRenderbuffer(target: GLenum, renderbuffer: WebGLRenderbuffer | null) {\n    if (this.bindings.get(target) === renderbuffer) {\n      return;\n    }\n    this.gl.bindRenderbuffer(target, renderbuffer);\n    this.bindings.set(target, renderbuffer);\n  }\n\n  bindFramebuffer(target: GLenum, framebuffer: WebGLFramebuffer | null) {\n    if (this.bindings.get(target) === framebuffer) {\n      return;\n    }\n    this.gl.bindFramebuffer(target, framebuffer);\n    this.bindings.set(target, framebuffer);\n    if (target === this.gl.FRAMEBUFFER) {\n      this.bindings.set(this.gl.FRAMEBUFFER, framebuffer);\n      this.bindings.set(this.gl.READ_FRAMEBUFFER, framebuffer);\n      this.bindings.set(this.gl.DRAW_FRAMEBUFFER, framebuffer);\n    } else if (target === this.gl.READ_FRAMEBUFFER) {\n      this.bindings.set(this.gl.FRAMEBUFFER, undefined);\n      this.bindings.set(this.gl.READ_FRAMEBUFFER, framebuffer);\n    } else if (target === this.gl.DRAW_FRAMEBUFFER) {\n      this.bindings.set(this.gl.FRAMEBUFFER, undefined);\n      this.bindings.set(this.gl.DRAW_FRAMEBUFFER, framebuffer);\n    }\n  }\n\n  useProgram(program: WebGLProgram | null) {\n    if (this.program === program) {\n      return;\n    }\n    this.gl.useProgram(program);\n    this.program = program;\n  }\n\n  setActiveTexture(texture: GLenum) {\n    if (this.activeTexture === texture) {\n      return;\n    }\n    this.gl.activeTexture(texture);\n    this.activeTexture = texture;\n  }\n\n  setClearColor(red: number, green: number, blue: number, alpha: number) {\n    if (vec4.equals(this.clearColor, [red, green, blue, alpha])) {\n      return;\n    }\n    this.gl.clearColor(red, green, blue, alpha);\n    vec4.set(this.clearColor, red, green, blue, alpha);\n  }\n\n  setViewport(x: number, y: number, width: number, height: number) {\n    if (vec4.equals(this.viewport, [x, y, width, height])) {\n      return;\n    }\n    this.gl.viewport(x, y, width, height);\n    vec4.set(this.viewport, x, y, width, height);\n  }\n\n  enable(cap: GLenum) {\n    if ((this.capacity | cap) === this.capacity) {\n      return;\n    }\n    this.gl.enable(cap);\n    this.capacity |= cap;\n  }\n\n  disable(cap: GLenum) {\n    if ((this.capacity & ~cap) === this.capacity) {\n      return;\n    }\n    this.gl.disable(cap);\n    this.capacity &= ~cap;\n  }\n\n  setBlendEquation(modeRGB: GLenum, modeAlpha: GLenum = modeRGB) {\n    if (\n      this.blendEquation[0] === modeRGB &&\n      this.blendEquation[1] === modeAlpha\n    ) {\n      return;\n    }\n    this.gl.blendEquationSeparate(modeRGB, modeAlpha);\n    this.blendEquation[0] = modeRGB;\n    this.blendEquation[1] = modeAlpha;\n  }\n\n  setBlendFunc(\n    srcRGB: GLenum,\n    dstRGB: GLenum,\n    srcAlpha: GLenum = srcRGB,\n    dstAlpha: GLenum = dstRGB\n  ) {\n    if (\n      this.blendFuncs[0] === srcRGB &&\n      this.blendFuncs[1] === dstRGB &&\n      this.blendFuncs[2] === srcAlpha &&\n      this.blendFuncs[3] === dstAlpha\n    ) {\n      return;\n    }\n    this.gl.blendFuncSeparate(srcRGB, dstRGB, srcAlpha, dstAlpha);\n    this.blendFuncs[0] = srcRGB;\n    this.blendFuncs[1] = dstRGB;\n    this.blendFuncs[2] = srcAlpha;\n    this.blendFuncs[3] = dstAlpha;\n  }\n}\n","import { GLState } from \"./GLState\";\n\nexport class Renderbuffer {\n  readonly width: number;\n  readonly height: number;\n\n  state: GLState | null = null;\n  renderbuffer: WebGLRenderbuffer | null = null;\n\n  constructor(\n    width: number,\n    height: number,\n    readonly type: \"depth\" | \"rgba\" | \"rgb\"\n  ) {\n    this.width = width;\n    this.height = height;\n  }\n\n  ensure(state: GLState) {\n    if (this.renderbuffer) {\n      return;\n    }\n    const gl = state.gl;\n\n    let glFormat: GLenum;\n    switch (this.type) {\n      case \"depth\":\n        glFormat = gl.DEPTH_COMPONENT16;\n        break;\n      case \"rgba\":\n        glFormat = gl.RGBA8;\n        break;\n      case \"rgb\":\n        glFormat = gl.RGB8;\n        break;\n    }\n\n    const rb = gl.createRenderbuffer();\n    state.bindRenderbuffer(gl.RENDERBUFFER, rb);\n    if (state.maxSamples > 0) {\n      gl.renderbufferStorageMultisample(\n        gl.RENDERBUFFER,\n        state.maxSamples,\n        glFormat,\n        this.width,\n        this.height\n      );\n    } else {\n      gl.renderbufferStorage(\n        gl.RENDERBUFFER,\n        glFormat,\n        this.width,\n        this.height\n      );\n    }\n\n    this.state = state;\n    this.renderbuffer = rb;\n\n    state.contextLost.subscribe(this.onContextLost);\n    state.resetRender.subscribe(this.onResetRender);\n  }\n\n  delete() {\n    if (!this.state) {\n      return;\n    }\n    this.state.gl.deleteRenderbuffer(this.renderbuffer);\n    this.state.contextLost.unsubscribe(this.onContextLost);\n    this.state.resetRender.unsubscribe(this.onResetRender);\n    this.state = null;\n    this.renderbuffer = null;\n  }\n\n  private onContextLost = () => {\n    if (this.state) {\n      this.state.contextLost.unsubscribe(this.onContextLost);\n      this.state.resetRender.unsubscribe(this.onResetRender);\n      this.state = null;\n    }\n    this.renderbuffer = null;\n  };\n\n  private onResetRender = () => {\n    this.delete();\n  };\n}\n","import { GLState } from \"./GLState\";\nimport { Texture } from \"./Texture\";\nimport { Renderbuffer } from \"./Renderbuffer\";\n\nexport class Framebuffer {\n  readonly colorAttachment: Texture | Renderbuffer;\n\n  state: GLState | null = null;\n  framebuffer: WebGLFramebuffer | null = null;\n\n  constructor(colorAttachment: Texture | Renderbuffer) {\n    this.colorAttachment = colorAttachment;\n  }\n\n  ensure(state: GLState) {\n    if (this.framebuffer) {\n      return;\n    }\n    const gl = state.gl;\n    this.colorAttachment.ensure(state);\n\n    const fb = gl.createFramebuffer();\n    state.bindFramebuffer(gl.DRAW_FRAMEBUFFER, fb);\n    if (this.colorAttachment instanceof Texture) {\n      gl.framebufferTexture2D(\n        gl.DRAW_FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_2D,\n        this.colorAttachment.texture,\n        0\n      );\n    } else {\n      gl.framebufferRenderbuffer(\n        gl.DRAW_FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.RENDERBUFFER,\n        this.colorAttachment.renderbuffer\n      );\n    }\n\n    this.state = state;\n    this.framebuffer = fb;\n\n    state.contextLost.subscribe(this.onContextLost);\n    state.resetRender.subscribe(this.onResetRender);\n  }\n\n  delete() {\n    if (!this.state) {\n      return;\n    }\n    this.state.gl.deleteFramebuffer(this.framebuffer);\n    this.state.contextLost.unsubscribe(this.onContextLost);\n    this.state.resetRender.unsubscribe(this.onResetRender);\n    this.state = null;\n    this.framebuffer = null;\n  }\n\n  private onContextLost = () => {\n    if (this.state) {\n      this.state.contextLost.unsubscribe(this.onContextLost);\n      this.state.resetRender.unsubscribe(this.onResetRender);\n      this.state = null;\n    }\n    this.framebuffer = null;\n  };\n\n  private onResetRender = () => {\n    this.delete();\n  };\n}\n","import { Texture } from \"./gl/Texture\";\nimport { Renderbuffer } from \"./gl/Renderbuffer\";\nimport { Framebuffer } from \"./gl/Framebuffer\";\nimport { TextureTarget, RenderbufferTarget } from \"./gl/targets\";\n\ninterface CacheItem<T> {\n  item: T;\n  insertAt: number;\n}\n\nexport class RenderPool {\n  private readonly texturePool = new Map<string, CacheItem<TextureTarget>[]>();\n  private readonly renderbufferPool = new Map<\n    string,\n    CacheItem<RenderbufferTarget>[]\n  >();\n\n  takeTexture(width: number, height: number): TextureTarget {\n    const key = `${width}:${height}`;\n\n    const items = this.texturePool.get(key) || [];\n    if (items.length === 0) {\n      const texture = Texture.size(width, height);\n      const framebuffer = new Framebuffer(texture);\n      items.push({ insertAt: +new Date(), item: { texture, framebuffer } });\n    }\n    return items.pop()!.item;\n  }\n\n  takeRenderbuffer(width: number, height: number): RenderbufferTarget {\n    const key = `${width}:${height}`;\n\n    const items = this.renderbufferPool.get(key) || [];\n    if (items.length === 0) {\n      const rb = new Renderbuffer(width, height, \"rgba\");\n      const framebuffer = new Framebuffer(rb);\n      items.push({\n        insertAt: +new Date(),\n        item: { renderbuffer: rb, framebuffer },\n      });\n    }\n    return items.pop()!.item;\n  }\n\n  returnTexture(target: TextureTarget) {\n    const key = `${target.texture.width}:${target.texture.height}`;\n    const items = this.texturePool.get(key) || [];\n    items.push({ insertAt: +new Date(), item: target });\n    this.texturePool.set(key, items);\n  }\n\n  returnRenderbuffer(target: RenderbufferTarget) {\n    const key = `${target.renderbuffer.width}:${target.renderbuffer.height}`;\n    const items = this.renderbufferPool.get(key) || [];\n    items.push({ insertAt: +new Date(), item: target });\n    this.renderbufferPool.set(key, items);\n  }\n\n  cleanLRU() {\n    const threshold = +new Date() - 60 * 1000;\n    for (const [key, items] of this.renderbufferPool) {\n      const toBeDeleted = items.filter((item) => item.insertAt < threshold);\n      for (const { item } of toBeDeleted) {\n        item.renderbuffer.delete();\n        item.framebuffer.delete();\n      }\n      this.renderbufferPool.set(\n        key,\n        items.filter((item) => !toBeDeleted.includes(item))\n      );\n    }\n    for (const [key, items] of this.texturePool) {\n      const toBeDeleted = items.filter((item) => item.insertAt < threshold);\n      for (const { item } of toBeDeleted) {\n        item.texture.delete();\n        item.framebuffer.delete();\n      }\n      this.texturePool.set(\n        key,\n        items.filter((item) => !toBeDeleted.includes(item))\n      );\n    }\n  }\n}\n","import { rect } from \"../math/rect\";\n\nconst padding = 1;\n\nexport class Atlas {\n  private x = 0;\n  private y = 0;\n  private rowHeight = 0;\n\n  constructor(readonly width: number, readonly height: number) {}\n\n  add(width: number, height: number): rect | null {\n    let x = this.x;\n    let y = this.y;\n\n    if (this.x + width > this.width) {\n      this.x = 0;\n      this.y += this.rowHeight + padding;\n      this.rowHeight = 0;\n\n      x = this.x;\n      y = this.y;\n    }\n    this.x += width;\n    if (this.x > this.width) {\n      return null;\n    }\n    this.x += padding;\n\n    this.rowHeight = Math.max(this.rowHeight, height);\n    if (this.y + this.rowHeight > this.height) {\n      return null;\n    }\n\n    return rect.fromValues(x, y, width, height);\n  }\n}\n","import { mat2d } from \"gl-matrix\";\nimport { rect } from \"../math/rect\";\nimport { RenderPool } from \"./RenderPool\";\nimport { TextureTarget } from \"./gl/targets\";\nimport { RenderObject } from \"./RenderObject\";\n\nexport class CachedRender {\n  private returned = false;\n\n  readonly renderObject: RenderObject;\n\n  constructor(\n    private readonly pool: RenderPool,\n    private readonly target: TextureTarget,\n    readonly view: mat2d,\n    readonly bounds: rect\n  ) {\n    this.renderObject = RenderObject.rect(bounds, target.texture);\n  }\n\n  return() {\n    if (this.returned) {\n      return;\n    }\n    this.pool.returnTexture(this.target);\n    this.returned = true;\n  }\n}\n","import { mat2d } from \"gl-matrix\";\nimport { Canvas } from \"./Canvas\";\nimport { SceneNode } from \"./SceneNode\";\nimport {\n  RenderContext,\n  DeferredRender,\n  DeferredRenderObject,\n  DeferredRenderTexture,\n  DeferredRenderFilter,\n  DeferredRenderCache,\n} from \"./RenderContext\";\nimport { rect } from \"../math/rect\";\nimport { renderVertexShader, renderFragmentShader } from \"./programs/render\";\nimport { GLState } from \"./gl/GLState\";\nimport { Texture } from \"./gl/Texture\";\nimport { Buffer } from \"./gl/Buffer\";\nimport { Program } from \"./gl/Program\";\nimport { VertexArray } from \"./gl/VertexArray\";\nimport { RenderPool } from \"./RenderPool\";\nimport { Framebuffer } from \"./gl/Framebuffer\";\nimport { Renderbuffer } from \"./gl/Renderbuffer\";\nimport { TextureTarget, RenderbufferTarget } from \"./gl/targets\";\nimport { Atlas } from \"./Atlas\";\nimport { FilterInput, Filter, FilterInstance } from \"./filter/Filter\";\nimport { projection } from \"../math/matrix\";\nimport { CachedRender } from \"./CachedRender\";\n\nconst vertexLimit = 0x10000;\nconst indexLimit = 0x80000;\nconst atlasSize = 1024;\n\nconst tmpRect = rect.create();\nconst tmpMat2d = mat2d.create();\n\nfunction renderTextureSize(n: number) {\n  if (n < 128) {\n    return 128;\n  } else if (n < 256) {\n    return 256;\n  } else if (n < 512) {\n    return 512;\n  } else if (n < 1024) {\n    return 1024;\n  } else {\n    return Math.ceil(n);\n  }\n}\n\ninterface MaskRenderObject {\n  render: DeferredRenderObject;\n  maskTex: Texture | null;\n  maskID: number;\n}\n\nexport class Renderer {\n  readonly glState: GLState;\n\n  private readonly textureMap = new Map<unknown, Texture>();\n  readonly renderPool = new RenderPool();\n  readonly textureReturnBox: TextureTarget[] = [];\n  readonly renderbufferReturnBox: RenderbufferTarget[] = [];\n\n  private readonly indexData = new Uint16Array(indexLimit);\n  private readonly attributeData = new ArrayBuffer(vertexLimit * 14 * 4);\n  private readonly textureUnits: Int32Array;\n\n  private readonly indices = Buffer.index(this.indexData, \"STREAM_DRAW\");\n  private readonly attributes = Buffer.vertex(\n    new Uint32Array(this.attributeData),\n    \"STREAM_DRAW\"\n  );\n  private readonly attrFloat = new Float32Array(this.attributeData, 0);\n  private readonly attrUint = new Uint32Array(this.attributeData, 0);\n\n  private readonly renderProgram: Program;\n  private readonly renderVertexArray = new VertexArray(\n    [\n      {\n        index: 0,\n        buffer: this.attributes,\n        type: \"float\",\n        components: 4,\n        offset: 0,\n        stride: 56,\n      },\n      {\n        index: 1,\n        buffer: this.attributes,\n        type: \"byte\",\n        components: 4,\n        normalized: true,\n        offset: 16,\n        stride: 56,\n      },\n      {\n        index: 2,\n        buffer: this.attributes,\n        type: \"float\",\n        components: 4,\n        offset: 20,\n        stride: 56,\n      },\n      {\n        index: 3,\n        buffer: this.attributes,\n        type: \"float\",\n        components: 4,\n        offset: 36,\n        stride: 56,\n      },\n      {\n        index: 4,\n        buffer: this.attributes,\n        type: \"byte\",\n        components: 4,\n        integer: true,\n        offset: 52,\n        stride: 56,\n      },\n    ],\n    this.indices\n  );\n\n  private readonly defaultFramebuffer: Framebuffer;\n\n  backgroundColor = 0x000000;\n\n  constructor(readonly canvas: Canvas) {\n    this.glState = new GLState(canvas.element, {\n      alpha: false,\n      premultipliedAlpha: false,\n      antialias: false,\n    });\n\n    this.renderProgram = new Program(\n      renderVertexShader,\n      renderFragmentShader(this.glState.maxTextures)\n    );\n    this.textureUnits = new Int32Array(this.glState.maxTextures);\n\n    this.renderProgram.ensure(this.glState);\n    this.renderVertexArray.ensure(this.glState);\n\n    this.defaultFramebuffer = new Framebuffer(\n      new Renderbuffer(canvas.element.width, canvas.element.height, \"rgb\")\n    );\n  }\n\n  renderFrame(root: SceneNode) {\n    const gl = this.glState.gl;\n    const { width, height } = this.canvas;\n    this.renderNode(root, this.defaultFramebuffer, width, height, () => {\n      this.glState.setClearColor(\n        ((this.backgroundColor >>> 16) & 0xff) / 0xff,\n        ((this.backgroundColor >>> 8) & 0xff) / 0xff,\n        ((this.backgroundColor >>> 0) & 0xff) / 0xff,\n        1\n      );\n      gl.clear(gl.COLOR_BUFFER_BIT);\n    });\n  }\n\n  blitFrame() {\n    if (this.glState.gl.isContextLost()) {\n      return;\n    }\n\n    const { width, height } = this.defaultFramebuffer.colorAttachment;\n    const gl = this.glState.gl;\n\n    this.defaultFramebuffer.ensure(this.glState);\n    this.glState.bindFramebuffer(\n      gl.READ_FRAMEBUFFER,\n      this.defaultFramebuffer.framebuffer\n    );\n    this.glState.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\n    gl.blitFramebuffer(\n      0,\n      0,\n      width,\n      height,\n      0,\n      0,\n      width,\n      height,\n      gl.COLOR_BUFFER_BIT,\n      gl.NEAREST\n    );\n  }\n\n  renderNode(\n    node: SceneNode,\n    fb: Framebuffer,\n    logicalWidth: number,\n    logicalHeight: number,\n    clearFb: () => void\n  ) {\n    if (this.glState.gl.isContextLost()) {\n      return;\n    }\n\n    const { width, height } = fb.colorAttachment;\n    const bounds = rect.fromValues(0, 0, width, height);\n    const ctx = new RenderContext(bounds);\n    node.render(ctx);\n    const projectionMat = projection(\n      mat2d.create(),\n      logicalWidth,\n      logicalHeight,\n      true\n    );\n\n    this.textureReturnBox.length = 0;\n    this.renderbufferReturnBox.length = 0;\n    try {\n      this.render(ctx.renders, fb, projectionMat, clearFb);\n    } finally {\n      for (const texture of this.textureReturnBox) {\n        this.renderPool.returnTexture(texture);\n      }\n      for (const renderbuffer of this.renderbufferReturnBox) {\n        this.renderPool.returnRenderbuffer(renderbuffer);\n      }\n      this.renderPool.cleanLRU();\n    }\n  }\n\n  private loadTexture(\n    image: HTMLImageElement | HTMLCanvasElement | Texture | null\n  ) {\n    if (image instanceof Texture) {\n      return image;\n    }\n\n    let tex = this.textureMap.get(image);\n    if (!tex) {\n      tex = image ? Texture.image(image) : Texture.WHITE;\n      this.textureMap.set(image, tex);\n    }\n    return tex;\n  }\n\n  private render(\n    renders: DeferredRender[],\n    framebuffer: Framebuffer,\n    projectionMat: mat2d,\n    clearFb: () => void\n  ) {\n    const textures: DeferredRenderTexture[] = [];\n    const filters: DeferredRenderFilter[] = [];\n    const caches: DeferredRenderCache[] = [];\n    const classifyRenders = (renders: DeferredRender[]) => {\n      textures.length = 0;\n      filters.length = 0;\n      caches.length = 0;\n      for (const render of renders) {\n        if (\"texture\" in render) {\n          textures.push(render);\n        } else if (\"filter\" in render) {\n          filters.push(render);\n        } else if (\"cache\" in render) {\n          caches.push(render);\n        }\n      }\n    };\n\n    let resolved: boolean;\n    classifyRenders(renders);\n    do {\n      resolved = false;\n\n      while (caches.length > 0) {\n        this.renderCaches(renders, caches);\n        resolved = true;\n        classifyRenders(renders);\n      }\n      while (textures.length > 0) {\n        this.renderTextures(renders, textures);\n        resolved = true;\n        classifyRenders(renders);\n      }\n      while (filters.length > 0) {\n        this.renderFilters(renders, filters);\n        resolved = true;\n        classifyRenders(renders);\n      }\n    } while (resolved);\n    this.renderObjects(\n      renders as DeferredRenderObject[],\n      framebuffer,\n      projectionMat,\n      clearFb\n    );\n  }\n\n  private renderTextures(\n    renders: DeferredRender[],\n    textures: DeferredRenderTexture[]\n  ) {\n    const gl = this.glState.gl;\n    let atlas: Atlas | null = null;\n    let atlasContext: RenderContext | null = null;\n    const atlasItems = new Map<DeferredRenderTexture, rect>();\n\n    const flush = () => {\n      if (!atlas || !atlasContext || atlasItems.size === 0) {\n        return;\n      }\n      const projectionMat = projection(\n        mat2d.create(),\n        atlas.width,\n        atlas.height,\n        false\n      );\n\n      const texItem = this.renderPool.takeTexture(atlas.width, atlas.height);\n      const rbItem = this.renderPool.takeRenderbuffer(\n        atlas.width,\n        atlas.height\n      );\n      this.textureReturnBox.push(texItem);\n      this.renderbufferReturnBox.push(rbItem);\n\n      this.render(\n        atlasContext.renders,\n        rbItem.framebuffer,\n        projectionMat,\n        () => {\n          this.glState.setClearColor(0, 0, 0, 0);\n          gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n      );\n\n      texItem.framebuffer.ensure(this.glState);\n      this.glState.bindFramebuffer(\n        gl.READ_FRAMEBUFFER,\n        rbItem.framebuffer.framebuffer\n      );\n      this.glState.bindFramebuffer(\n        gl.DRAW_FRAMEBUFFER,\n        texItem.framebuffer.framebuffer\n      );\n      gl.blitFramebuffer(\n        0,\n        0,\n        atlas.width,\n        atlas.height,\n        0,\n        0,\n        atlas.width,\n        atlas.height,\n        gl.COLOR_BUFFER_BIT,\n        gl.NEAREST\n      );\n\n      for (const [item, bounds] of atlasItems) {\n        const ctx = new RenderContext(null);\n        ctx.transform = item.transform;\n        item.texture.then(ctx, texItem.texture, bounds);\n\n        const index = renders.indexOf(item);\n        renders.splice(index, 1, ...ctx.renders);\n      }\n    };\n\n    for (const render of textures) {\n      const { bounds, paddings, scale, translate, fn } = render.texture;\n\n      const ctx = new RenderContext(null);\n      const renderView = mat2d.fromTranslation(mat2d.create(), [\n        paddings[0] + translate[0] - Math.floor(translate[0]),\n        paddings[1] + translate[1] - Math.floor(translate[1]),\n      ]);\n      mat2d.scale(renderView, renderView, scale);\n      mat2d.translate(renderView, renderView, [-bounds[0], -bounds[1]]);\n\n      ctx.pushTransform(renderView);\n      fn(ctx);\n      ctx.popTransform();\n\n      const renderBounds = ctx.bounds;\n      // Left padding in renderBounds[0], add right paddings manually.\n      const width = Math.ceil(\n        Math.abs(renderBounds[0]) + renderBounds[2] + paddings[0]\n      );\n      const height = Math.ceil(\n        Math.abs(renderBounds[1]) + renderBounds[3] + paddings[1]\n      );\n\n      let atlasBounds: rect | null;\n      if (\n        !atlas ||\n        !atlasContext ||\n        !(atlasBounds = atlas.add(width, height))\n      ) {\n        flush();\n\n        atlas = new Atlas(\n          Math.max(atlasSize, renderTextureSize(width)),\n          Math.max(atlasSize, renderTextureSize(height))\n        );\n        atlasContext = new RenderContext(null);\n        atlasItems.clear();\n        atlasBounds = atlas.add(width, height)!;\n      }\n\n      mat2d.fromTranslation(renderView, [atlasBounds[0], atlasBounds[1]]);\n      atlasContext.pushTransform(renderView);\n      atlasContext.renderContext(ctx);\n      atlasContext.popTransform();\n\n      atlasItems.set(render, atlasBounds);\n    }\n    flush();\n  }\n\n  private renderCaches(\n    renders: DeferredRender[],\n    caches: DeferredRenderCache[]\n  ) {\n    const gl = this.glState.gl;\n    for (const render of caches) {\n      const { texture, bounds, view, then } = render.cache;\n\n      const width = renderTextureSize(bounds[2]);\n      const height = renderTextureSize(bounds[3]);\n      const cacheTexture = this.renderPool.takeTexture(width, height);\n\n      const tmpFramebuffer = new Framebuffer(texture);\n      try {\n        tmpFramebuffer.ensure(this.glState);\n        cacheTexture.framebuffer.ensure(this.glState);\n\n        this.glState.bindFramebuffer(\n          gl.READ_FRAMEBUFFER,\n          tmpFramebuffer.framebuffer\n        );\n        this.glState.bindFramebuffer(\n          gl.DRAW_FRAMEBUFFER,\n          cacheTexture.framebuffer.framebuffer\n        );\n        gl.blitFramebuffer(\n          bounds[0],\n          bounds[1],\n          bounds[0] + bounds[2],\n          bounds[1] + bounds[3],\n          0,\n          0,\n          bounds[2],\n          bounds[3],\n          gl.COLOR_BUFFER_BIT,\n          gl.NEAREST\n        );\n      } finally {\n        tmpFramebuffer.delete();\n      }\n\n      then(\n        new CachedRender(\n          this.renderPool,\n          cacheTexture,\n          view,\n          rect.fromValues(0, 0, bounds[2], bounds[3])\n        )\n      );\n\n      const index = renders.indexOf(render);\n      renders.splice(index, 1);\n    }\n  }\n\n  private renderFilters(\n    renders: DeferredRender[],\n    filters: DeferredRenderFilter[]\n  ) {\n    let atlas: Atlas | null = null;\n    let filter: Filter | null = null;\n    const filterInputs = new Map<DeferredRenderFilter, FilterInput>();\n\n    const flush = () => {\n      if (!atlas || !filter || filterInputs.size === 0) {\n        return;\n      }\n      const target = this.renderPool.takeTexture(atlas.width, atlas.height);\n      this.textureReturnBox.push(target);\n\n      filter.apply(this, Array.from(filterInputs.values()), target);\n\n      for (const [render, { outBounds }] of filterInputs) {\n        const ctx = new RenderContext(null);\n        ctx.transform = render.transform;\n        render.filter.then(ctx, target.texture, outBounds);\n\n        const index = renders.indexOf(render);\n        renders.splice(index, 1, ...ctx.renders);\n      }\n\n      atlas = null;\n      filterInputs.clear();\n    };\n\n    const filterGroups = new Map<Filter, DeferredRenderFilter[]>();\n    for (const render of filters) {\n      const filter = render.filter.instance.filter;\n      let group = filterGroups.get(filter);\n      if (!group) {\n        group = [];\n        filterGroups.set(filter, group);\n      }\n      group.push(render);\n    }\n\n    for (const [groupFilter, renders] of filterGroups) {\n      filter = groupFilter;\n      for (const render of renders) {\n        const { texture, bounds, instance } = render.filter;\n        let atlasBounds: rect | null;\n        if (!atlas || !(atlasBounds = atlas.add(bounds[2], bounds[3]))) {\n          flush();\n\n          atlas = new Atlas(\n            Math.max(atlasSize, renderTextureSize(bounds[2])),\n            Math.max(atlasSize, renderTextureSize(bounds[3]))\n          );\n          atlasBounds = atlas.add(bounds[2], bounds[3])!;\n        }\n\n        const input: FilterInput = {\n          instance,\n          texture,\n          inBounds: bounds,\n          outBounds: atlasBounds,\n        };\n        filterInputs.set(render, input);\n      }\n      flush();\n    }\n  }\n\n  private renderObjects(\n    objects: DeferredRenderObject[],\n    framebuffer: Framebuffer,\n    projectionMat: mat2d,\n    clearFb: () => void\n  ) {\n    const gl = this.glState.gl;\n    const { width, height } = framebuffer.colorAttachment;\n    this.glState.setViewport(0, 0, width, height);\n\n    const returnRbs: RenderbufferTarget[] = [];\n    const returnTexs: TextureTarget[] = [];\n    try {\n      interface MaskRenders {\n        renders: DeferredRenderObject[];\n        bounds: rect;\n      }\n      const masks = new Map<unknown, MaskRenders>();\n      const renders: DeferredRenderObject[] = [];\n      for (const render of objects) {\n        if (!render.transform.renderMask) {\n          renders.push(render);\n          continue;\n        }\n\n        const token = render.transform.renderMask;\n        const maskRenders = masks.get(token);\n        if (!maskRenders) {\n          const bounds = rect.create();\n          rect.apply(bounds, render.object.bounds, render.transform.view);\n          masks.set(token, {\n            renders: [render],\n            bounds,\n          });\n        } else {\n          rect.apply(tmpRect, render.object.bounds, render.transform.view);\n          rect.union(maskRenders.bounds, maskRenders.bounds, tmpRect);\n          maskRenders.renders.push(render);\n        }\n      }\n\n      interface MaskGroup {\n        target: TextureTarget;\n        nextID: number;\n        renders: MaskRenderObject[];\n        bounds: rect[];\n      }\n      interface MaskTex {\n        texture: Texture;\n        id: number;\n      }\n      const maskTextures = new Map<unknown, MaskTex>();\n      const maskGroups: MaskGroup[] = [];\n      for (const [token, { bounds, renders }] of masks) {\n        let group: MaskGroup | null = null;\n        for (const g of maskGroups) {\n          let overlapped = false;\n          for (const b of g.bounds) {\n            if (rect.intersects(b, bounds)) {\n              overlapped = true;\n              break;\n            }\n          }\n          if (!overlapped && g.nextID < 0x100) {\n            group = g;\n            break;\n          }\n        }\n        if (!group) {\n          group = {\n            target: this.renderPool.takeTexture(width, height),\n            nextID: 1,\n            renders: [],\n            bounds: [],\n          };\n          returnTexs.push(group.target);\n          maskGroups.push(group);\n        }\n\n        const id = group.nextID++;\n        maskTextures.set(token, { texture: group.target.texture, id });\n        group.bounds.push(bounds);\n        for (const render of renders) {\n          group.renders.push({ maskTex: null, maskID: id, render });\n        }\n      }\n\n      if (maskGroups.length > 0) {\n        const maskFb = this.renderPool.takeRenderbuffer(width, height);\n        returnRbs.push(maskFb);\n\n        maskFb.framebuffer.ensure(this.glState);\n        this.glState.setClearColor(0, 0, 0, 0);\n\n        for (const group of maskGroups) {\n          this.glState.bindFramebuffer(\n            gl.FRAMEBUFFER,\n            maskFb.framebuffer.framebuffer\n          );\n          gl.clear(gl.COLOR_BUFFER_BIT);\n          this.doRenderObjects(group.renders, true, projectionMat);\n\n          group.target.framebuffer.ensure(this.glState);\n          this.glState.bindFramebuffer(\n            gl.READ_FRAMEBUFFER,\n            maskFb.framebuffer.framebuffer\n          );\n          this.glState.bindFramebuffer(\n            gl.DRAW_FRAMEBUFFER,\n            group.target.framebuffer.framebuffer\n          );\n          gl.blitFramebuffer(\n            0,\n            0,\n            width,\n            height,\n            0,\n            0,\n            width,\n            height,\n            gl.COLOR_BUFFER_BIT,\n            gl.NEAREST\n          );\n        }\n      }\n\n      framebuffer.ensure(this.glState);\n      this.glState.bindFramebuffer(gl.FRAMEBUFFER, framebuffer.framebuffer);\n      clearFb();\n\n      const idRenders: MaskRenderObject[] = [];\n      for (const render of renders) {\n        const maskToken =\n          render.transform.useMask[render.transform.useMask.length - 1];\n        const tex = maskTextures.get(maskToken);\n        if (maskToken && !tex) {\n          // Masked by a off-screen mask: skip the render.\n          continue;\n        }\n        idRenders.push({\n          maskTex: tex?.texture ?? null,\n          maskID: tex?.id ?? 0,\n          render,\n        });\n      }\n      this.doRenderObjects(idRenders, false, projectionMat);\n    } finally {\n      for (const i of returnRbs) {\n        this.renderPool.returnRenderbuffer(i);\n      }\n      for (const i of returnTexs) {\n        this.renderPool.returnTexture(i);\n      }\n    }\n  }\n\n  private doRenderObjects(\n    objects: MaskRenderObject[],\n    renderMask: boolean,\n    projectionMat: mat2d\n  ) {\n    const gl = this.glState.gl;\n\n    this.glState.enable(gl.BLEND);\n    this.glState.setBlendEquation(gl.FUNC_ADD);\n    this.glState.setBlendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n    const projA = projectionMat[0];\n    const projB = projectionMat[1];\n    const projC = projectionMat[2];\n    const projD = projectionMat[3];\n    const projTX = projectionMat[4];\n    const projTY = projectionMat[5];\n\n    let numVertex = 0;\n    let numIndex = 0;\n    const textures: Texture[] = [Texture.WHITE];\n    const flush = () => {\n      if (numIndex === 0) {\n        return;\n      }\n\n      this.indices.update(this.glState, 0, numIndex);\n      this.attributes.update(this.glState, 0, numVertex * 14);\n\n      for (const tex of textures) {\n        tex.ensure(this.glState);\n      }\n      const boundUnits = this.glState.bindTextures(\n        textures.map((tex) => tex.texture)\n      );\n      this.textureUnits.fill(boundUnits[0]);\n      this.textureUnits.set(boundUnits);\n      this.renderProgram.uniform(\n        this.glState,\n        \"uTextures[0]\",\n        this.textureUnits\n      );\n      this.glState.useProgram(this.renderProgram.program);\n      this.renderVertexArray.bind(this.glState);\n      gl.drawElements(gl.TRIANGLES, numIndex, gl.UNSIGNED_SHORT, 0);\n\n      numVertex = 0;\n      numIndex = 0;\n      textures.length = 1;\n    };\n\n    const indexData = this.indices.data;\n    const attrFloat = this.attrFloat;\n    const attrUint = this.attrUint;\n    for (const { render, maskTex, maskID } of objects) {\n      const { kind, vertices, indices, uvMatrix, colors } = render.object;\n      const objectNumVertex = vertices.length / 2;\n      const objectNumIndex = indices.length;\n      if (numVertex + objectNumVertex >= vertexLimit) {\n        flush();\n      } else if (numIndex + objectNumIndex >= indexLimit) {\n        flush();\n      }\n\n      const { view, colorMul, colorAdd } = render.transform;\n\n      const texture = this.loadTexture(render.object.texture);\n      let textureIndex = textures.indexOf(texture);\n      let maskTextureIndex = maskTex ? textures.indexOf(maskTex) : -1;\n      if (textureIndex === -1) {\n        if (textures.length >= this.glState.maxTextures) {\n          flush();\n        }\n        textureIndex = textures.push(texture) - 1;\n      }\n      if (maskTex && maskTextureIndex === -1) {\n        if (textures.length >= this.glState.maxTextures) {\n          flush();\n          textureIndex = textures.push(texture) - 1;\n        }\n        maskTextureIndex = textures.push(maskTex) - 1;\n      }\n\n      for (let i = 0; i < objectNumIndex; i++) {\n        indexData[numIndex + i] = indices[i] + numVertex;\n      }\n\n      const fillMode = render.object.fillMode + textureIndex * 4;\n      let maskMode = 0;\n      if (renderMask) {\n        maskMode = 1;\n      } else if (maskID > 0) {\n        maskMode = 2 + maskTextureIndex * 4;\n      }\n      const mode = maskID * 0x10000 + maskMode * 0x100 + fillMode;\n\n      // Round vertices to nearest pixel in view space to maintain temporal stability.\n      // Do not do this for texts, since they have intricate contours.\n      const roundVertex = kind === \"shape\";\n\n      const base = numVertex * 14;\n      const viewA = view[0];\n      const viewB = view[1];\n      const viewC = view[2];\n      const viewD = view[3];\n      const viewTX = view[4];\n      const viewTY = view[5];\n      const uvA = uvMatrix[0];\n      const uvB = uvMatrix[1];\n      const uvC = uvMatrix[2];\n      const uvD = uvMatrix[3];\n      const uvTX = uvMatrix[4];\n      const uvTY = uvMatrix[5];\n      const colorMulR = colorMul[0];\n      const colorMulG = colorMul[1];\n      const colorMulB = colorMul[2];\n      const colorMulA = colorMul[3];\n      const colorAddR = colorAdd[0] / 0xff;\n      const colorAddG = colorAdd[1] / 0xff;\n      const colorAddB = colorAdd[2] / 0xff;\n      const colorAddA = colorAdd[3] / 0xff;\n\n      for (let i = 0; i < objectNumVertex; i++) {\n        const x = vertices[i * 2];\n        const y = vertices[i * 2 + 1];\n        const color = colors[i];\n\n        let vx = viewA * x + viewC * y + viewTX;\n        let vy = viewB * x + viewD * y + viewTY;\n        if (roundVertex) {\n          const samples = Math.max(1, this.glState.maxSamples);\n          vx = Math.round(vx * samples) / samples;\n          vy = Math.round(vy * samples) / samples;\n        }\n        attrFloat[base + i * 14 + 0] = projA * vx + projC * vy + projTX;\n        attrFloat[base + i * 14 + 1] = projB * vx + projD * vy + projTY;\n\n        attrFloat[base + i * 14 + 2] = uvA * x + uvC * y + uvTX;\n        attrFloat[base + i * 14 + 3] = uvB * x + uvD * y + uvTY;\n\n        attrUint[base + i * 14 + 4] = color;\n\n        attrFloat[base + i * 14 + 5] = colorMulR;\n        attrFloat[base + i * 14 + 6] = colorMulG;\n        attrFloat[base + i * 14 + 7] = colorMulB;\n        attrFloat[base + i * 14 + 8] = colorMulA;\n\n        attrFloat[base + i * 14 + 9] = colorAddR;\n        attrFloat[base + i * 14 + 10] = colorAddG;\n        attrFloat[base + i * 14 + 11] = colorAddB;\n        attrFloat[base + i * 14 + 12] = colorAddA;\n\n        attrUint[base + i * 14 + 13] = mode;\n      }\n\n      numVertex += objectNumVertex;\n      numIndex += objectNumIndex;\n    }\n    flush();\n  }\n}\n","export const renderVertexShader = `\n#version 300 es\n\nlayout(location=0) in vec4 aVertex;\nlayout(location=1) in vec4 aColor;\nlayout(location=2) in vec4 aColorMul;\nlayout(location=3) in vec4 aColorAdd;\nlayout(location=4) in uvec4 aMode;\n\nout vec2 vTextureCoords;\nout vec4 vColor;\nout vec4 vColorMul;\nout vec4 vColorAdd;\nflat out uvec4 vMode;\n\nvoid main(void) {\n    vec2 pos = aVertex.xy;\n    vec2 uv = aVertex.zw;\n    gl_Position = vec4(pos, 0.0, 1.0);\n\n    vTextureCoords = uv;\n    vColor = aColor;\n    vColorMul = aColorMul;\n    vColorAdd = aColorAdd;\n    vMode = aMode;\n}\n`;\n\nexport const renderFragmentShader = (maxTextures: number) => `\n#version 300 es\nprecision highp float;\n\nin vec2 vTextureCoords;\nin vec4 vColor;\nin vec4 vColorMul;\nin vec4 vColorAdd;\nflat in uvec4 vMode;\nout vec4 fragColor;\n\nuniform sampler2D uTextures[${maxTextures}];\n\nvec4 sampleTex(int id, vec2 coords) {\n  vec4 color;\n  ${new Array(maxTextures)\n    .fill(0)\n    .map(\n      (_, i) =>\n        `\n      if (id == ${i}) {\n        color = texture(uTextures[${i}], coords);\n      }\n      `\n    )\n    .join(\"\\n\")}\n  return color;\n}\n\nvec4 getTexel(int id, ivec2 coords) {\n  vec4 color;\n  ${new Array(maxTextures)\n    .fill(0)\n    .map(\n      (_, i) =>\n        `\n      if (id == ${i}) {\n        color = texelFetch(uTextures[${i}], coords, 0);\n      }\n      `\n    )\n    .join(\"\\n\")}\n  return color;\n}\n\nvoid main(void) {\n    int fillMode = int(vMode.x) % 4;\n    int texId = int(vMode.x) / 4;\n    int maskMode = int(vMode.y) % 4;\n    int maskTexId = int(vMode.y) / 4;\n    int maskID = int(vMode.z);\n\n    vec2 coords;\n    if (fillMode == 1) {\n        coords = vec2(vTextureCoords.x, 0.0);\n    } else if (fillMode == 2) {\n        coords = vec2(length(vTextureCoords * 2.0 - 1.0), 0.0);\n    } else {\n        coords = vTextureCoords;\n    }\n\n    vec4 tex = sampleTex(texId, coords);\n    vec4 color = (tex * vColor * vec4(vColorMul.rgb, 1.0)) * vColorMul.a;\n    color += vColorAdd * color.a;\n\n    if (maskMode == 1) {\n      color = vec4(float(maskID) / 255.0, 0.0, 0.0, 1.0);\n    } else if (maskMode == 2) {\n      vec4 mask = getTexel(maskTexId, ivec2(gl_FragCoord.xy));\n      if (maskID == int(mask.r * 255.0)) {\n        color = color * mask.a;\n      } else {\n        color = vec4(0.0);\n      }\n    }\n\n    color = trunc(color * 255.0) / 255.0;\n    fragColor = color;\n}\n`;\n","import { Signal } from \"./signal\";\n\nexport class Ticker {\n  readonly onFrame = new Signal<() => void>();\n  readonly onRender = new Signal<() => void>();\n\n  private animationHandle?: number;\n  private readonly channel = new MessageChannel();\n  private readonly targetMS: number;\n  private lastTimestamp = 0;\n  private needRender = false;\n\n  constructor(readonly fps: number) {\n    this.targetMS = 1000 / fps;\n    this.channel.port1.onmessage = () => {\n      this._onFrame();\n    };\n  }\n\n  begin() {\n    this.end();\n    this.animationHandle = requestAnimationFrame(this._onRender);\n  }\n\n  end() {\n    if (this.animationHandle != null) {\n      cancelAnimationFrame(this.animationHandle);\n      this.animationHandle = undefined;\n    }\n  }\n\n  private _onFrame = () => {\n    try {\n      this.onFrame.emit();\n    } catch (e) {\n      console.error(e);\n    }\n    this.needRender = true;\n  };\n\n  private _onRender = (timestamp: DOMHighResTimeStamp) => {\n    const last = this.lastTimestamp;\n    if (timestamp - last >= this.targetMS) {\n      this.lastTimestamp = timestamp - ((timestamp - last) % this.targetMS);\n      this.channel.port2.postMessage(null);\n    }\n\n    if (this.needRender) {\n      try {\n        this.onRender.emit();\n      } catch (e) {\n        console.error(e);\n      }\n      this.needRender = false;\n    }\n\n    this.animationHandle = requestAnimationFrame(this._onRender);\n  };\n}\n","import { vec2 } from \"gl-matrix\";\nimport { DisplayObject } from \"./DisplayObject\";\nimport { DisplayObjectContainer } from \"./DisplayObjectContainer\";\nimport { InteractiveObject } from \"./InteractiveObject\";\nimport { Properties } from \"../../__internal/Properties\";\nimport { Canvas } from \"../../../internal/render2/Canvas\";\nimport { Renderer } from \"../../../internal/render2/Renderer\";\nimport { Ticker } from \"../../../internal/Ticker\";\nimport { Event } from \"../events/Event\";\nimport { MouseEvent } from \"../events/MouseEvent\";\nimport { KeyboardEvent } from \"../events/KeyboardEvent\";\nimport { Keyboard } from \"../ui/Keyboard\";\nimport { runFrame } from \"./frame\";\n\nconst tmpVec2 = vec2.create();\n\ninterface Constructible {\n  __constructFrame(): void;\n}\n\nexport class Stage extends DisplayObjectContainer {\n  static __current: Stage | null = null;\n\n  readonly __canvas: Canvas;\n  readonly __ticker: Ticker;\n  readonly __renderer: Renderer;\n\n  __displayListDirty = false;\n  readonly __displayList: DisplayObject[] = [];\n  readonly __constructionQueue: Constructible[] = [];\n\n  __mousePosition = vec2.create();\n  __mouseOn: InteractiveObject | null = null;\n  __mouseTrackTarget: InteractiveObject | null = null;\n\n  focus: InteractiveObject | null = null;\n  private __quality: string = \"HIGH\";\n\n  get loaderInfo() {\n    return {\n      bytesTotal: 100,\n      bytesLoaded: 100,\n      url: window.location.href,\n    };\n  }\n\n  get stage() {\n    return this;\n  }\n\n  get quality() {\n    return this.__quality;\n  }\n  set quality(value) {\n    if (this.__quality === value) {\n      return;\n    }\n    this.__quality = value;\n    if (this.__quality === \"HIGH\") {\n      this.__renderer.glState.sampleLimit = 4;\n    } else {\n      this.__renderer.glState.sampleLimit = 0;\n    }\n    this.__renderer.glState.resetRenderState();\n\n    // Re-render after resetting render state\n    this.__onRender();\n    this.__renderer.renderFrame(this.__node);\n  }\n\n  constructor(properties?: Properties) {\n    super();\n\n    let fps = 60;\n    let backgroundColor = 0x000000;\n    let width = 600;\n    let height = 400;\n    if (properties) {\n      ({ width, height, backgroundColor, fps } = properties);\n      width /= 20;\n      height /= 20;\n    }\n\n    this.__canvas = new Canvas(width, height);\n    this.__renderer = new Renderer(this.__canvas);\n    this.__renderer.backgroundColor = backgroundColor;\n\n    this.__ticker = new Ticker(fps);\n    this.__ticker.onFrame.subscribe(this.__onFrame);\n    this.__ticker.onRender.subscribe(this.__doRender);\n    this.__ticker.begin();\n\n    const canvas = this.__canvas.element;\n    canvas.addEventListener(\"mouseenter\", this.#handleMouseEvent);\n    canvas.addEventListener(\"mousemove\", this.#handleMouseEvent);\n    canvas.addEventListener(\"mousedown\", this.#handleMouseEvent);\n    canvas.addEventListener(\"mouseup\", this.#handleMouseEvent);\n    canvas.addEventListener(\"mouseleave\", this.#handleMouseEvent);\n    canvas.addEventListener(\"click\", this.#handleMouseEvent);\n    canvas.addEventListener(\"keydown\", this.#handleKeyboardEvent);\n    canvas.addEventListener(\"keyup\", this.#handleKeyboardEvent);\n    canvas.addEventListener(\"blur\", this.#handleFocusEvent);\n  }\n\n  __onFrame = this.__withContext(() => {\n    runFrame(true, this);\n  });\n\n  __doRender = this.__withContext(() => {\n    this.__onRender();\n    this.__renderer.renderFrame(this.__node);\n    this.__renderer.blitFrame();\n  });\n\n  __withContext<T extends Function>(fn: T): T {\n    return (((...args: unknown[]) => {\n      const p = Stage.__current;\n      Stage.__current = this;\n      try {\n        return fn(...args);\n      } finally {\n        Stage.__current = p;\n      }\n    }) as unknown) as T;\n  }\n\n  __hitTestObject(pt: vec2): InteractiveObject | null {\n    this.__node.ensureLayout();\n\n    const hitTest = (target: InteractiveObject): InteractiveObject | null => {\n      if (!(target instanceof DisplayObjectContainer)) {\n        return target;\n      }\n\n      const children = target.__children;\n      let hitSelf = false;\n      for (let i = children.length - 1; i >= 0; i--) {\n        const child = children[i];\n        if (!child.visible) {\n          continue;\n        }\n\n        if (!child.__node.hitTest(pt, false)) {\n          continue;\n        }\n\n        if (child instanceof InteractiveObject) {\n          const hit = hitTest(child);\n          if (hit) {\n            return hit;\n          }\n        } else {\n          hitSelf = true;\n        }\n      }\n      return hitSelf ? target : null;\n    };\n    return hitTest(this);\n  }\n\n  #handleMouseEvent = this.__withContext(\n    (sourceEvent: globalThis.MouseEvent) => {\n      this.__canvas.resolveCoords(\n        this.__mousePosition,\n        sourceEvent.clientX,\n        sourceEvent.clientY\n      );\n      let target = this.__hitTestObject(this.__mousePosition);\n\n      const dispatchMouseEvent = (\n        type: string,\n        target: DisplayObject | null\n      ) => {\n        if (!target) {\n          return;\n        }\n        target.__globalToLocal(tmpVec2, this.__mousePosition, false);\n\n        const event = new MouseEvent(type, true, false);\n        event.buttonDown = sourceEvent.buttons !== 0;\n        event.localX = tmpVec2[0];\n        event.localY = tmpVec2[1];\n        event.stageX = this.__mousePosition[0];\n        event.stageY = this.__mousePosition[1];\n        target.dispatchEvent(event);\n      };\n\n      if (this.__mouseTrackTarget) {\n        if (this.__mouseTrackTarget.stage !== this) {\n          this.__mouseTrackTarget = null;\n        }\n        target = this.__mouseTrackTarget;\n      }\n      if (sourceEvent.type === \"mouseleave\") {\n        target = null;\n      }\n\n      if (this.__mouseOn !== target) {\n        dispatchMouseEvent(MouseEvent.MOUSE_OUT, this.__mouseOn);\n        this.__mouseOn = target;\n        dispatchMouseEvent(MouseEvent.MOUSE_OVER, this.__mouseOn);\n      }\n\n      switch (sourceEvent.type) {\n        case \"mousemove\":\n          dispatchMouseEvent(MouseEvent.MOUSE_MOVE, this.__mouseOn);\n          break;\n        case \"mousedown\":\n          dispatchMouseEvent(MouseEvent.MOUSE_DOWN, this.__mouseOn);\n          break;\n        case \"mouseup\":\n          dispatchMouseEvent(MouseEvent.MOUSE_UP, this.__mouseOn);\n          break;\n        case \"click\":\n          dispatchMouseEvent(MouseEvent.CLICK, this.__mouseOn);\n          break;\n      }\n\n      if (this.__mouseOn) {\n        this.__canvas.cursor = this.__mouseOn.__isPointerCursor\n          ? \"pointer\"\n          : \"default\";\n      } else {\n        this.__canvas.cursor = \"default\";\n      }\n    }\n  );\n\n  #handleKeyboardEvent = this.__withContext(\n    (sourceEvent: globalThis.KeyboardEvent) => {\n      const keyCode =\n        Keyboard.codeMap[sourceEvent.key] ?? Keyboard.codeMap[sourceEvent.code];\n      if (!keyCode) {\n        return;\n      }\n\n      let event: KeyboardEvent;\n      switch (sourceEvent.type) {\n        case \"keydown\":\n          event = new KeyboardEvent(KeyboardEvent.KEY_DOWN, true, false);\n          break;\n        case \"keyup\":\n          event = new KeyboardEvent(KeyboardEvent.KEY_UP, true, false);\n          break;\n        default:\n          return;\n      }\n      event.keyCode = keyCode;\n      (this.focus ?? this).dispatchEvent(event);\n    }\n  );\n\n  #handleFocusEvent = this.__withContext(\n    (sourceEvent: globalThis.FocusEvent) => {\n      let event: Event;\n      switch (sourceEvent.type) {\n        case \"blur\":\n          event = new Event(Event.DEACTIVATE, true, false);\n          break;\n        default:\n          return;\n      }\n      this.dispatchEvent(event);\n    }\n  );\n\n  __ensureDisplayList() {\n    if (!this.__displayListDirty) {\n      return;\n    }\n\n    this.__displayList.length = 1;\n    this.__displayList[0] = this;\n\n    let i = 0;\n    while (i < this.__displayList.length) {\n      const children = this.__displayList[i].__node.children;\n      for (let j = 0; j < children.length; j++) {\n        this.__displayList.push(children[j].object as DisplayObject);\n      }\n      i++;\n    }\n\n    this.__displayListDirty = false;\n  }\n}\n","import { DisplayObject } from \"./DisplayObject\";\nimport { InteractiveObject } from \"./InteractiveObject\";\nimport {\n  ButtonInstance,\n  ButtonState,\n} from \"../../../internal/character/ButtonInstance\";\nimport { MouseEvent } from \"../events\";\nimport { SoundContext } from \"../media/context\";\n\nexport class SimpleButton extends InteractiveObject {\n  static __character?: ButtonInstance;\n\n  declare __character: ButtonInstance | null;\n\n  constructor() {\n    super();\n\n    this.__state = ButtonState.Up;\n    this.__states = [\n      new DisplayObject(),\n      new DisplayObject(),\n      new DisplayObject(),\n      new DisplayObject(),\n    ];\n\n    for (const obj of this.__states) {\n      obj.__node.setParent(this.__node, this.__node.children.length);\n    }\n\n    this.__character =\n      (this.constructor as typeof SimpleButton).__character ?? null;\n    this.__character?.applyTo(this);\n    this.__node.buttonState = this.__state;\n\n    this.addEventListener(MouseEvent.MOUSE_OVER, this.#handleMouseEvent);\n    this.addEventListener(MouseEvent.MOUSE_OUT, this.#handleMouseEvent);\n    this.addEventListener(MouseEvent.MOUSE_DOWN, this.#handleMouseEvent);\n    this.addEventListener(MouseEvent.MOUSE_UP, this.#handleMouseEvent);\n    this.addEventListener(MouseEvent.MOUSE_MOVE, this.#handleMouseEvent);\n  }\n\n  readonly __soundContext = new SoundContext();\n  private __state = ButtonState.Up;\n  private __states: DisplayObject[];\n\n  get __activeState() {\n    switch (this.__state) {\n      case ButtonState.Up:\n        return this.upState;\n      case ButtonState.Over:\n        return this.overState;\n      case ButtonState.Down:\n        return this.downState;\n    }\n  }\n\n  get upState() {\n    return this.__states[ButtonState.Up];\n  }\n  set upState(value) {\n    this.__states[ButtonState.Up].__node.setParent(null, 0);\n    this.__states[ButtonState.Up] = value;\n    value.__node.setParent(this.__node, ButtonState.Up);\n  }\n\n  get overState() {\n    return this.__states[ButtonState.Over];\n  }\n  set overState(value) {\n    this.__states[ButtonState.Over].__node.setParent(null, 0);\n    this.__states[ButtonState.Over] = value;\n    value.__node.setParent(this.__node, ButtonState.Over);\n  }\n\n  get downState() {\n    return this.__states[ButtonState.Down];\n  }\n  set downState(value) {\n    this.__states[ButtonState.Down].__node.setParent(null, 0);\n    this.__states[ButtonState.Down] = value;\n    value.__node.setParent(this.__node, ButtonState.Down);\n  }\n\n  get hitTestState() {\n    return this.__states[ButtonState.HitTest];\n  }\n  set hitTestState(value) {\n    this.__states[ButtonState.HitTest].__node.setParent(null, 0);\n    this.__states[ButtonState.HitTest] = value;\n    value.__node.setParent(this.__node, ButtonState.HitTest);\n  }\n\n  trackAsMenu = false;\n\n  useHandCursor = true;\n\n  get __isPointerCursor() {\n    return this.useHandCursor || super.__isPointerCursor;\n  }\n\n  #handleMouseEvent = (event: MouseEvent) => {\n    let newState: ButtonState = this.__state;\n    let isMouseDown = event.type !== MouseEvent.MOUSE_OUT && event.buttonDown;\n    if (event.type === MouseEvent.MOUSE_OUT) {\n      newState = ButtonState.Up;\n    } else if (\n      event.buttonDown &&\n      this.hitTestPoint(event.stageX, event.stageY)\n    ) {\n      newState = ButtonState.Down;\n    } else {\n      newState = ButtonState.Over;\n    }\n\n    const stage = this.stage;\n\n    if (this.__state !== newState) {\n      const oldState = this.__state;\n      this.__state = newState;\n      this.__node.buttonState = newState;\n      this.__character?.instantiateState(this, newState);\n      this.__character?.stateTransition(this, oldState, newState);\n      if (stage) {\n        stage.__displayListDirty = true;\n      }\n    }\n\n    if (!this.trackAsMenu && stage) {\n      if (isMouseDown) {\n        stage.__mouseTrackTarget = this;\n      } else if (stage.__mouseTrackTarget === this) {\n        stage.__mouseTrackTarget = null;\n      }\n    }\n  };\n}\n","import { mat2d, vec4 } from \"gl-matrix\";\nimport { AVMObject } from \"../../__internal/avm2/AVMObject\";\nimport { DisplayObject } from \"./DisplayObject\";\nimport { Matrix } from \"../geom/Matrix\";\nimport { ColorTransform } from \"../geom/ColorTransform\";\nimport { Rectangle } from \"../geom/Rectangle\";\nimport { Point } from \"../geom/Point\";\nimport { SceneNode } from \"../../../internal/render2/SceneNode\";\nimport { TextureTarget } from \"../../../internal/render2/gl/targets\";\nimport { Renderer } from \"../../../internal/render2/Renderer\";\nimport { Stage } from \"./Stage\";\nimport { rect } from \"../../../internal/math/rect\";\nimport { RenderObject } from \"../../../internal/render2/RenderObject\";\n\nexport class BitmapData extends AVMObject {\n  private __root = new SceneNode(null);\n  private __needRender = false;\n  private __needPixel = false;\n  private __pixels: Uint32Array | null = null;\n  __target: TextureTarget | null = null;\n  __renderer: Renderer | null = null;\n\n  readonly rect: Rectangle;\n\n  constructor(\n    readonly width: number,\n    readonly height: number,\n    readonly transparent = true,\n    readonly fillColor = 0xffffffff\n  ) {\n    super();\n    this.rect = new Rectangle(0, 0, width, height);\n  }\n\n  draw(\n    source: DisplayObject,\n    matrix?: Matrix,\n    colorTransform?: ColorTransform,\n    blendMode?: String\n  ) {\n    const sourceNode = source.__node.clone();\n    sourceNode.visible = true;\n    if (matrix) {\n      mat2d.copy(sourceNode.transformLocal, matrix.__value);\n    } else {\n      mat2d.identity(sourceNode.transformLocal);\n    }\n    if (colorTransform) {\n      vec4.copy(sourceNode.colorTransformLocalMul, colorTransform.__mul);\n      vec4.copy(sourceNode.colorTransformLocalAdd, colorTransform.__add);\n    } else {\n      vec4.set(sourceNode.colorTransformLocalMul, 1, 1, 1, 1);\n      vec4.set(sourceNode.colorTransformLocalAdd, 0, 0, 0, 0);\n    }\n    sourceNode.setParent(this.__root, this.__root.children.length);\n    this.__needRender = true;\n  }\n\n  colorTransform(bounds: Rectangle, trx: ColorTransform) {\n    this.__render();\n    const target = this.__target!;\n    this.__target = null;\n    try {\n      const [x, y, width, height] = bounds.__rect;\n      const addPatch = (patch: rect, apply: boolean) => {\n        if (patch[2] <= 0 || patch[3] <= 0) {\n          return;\n        }\n        const node = new SceneNode(null);\n        node.setRenderObjects(\n          [RenderObject.rect(patch, target.texture, { invertY: true })],\n          rect.fromValues(0, 0, patch[2], patch[3])\n        );\n        mat2d.fromTranslation(node.transformLocal, [patch[0], patch[1]]);\n        if (apply) {\n          vec4.copy(node.colorTransformLocalMul, trx.__mul);\n          vec4.copy(node.colorTransformLocalAdd, trx.__add);\n        }\n        node.setParent(this.__root, this.__root.children.length);\n      };\n      addPatch(rect.fromValues(0, 0, this.width, y), false);\n      addPatch(rect.fromValues(0, y, x, height), false);\n      addPatch(rect.fromValues(x, y, width, height), true);\n      addPatch(\n        rect.fromValues(x + width, y, this.width - (x + width), height),\n        false\n      );\n      addPatch(\n        rect.fromValues(0, y + height, this.width, this.height - (y + height)),\n        false\n      );\n\n      this.__render();\n    } finally {\n      this.__renderer!.renderPool.returnTexture(target);\n    }\n  }\n\n  getPixel32(x: number, y: number) {\n    this.__render();\n    if (this.__needPixel || !this.__pixels) {\n      if (!this.__pixels) {\n        this.__pixels = new Uint32Array(this.width * this.height);\n      }\n\n      const glState = this.__renderer!.glState;\n      const gl = glState.gl;\n      this.__target!.framebuffer.ensure(glState);\n      glState.bindFramebuffer(\n        gl.READ_FRAMEBUFFER,\n        this.__target!.framebuffer.framebuffer\n      );\n      const pixels = new Uint8Array(this.__pixels.buffer);\n      gl.readPixels(\n        0,\n        0,\n        this.width,\n        this.height,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        pixels\n      );\n      this.__needPixel = false;\n    }\n\n    const offset = Math.floor(x) + (this.height - Math.floor(y)) * this.width;\n    const pixel = this.__pixels[offset];\n    const a = (pixel >>> 24) & 0xff;\n    const b = (pixel >>> 16) & 0xff;\n    const g = (pixel >>> 8) & 0xff;\n    const r = (pixel >>> 0) & 0xff;\n    return a * 0x1000000 + r * 0x10000 + g * 0x100 + b * 0x1;\n  }\n\n  lock() {}\n\n  unlock() {}\n\n  copyPixels(\n    sourceBitmapData: BitmapData,\n    sourceRect: Rectangle,\n    destPoint: Point\n  ) {\n    this.__render();\n    sourceBitmapData.__render();\n\n    const glState = this.__renderer!.glState;\n    const gl = glState.gl;\n    const src = sourceBitmapData.__target!;\n    const dst = this.__target!;\n\n    const srcX = sourceRect.x,\n      srcY = this.height - sourceRect.y - sourceRect.height;\n    const dstX = destPoint.x,\n      dstY = this.height - destPoint.y - sourceRect.height;\n\n    src.framebuffer.ensure(glState);\n    dst.framebuffer.ensure(glState);\n    glState.bindFramebuffer(gl.READ_FRAMEBUFFER, src.framebuffer.framebuffer);\n    glState.bindFramebuffer(gl.DRAW_FRAMEBUFFER, dst.framebuffer.framebuffer);\n    gl.blitFramebuffer(\n      srcX,\n      srcY,\n      srcX + sourceRect.width,\n      srcY + sourceRect.height,\n      dstX,\n      dstY,\n      dstX + sourceRect.width,\n      dstY + sourceRect.height,\n      gl.COLOR_BUFFER_BIT,\n      gl.NEAREST\n    );\n  }\n\n  scroll(x: number, y: number) {\n    this.__render();\n    const target = this.__target!;\n    const renderer = this.__renderer!;\n    this.__target = renderer.renderPool.takeTexture(this.width, this.height);\n    try {\n      const src = target.framebuffer;\n      const dst = this.__target.framebuffer;\n      const glState = this.__renderer!.glState;\n      const gl = glState.gl;\n      src.ensure(glState);\n      dst.ensure(glState);\n      glState.bindFramebuffer(gl.READ_FRAMEBUFFER, src.framebuffer);\n      glState.bindFramebuffer(gl.DRAW_FRAMEBUFFER, dst.framebuffer);\n      gl.blitFramebuffer(\n        0,\n        0,\n        this.width,\n        this.height,\n        0,\n        0,\n        this.width,\n        this.height,\n        gl.COLOR_BUFFER_BIT,\n        gl.NEAREST\n      );\n      gl.blitFramebuffer(\n        0,\n        0,\n        this.width,\n        this.height,\n        x,\n        -y,\n        x + this.width,\n        -y + this.height,\n        gl.COLOR_BUFFER_BIT,\n        gl.NEAREST\n      );\n    } finally {\n      renderer.renderPool.returnTexture(target);\n    }\n  }\n\n  dispose() {\n    if (this.__target) {\n      this.__renderer?.renderPool.returnTexture(this.__target);\n      this.__target = null;\n    }\n    this.__needRender = true;\n  }\n\n  __render() {\n    if (this.__target && !this.__needRender) {\n      return;\n    }\n\n    if (!this.__renderer) {\n      if (!Stage.__current) {\n        throw new Error(\"No stage in context\");\n      }\n      this.__renderer = Stage.__current.__renderer;\n    }\n\n    let clearFb = () => {};\n    if (!this.__target) {\n      const glState = this.__renderer.glState;\n      this.__target = this.__renderer.renderPool.takeTexture(\n        this.width,\n        this.height\n      );\n      clearFb = () => {\n        glState.setClearColor(0, 0, 0, 0);\n        glState.gl.clear(glState.gl.COLOR_BUFFER_BIT);\n      };\n    }\n\n    const fb = this.__renderer.renderPool.takeRenderbuffer(\n      this.width,\n      this.height\n    );\n    try {\n      const glState = this.__renderer!.glState;\n      const gl = glState.gl;\n      this.__renderer.renderNode(\n        this.__root,\n        fb.framebuffer,\n        this.width,\n        this.height,\n        clearFb\n      );\n      this.__target.framebuffer.ensure(glState);\n      glState.bindFramebuffer(gl.READ_FRAMEBUFFER, fb.framebuffer.framebuffer);\n      glState.bindFramebuffer(\n        gl.DRAW_FRAMEBUFFER,\n        this.__target.framebuffer.framebuffer\n      );\n      gl.blitFramebuffer(\n        0,\n        0,\n        this.width,\n        this.height,\n        0,\n        0,\n        this.width,\n        this.height,\n        gl.COLOR_BUFFER_BIT,\n        gl.NEAREST\n      );\n\n      this.__root.onRemoveFromStage();\n      this.__root = new SceneNode(null);\n      this.__needRender = false;\n      this.__needPixel = true;\n    } finally {\n      this.__renderer.renderPool.returnRenderbuffer(fb);\n    }\n  }\n}\n","import { DisplayObject } from \"./DisplayObject\";\nimport { BitmapData } from \"./BitmapData\";\nimport { RenderObject } from \"../../../internal/render2/RenderObject\";\nimport { rect } from \"../../../internal/math/rect\";\nimport { Texture } from \"../../../internal/render2/gl/Texture\";\n\nexport class Bitmap extends DisplayObject {\n  constructor(public bitmapData: BitmapData) {\n    super();\n\n    const { width, height } = this.bitmapData;\n    const bounds = rect.fromValues(0, 0, width, height);\n    this.__node.setRenderObjects(\n      [\n        RenderObject.rect(bounds, Texture.WHITE, {\n          texWidth: width,\n          texHeight: height,\n          invertY: true,\n        }),\n      ],\n      bounds\n    );\n  }\n\n  __onRender() {\n    super.__onRender();\n\n    this.bitmapData.__render();\n    if (this.bitmapData.__target) {\n      this.__node.renderObjects[0].texture = this.bitmapData.__target.texture;\n    }\n  }\n}\n","import { DisplayObjectContainer } from \"./DisplayObjectContainer\";\n\nexport class Loader extends DisplayObjectContainer {}\n","export class Event {\n  static readonly ENTER_FRAME = \"ENTER_FRAME\";\n  static readonly ADDED_TO_STAGE = \"ADDED_TO_STAGE\";\n  static readonly REMOVED_FROM_STAGE = \"REMOVED_FROM_STAGE\";\n  static readonly SOUND_COMPLETE = \"SOUND_COMPLETE\";\n  static readonly DEACTIVATE = \"DEACTIVATE\";\n\n  target: unknown;\n  currentTarget: unknown;\n\n  constructor(\n    public type: string,\n    public readonly bubbles = false,\n    public readonly cancelable = false\n  ) {}\n\n  formatToString(className: string, ...fields: string[]): string {\n    const values = fields.map((field) => (this as any)[field]).join(\", \");\n    return `${className}(${values})`;\n  }\n}\n","import { AVMObject } from \"../../__internal/avm2/AVMObject\";\nimport { Event } from \"./Event\";\n\nexport type ListenerFn<T extends Event> = (event: T) => void;\n\ninterface Listener {\n  priority: number;\n  listener: ListenerFn<Event>;\n}\n\nconst forBroadcast = Symbol();\nconst broadcastEvents: Array<string | symbol> = [Event.ENTER_FRAME];\n\nexport class EventDispatcher extends AVMObject {\n  [forBroadcast] = false;\n\n  #parent: EventDispatcher | null = null;\n  #captureListeners = new Map<string | symbol, Listener[]>();\n  #bubbleListeners = new Map<string | symbol, Listener[]>();\n\n  __setEventParent(parent: EventDispatcher | null) {\n    this.#parent = parent;\n  }\n\n  addEventListener<T extends Event>(\n    type: string | symbol,\n    listener: ListenerFn<T>,\n    useCapture = false,\n    priority = 0,\n    useWeakReference = false\n  ) {\n    if (broadcastEvents.includes(type) && !this[forBroadcast]) {\n      __broadcastDispatcher.addEventListener(\n        type,\n        listener,\n        useCapture,\n        priority,\n        useWeakReference\n      );\n      return;\n    }\n\n    let listeners: Map<string | symbol, Listener[]>;\n    if (useCapture) {\n      listeners = this.#captureListeners;\n    } else {\n      listeners = this.#bubbleListeners;\n    }\n\n    const oldListeners = listeners.get(type) || [];\n    if (oldListeners.find((l) => l.listener === listener)) {\n      return;\n    }\n\n    const newListeners = [\n      ...oldListeners,\n      { priority, listener: listener as ListenerFn<Event> },\n    ];\n    newListeners.sort((a, b) => b.priority - a.priority);\n    listeners.set(type, newListeners);\n  }\n\n  removeEventListener<T extends Event>(\n    type: string | symbol,\n    listener: ListenerFn<T>,\n    useCapture = false,\n    priority = 0,\n    useWeakReference = false\n  ) {\n    if (broadcastEvents.includes(type) && !this[forBroadcast]) {\n      __broadcastDispatcher.removeEventListener(\n        type,\n        listener,\n        useCapture,\n        priority,\n        useWeakReference\n      );\n      return;\n    }\n\n    let listeners: Map<string | symbol, Listener[]>;\n    if (useCapture) {\n      listeners = this.#captureListeners;\n    } else {\n      listeners = this.#bubbleListeners;\n    }\n\n    const oldListeners = listeners.get(type) || [];\n    const newListeners = oldListeners.filter((l) => l.listener !== listener);\n    if (newListeners.length !== oldListeners.length) {\n      listeners.set(type, newListeners);\n    }\n  }\n\n  #dispatchEvent = (event: Event, isCapturing: boolean) => {\n    let listeners: Map<string | symbol, Listener[]>;\n    if (isCapturing) {\n      listeners = this.#captureListeners;\n    } else {\n      listeners = this.#bubbleListeners;\n    }\n\n    for (const { listener } of listeners.get(event.type) || []) {\n      listener(event);\n    }\n  };\n\n  dispatchEvent(event: Event) {\n    event.target = this;\n    if (!event.bubbles) {\n      event.currentTarget = this;\n      this.#dispatchEvent(event, false);\n      return;\n    }\n\n    const path: EventDispatcher[] = [this];\n    let current: EventDispatcher | null = this;\n    while (current && current.#parent) {\n      current = current.#parent;\n      path.push(current);\n    }\n\n    for (let i = path.length - 1; i > 0; i--) {\n      event.currentTarget = path[i];\n      path[i].#dispatchEvent(event, true);\n    }\n    for (let i = 0; i < path.length; i++) {\n      event.currentTarget = path[i];\n      path[i].#dispatchEvent(event, false);\n    }\n  }\n}\n\nexport const __broadcastDispatcher = new EventDispatcher();\n__broadcastDispatcher[forBroadcast] = true;\n","import { Event } from \"./Event\";\n\nexport class KeyboardEvent extends Event {\n  static readonly KEY_DOWN = \"KEY_DOWN\";\n  static readonly KEY_UP = \"KEY_UP\";\n\n  keyCode = 0;\n}\n","import { Event } from \"./Event\";\n\nexport class MouseEvent extends Event {\n  static readonly CLICK = \"click\";\n  static readonly MOUSE_DOWN = \"mouseDown\";\n  static readonly MOUSE_MOVE = \"mouseMove\";\n  static readonly MOUSE_OUT = \"mouseOut\";\n  static readonly MOUSE_OVER = \"mouseOver\";\n  static readonly MOUSE_UP = \"mouseUp\";\n\n  buttonDown = false;\n  localX = 0;\n  localY = 0;\n  stageX = 0;\n  stageY = 0;\n}\n","import { Event } from \"./Event\";\n\nexport class TimerEvent extends Event {}\n","import { Event } from \"./Event\";\n\nexport class TextEvent extends Event {\n  text = \"\";\n}\n","import { TextEvent } from \"./TextEvent\";\n\nexport class ErrorEvent extends TextEvent {}\n","import { ErrorEvent } from \"./ErrorEvent\";\n\nexport class IOErrorEvent extends ErrorEvent {\n  static readonly IO_ERROR = \"IO_ERROR\";\n}\n","import { ErrorEvent } from \"./ErrorEvent\";\n\nexport class SecurityErrorEvent extends ErrorEvent {\n  static readonly SECURITY_ERROR = \"SECURITY_ERROR\";\n}\n","import { Event } from \"./Event\";\n\nexport class FocusEvent extends Event {}\n","import { FilterInstance } from \"../../../internal/render2/filter/Filter\";\n\nexport abstract class BitmapFilter {\n  abstract readonly __filter: FilterInstance;\n}\n","import { Filter, FilterInput, FilterInstance } from \"./Filter\";\nimport { Renderer } from \"../Renderer\";\nimport { TextureTarget } from \"../gl/targets\";\nimport { Texture } from \"../gl/Texture\";\nimport { attrs, attrFloat, programBlur, vertexArray } from \"./programs\";\nimport { mat2d, vec2 } from \"gl-matrix\";\nimport { projection } from \"../../math/matrix\";\n\nexport interface BlurFilterInstance extends FilterInstance {\n  blurX: number;\n  blurY: number;\n  passes: number;\n}\n\nconst outProjection = mat2d.create();\nconst inTexScale = vec2.create();\nconst outTexScale = vec2.create();\n\nexport class BlurFilter implements Filter<BlurFilterInstance> {\n  static readonly instance = new BlurFilter();\n\n  isEffective(instance: BlurFilterInstance): boolean {\n    return instance.blurX > 0 || instance.blurY > 0;\n  }\n\n  apply(\n    renderer: Renderer,\n    input: FilterInput<BlurFilterInstance>[],\n    out: TextureTarget\n  ): void {\n    const state = renderer.glState;\n    const gl = state.gl;\n\n    const { width, height } = out.texture;\n    projection(outProjection, width, height, false);\n    vec2.set(outTexScale, 1 / width, 1 / height);\n\n    state.setViewport(0, 0, width, height);\n    state.disable(gl.BLEND);\n    state.setClearColor(0, 0, 0, 0);\n\n    const texA = renderer.renderPool.takeTexture(width, height);\n    const texB = renderer.renderPool.takeTexture(width, height);\n    try {\n      const batchInput: FilterInput<BlurFilterInstance>[] = [];\n      let radius = 0;\n      let texture: Texture | null = null;\n      let passes: number | null = null;\n      const flush = () => {\n        if (!texture || !passes) {\n          return;\n        }\n\n        const blurProgram = programBlur(radius);\n\n        const numRect = batchInput.length;\n        attrs.update(state, 0, numRect * 4 * 17);\n\n        let front = texA;\n        let back = texB;\n        for (let i = 0; i < passes * 2; i++) {\n          let passFront = front;\n          let passBack = back.texture;\n          let mode = i % 2;\n          if (i === 0) {\n            passBack = texture;\n            mode += 2;\n          } else if (i === passes * 2 - 1) {\n            passFront = out;\n          }\n\n          passFront.framebuffer.ensure(state);\n          state.bindFramebuffer(\n            gl.FRAMEBUFFER,\n            passFront.framebuffer.framebuffer\n          );\n\n          blurProgram.ensure(state);\n          vertexArray.ensure(state);\n          passBack.ensure(state);\n\n          state.useProgram(blurProgram.program);\n          const texUnit = state.bindTextures([passBack.texture])[0];\n          blurProgram.uniform(state, \"uTexture\", texUnit);\n          blurProgram.uniform(state, \"uMode\", mode);\n          vertexArray.bind(state);\n          gl.drawElements(gl.TRIANGLES, numRect * 6, gl.UNSIGNED_SHORT, 0);\n\n          let tmp = back;\n          back = front;\n          front = tmp;\n        }\n\n        batchInput.length = 0;\n        passes = null;\n        texture = null;\n      };\n\n      for (const i of input) {\n        if (i.texture !== texture || i.instance.passes !== passes) {\n          flush();\n          texture = i.texture;\n          passes = i.instance.passes;\n          vec2.set(inTexScale, 1 / texture.width, 1 / texture.height);\n        }\n\n        const deltaX = i.instance.blurX / 2;\n        const deltaY = i.instance.blurY / 2;\n        radius = Math.max(radius, deltaX, deltaY);\n\n        let attrI = batchInput.length * 4 * 17;\n        for (let j = 0; j < 4; j++) {\n          attrFloat[attrI + 0] = deltaX;\n          attrFloat[attrI + 1] = deltaY;\n          switch (j) {\n            case 0:\n              attrFloat[attrI + 2] = i.outBounds[0] + i.outBounds[2];\n              attrFloat[attrI + 3] = i.outBounds[1];\n              attrFloat[attrI + 4] = i.inBounds[0] + i.inBounds[2];\n              attrFloat[attrI + 5] = i.inBounds[1];\n              attrFloat[attrI + 6] = i.outBounds[0] + i.outBounds[2];\n              attrFloat[attrI + 7] = i.outBounds[1];\n              break;\n            case 1:\n              attrFloat[attrI + 2] = i.outBounds[0];\n              attrFloat[attrI + 3] = i.outBounds[1] + i.outBounds[3];\n              attrFloat[attrI + 4] = i.inBounds[0];\n              attrFloat[attrI + 5] = i.inBounds[1] + i.inBounds[3];\n              attrFloat[attrI + 6] = i.outBounds[0];\n              attrFloat[attrI + 7] = i.outBounds[1] + i.outBounds[3];\n              break;\n            case 2:\n              attrFloat[attrI + 2] = i.outBounds[0];\n              attrFloat[attrI + 3] = i.outBounds[1];\n              attrFloat[attrI + 4] = i.inBounds[0];\n              attrFloat[attrI + 5] = i.inBounds[1];\n              attrFloat[attrI + 6] = i.outBounds[0];\n              attrFloat[attrI + 7] = i.outBounds[1];\n              break;\n            case 3:\n              attrFloat[attrI + 2] = i.outBounds[0] + i.outBounds[2];\n              attrFloat[attrI + 3] = i.outBounds[1] + i.outBounds[3];\n              attrFloat[attrI + 4] = i.inBounds[0] + i.inBounds[2];\n              attrFloat[attrI + 5] = i.inBounds[1] + i.inBounds[3];\n              attrFloat[attrI + 6] = i.outBounds[0] + i.outBounds[2];\n              attrFloat[attrI + 7] = i.outBounds[1] + i.outBounds[3];\n              break;\n          }\n\n          attrFloat[attrI + 8] = i.inBounds[0] + 0.5;\n          attrFloat[attrI + 9] = i.inBounds[1] + 0.5;\n          attrFloat[attrI + 10] = i.inBounds[0] + i.inBounds[2] - 1.5;\n          attrFloat[attrI + 11] = i.inBounds[1] + i.inBounds[3] - 1.5;\n\n          attrFloat[attrI + 12] = i.outBounds[0] + 0.5;\n          attrFloat[attrI + 13] = i.outBounds[1] + 0.5;\n          attrFloat[attrI + 14] = i.outBounds[0] + i.outBounds[2] - 1.5;\n          attrFloat[attrI + 15] = i.outBounds[1] + i.outBounds[3] - 1.5;\n\n          const delta = attrFloat.subarray(attrI + 0, attrI + 2);\n          const vertex = attrFloat.subarray(attrI + 2, attrI + 4);\n          const inTexCoords = attrFloat.subarray(attrI + 4, attrI + 6);\n          const outTexCoords = attrFloat.subarray(attrI + 6, attrI + 8);\n          const inBoundsMin = attrFloat.subarray(attrI + 8, attrI + 10);\n          const inBoundsMax = attrFloat.subarray(attrI + 10, attrI + 12);\n          const outBoundsMin = attrFloat.subarray(attrI + 12, attrI + 14);\n          const outBoundsMax = attrFloat.subarray(attrI + 14, attrI + 16);\n\n          vec2.mul(delta, delta, inTexScale);\n          vec2.transformMat2d(vertex, vertex, outProjection);\n          vec2.mul(inTexCoords, inTexCoords, inTexScale);\n          vec2.mul(inBoundsMin, inBoundsMin, inTexScale);\n          vec2.mul(inBoundsMax, inBoundsMax, inTexScale);\n          vec2.mul(outTexCoords, outTexCoords, outTexScale);\n          vec2.mul(outBoundsMin, outBoundsMin, outTexScale);\n          vec2.mul(outBoundsMax, outBoundsMax, outTexScale);\n\n          attrI += 17;\n        }\n\n        batchInput.push(i);\n      }\n      flush();\n    } finally {\n      renderer.renderPool.returnTexture(texA);\n      renderer.renderPool.returnTexture(texB);\n    }\n  }\n}\n","import { BitmapFilter } from \"./BitmapFilter\";\nimport { vec2 } from \"gl-matrix\";\nimport {\n  BlurFilterInstance,\n  BlurFilter as RenderBlurFilter,\n} from \"../../../internal/render2/filter/BlurFilter\";\n\nexport class BlurFilter extends BitmapFilter {\n  get __filter(): BlurFilterInstance {\n    return {\n      filter: RenderBlurFilter.instance,\n      paddings: vec2.fromValues(this.blurX, this.blurY),\n      blurX: this.blurX,\n      blurY: this.blurY,\n      passes: this.quality,\n    };\n  }\n\n  constructor(public blurX = 4.0, public blurY = 4.0, public quality = 1) {\n    super();\n  }\n}\n","import { vec2 } from \"gl-matrix\";\nimport { BitmapFilter } from \"./BitmapFilter\";\nimport {\n  DropShadowFilterInstance,\n  DropShadowFilter as RenderDropShadowFilter,\n} from \"../../../internal/render2/filter/DropShadowFilter\";\n\nexport class DropShadowFilter extends BitmapFilter {\n  get __filter(): DropShadowFilterInstance {\n    return {\n      filter: RenderDropShadowFilter.instance,\n      paddings: vec2.fromValues(\n        this.blurX + this.distance,\n        this.blurY + this.distance\n      ),\n      blurX: this.blurX,\n      blurY: this.blurY,\n      passes: this.quality,\n      color: this.color,\n      strength: this.strength,\n      angle: (this.angle * Math.PI) / 180,\n      distance: this.distance,\n      knockout: this.knockout,\n    };\n  }\n\n  blurX = 0;\n  blurY = 0;\n  quality = 3;\n  color = 0xffffff;\n  strength = 1;\n  angle = 45;\n  distance = 4;\n  knockout = false;\n  hideObject = false;\n  inner = false;\n}\n","import { vec4 } from \"gl-matrix\";\nimport { SceneNode } from \"../../../internal/render2/SceneNode\";\n\nexport class ColorTransform {\n  __node: SceneNode | null = null;\n  __mul: vec4;\n  __add: vec4;\n\n  constructor(\n    redMul = 1,\n    greenMul = 1,\n    blueMul = 1,\n    alphaMul = 1,\n    redAdd = 0,\n    greenAdd = 0,\n    blueAdd = 0,\n    alphaAdd = 0\n  ) {\n    this.__mul = vec4.fromValues(redMul, greenMul, blueMul, alphaMul);\n    this.__add = vec4.fromValues(redAdd, greenAdd, blueAdd, alphaAdd);\n  }\n\n  get redMultiplier() {\n    return this.__mul[0];\n  }\n  set redMultiplier(value) {\n    this.__mul[0] = value;\n  }\n\n  get greenMultiplier() {\n    return this.__mul[1];\n  }\n  set greenMultiplier(value) {\n    this.__mul[1] = value;\n  }\n\n  get blueMultiplier() {\n    return this.__mul[2];\n  }\n  set blueMultiplier(value) {\n    this.__mul[2] = value;\n  }\n\n  get alphaMultiplier() {\n    return this.__mul[3];\n  }\n  set alphaMultiplier(value) {\n    this.__mul[3] = value;\n  }\n\n  get redOffset() {\n    return this.__add[0];\n  }\n  set redOffset(value) {\n    this.__add[0] = value;\n  }\n\n  get greenOffset() {\n    return this.__add[1];\n  }\n  set greenOffset(value) {\n    this.__add[1] = value;\n  }\n\n  get blueOffset() {\n    return this.__add[2];\n  }\n  set blueOffset(value) {\n    this.__add[2] = value;\n  }\n\n  get alphaOffset() {\n    return this.__add[3];\n  }\n  set alphaOffset(value) {\n    this.__add[3] = value;\n  }\n\n  __setNode(value: SceneNode | null) {\n    if (value) {\n      vec4.copy(value.colorTransformLocalMul, this.__mul);\n      vec4.copy(value.colorTransformLocalAdd, this.__add);\n      this.__mul = value.colorTransformLocalMul;\n      this.__add = value.colorTransformLocalAdd;\n    } else {\n      this.__mul = vec4.clone(this.__mul);\n      this.__add = vec4.clone(this.__add);\n    }\n    this.__node = value;\n  }\n\n  set color(value: number) {\n    this.__add[0] = (value >>> 16) & 0xff;\n    this.__add[1] = (value >>> 8) & 0xff;\n    this.__add[2] = (value >>> 0) & 0xff;\n    this.__mul[0] = 0;\n    this.__mul[1] = 0;\n    this.__mul[2] = 0;\n  }\n}\n","import { mat2d } from \"gl-matrix\";\nimport { SceneNode, roundTwips } from \"../../../internal/render2/SceneNode\";\n\nexport class Matrix {\n  __node: SceneNode | null = null;\n  __value: mat2d;\n\n  constructor(a = 1, b = 0, c = 0, d = 1, tx = 0, ty = 0) {\n    this.__value = mat2d.fromValues(a, b, c, d, tx, ty);\n  }\n\n  __setNode(value: SceneNode | null) {\n    if (value) {\n      mat2d.copy(value.transformLocal, this.__value);\n      this.__value = value.transformLocal;\n    } else {\n      this.__value = mat2d.clone(this.__value);\n    }\n  }\n\n  translate(dx: number, dy: number) {\n    this.__value[4] = roundTwips(this.__value[4] + dx);\n    this.__value[5] = roundTwips(this.__value[5] + dy);\n    this.__node?.markLayoutDirty();\n  }\n\n  scale(sx: number, sy: number) {\n    this.__value[0] *= sx;\n    this.__value[1] *= sy;\n    this.__value[2] *= sx;\n    this.__value[3] *= sy;\n    this.__value[4] = roundTwips(this.__value[4] * sx);\n    this.__value[5] = roundTwips(this.__value[5] * sy);\n    this.__node?.markLayoutDirty();\n  }\n\n  rotate(angle: number) {\n    const a = this.__value[0];\n    const b = this.__value[1];\n    const c = this.__value[2];\n    const d = this.__value[3];\n    const tx = this.__value[4];\n    const ty = this.__value[5];\n    const u = Math.sin(angle);\n    const v = Math.cos(angle);\n    this.__value[0] = a * u - b * v;\n    this.__value[1] = a * v + b * u;\n    this.__value[2] = c * u - d * v;\n    this.__value[3] = c * v + d * u;\n    this.__value[4] = roundTwips(tx * u - ty * v);\n    this.__value[5] = roundTwips(tx * v + ty * u);\n    this.__node?.markLayoutDirty();\n  }\n}\n","import { vec2 } from \"gl-matrix\";\n\nexport class Point {\n  readonly __value = vec2.create();\n\n  get x() {\n    return this.__value[0];\n  }\n  set x(value: number) {\n    this.__value[0] = value;\n  }\n\n  get y() {\n    return this.__value[1];\n  }\n  set y(value: number) {\n    this.__value[1] = value;\n  }\n\n  constructor(x = 0, y = 0) {\n    vec2.set(this.__value, x, y);\n  }\n}\n","import { rect } from \"../../../internal/math/rect\";\n\nexport class Rectangle {\n  static readonly __empty = new Rectangle();\n\n  readonly __rect: rect;\n\n  get x() {\n    return this.__rect[0];\n  }\n  set x(value) {\n    this.__rect[0] = value;\n  }\n\n  get y() {\n    return this.__rect[1];\n  }\n  set y(value) {\n    this.__rect[1] = value;\n  }\n\n  get width() {\n    return this.__rect[2];\n  }\n  set width(value) {\n    this.__rect[2] = value;\n  }\n\n  get height() {\n    return this.__rect[3];\n  }\n  set height(value) {\n    this.__rect[3] = value;\n  }\n\n  constructor(x = 0, y = 0, width = 0, height = 0) {\n    this.__rect = rect.fromValues(x, y, width, height);\n  }\n\n  equals(r: Rectangle) {\n    return rect.equals(this.__rect, r.__rect);\n  }\n}\n","import { Matrix } from \"./Matrix\";\nimport { ColorTransform } from \"./ColorTransform\";\nimport { SceneNode } from \"../../../internal/render2/SceneNode\";\n\nexport class Transform {\n  __node: SceneNode | null = null;\n  __matrix = new Matrix();\n  __colorTransform = new ColorTransform();\n\n  __setNode(value: SceneNode | null) {\n    this.__node = value;\n    this.matrix.__setNode(value);\n    this.colorTransform.__setNode(value);\n  }\n\n  get matrix() {\n    return this.__matrix;\n  }\n  set matrix(value) {\n    this.__matrix.__setNode(null);\n    this.__matrix = value;\n    this.__matrix.__setNode(this.__node);\n  }\n\n  get colorTransform() {\n    return this.__colorTransform;\n  }\n  set colorTransform(value) {\n    this.__colorTransform.__setNode(null);\n    this.__colorTransform = value;\n    this.__colorTransform.__setNode(this.__node);\n  }\n}\n","import { SoundChannel } from \"./SoundChannel\";\nimport { Sound } from \"./Sound\";\nimport { SoundInfo } from \"../../__internal/character\";\nimport { AssetLibrary } from \"../../__internal\";\n\nexport class SoundContext {\n  private readonly soundChannels = new Map<number, SoundChannel>();\n\n  syncSound(library: AssetLibrary, characterId: number, info: SoundInfo) {\n    if (info.syncNoMultiple || info.syncStop) {\n      this.soundChannels.get(characterId)?.stop();\n      this.soundChannels.delete(characterId);\n    }\n    if (info.syncStop) {\n      return;\n    }\n\n    const sound = library.instantiateCharacter(characterId) as Sound;\n\n    let playTime = 0;\n    let loops = 1;\n    if (info.inPoint != null) {\n      playTime = (info.inPoint / sound.__character!.audio.sampleRate) * 1000;\n    }\n    if (info.loopCount != null) {\n      loops = info.loopCount;\n    }\n\n    const channel = sound.play(playTime, loops);\n    this.soundChannels.set(characterId, channel);\n  }\n\n  stopSound(characterId: number) {\n    this.soundChannels.get(characterId)?.stop();\n  }\n}\n","import type { SoundChannel } from \"./SoundChannel\";\n\nexport const channels = new Set<SoundChannel>();\n","import { Event } from \"../events/Event\";\nimport { EventDispatcher } from \"../events/EventDispatcher\";\nimport { SoundTransform } from \"./SoundTransform\";\nimport { Audio, globalVolumeNode } from \"../../../internal/audio\";\nimport { channels } from \"./channels\";\n\nexport class SoundChannel extends EventDispatcher {\n  private __soundTransform: SoundTransform;\n  private isStopped = false;\n  private readonly __audioNode: AudioBufferSourceNode;\n  private readonly __volumeNode: GainNode;\n  private readonly __beginTime: number;\n  private readonly __duration: number;\n\n  constructor(\n    buffer: AudioBuffer,\n    soundTransform: SoundTransform,\n    startTime: number,\n    loops: number\n  ) {\n    super();\n\n    this.__audioNode = Audio.createBufferSource();\n    this.__volumeNode = Audio.createGain();\n    this.__audioNode.buffer = buffer;\n    this.__audioNode.connect(this.__volumeNode);\n    this.__volumeNode.connect(globalVolumeNode);\n    if (Audio.state === \"suspended\") {\n      Audio.resume();\n    }\n\n    this.__soundTransform = soundTransform;\n    this.__soundTransform.__source = this;\n    this.__updateSoundTransform();\n\n    const currentTime = Audio.currentTime;\n    this.__beginTime = currentTime - startTime;\n    this.__duration = buffer.duration;\n\n    this.__audioNode.loop = true;\n    this.__audioNode.loopStart = 0;\n    this.__audioNode.start(currentTime, startTime);\n    this.__audioNode.stop(\n      this.__beginTime + Math.min(Math.max(1, loops) * this.__duration, 1000000)\n    );\n\n    this.__audioNode.onended = () => {\n      this.__volumeNode.disconnect();\n      this.__audioNode.disconnect();\n      channels.delete(this);\n      if (!this.isStopped) {\n        this.dispatchEvent(new Event(Event.SOUND_COMPLETE, false, false));\n      }\n    };\n\n    channels.add(this);\n  }\n\n  get soundTransform() {\n    return this.__soundTransform;\n  }\n\n  set soundTransform(value) {\n    this.__soundTransform.__source = null;\n    this.__soundTransform = value;\n    this.__soundTransform.__source = this;\n    this.__updateSoundTransform();\n  }\n\n  get position(): number {\n    return ((Audio.currentTime - this.__beginTime) % this.__duration) * 1000;\n  }\n\n  stop() {\n    this.isStopped = true;\n    this.__audioNode.stop();\n  }\n\n  __updateSoundTransform() {\n    this.__volumeNode.gain.setValueAtTime(\n      this.__soundTransform.volume,\n      Audio.currentTime\n    );\n  }\n}\n","interface SoundSource {\n  __updateSoundTransform(): void;\n}\n\nexport class SoundTransform {\n  __source: SoundSource | null = null;\n  private __volume: number;\n\n  get volume() {\n    return this.__volume;\n  }\n  set volume(value) {\n    this.__volume = value;\n    this.__source?.__updateSoundTransform();\n  }\n\n  constructor(volume = 1) {\n    this.__volume = volume;\n  }\n}\n","import { EventDispatcher } from \"../events/EventDispatcher\";\nimport { SoundInstance } from \"../../../internal/character/SoundInstance\";\nimport { SoundChannel } from \"./SoundChannel\";\nimport { SoundTransform } from \"./SoundTransform\";\nimport { Audio } from \"../../../internal/audio\";\n\nexport class Sound extends EventDispatcher {\n  static __character?: SoundInstance;\n\n  readonly __character: SoundInstance | null;\n\n  constructor() {\n    super();\n\n    this.__character = (this.constructor as typeof Sound).__character ?? null;\n  }\n\n  get length(): number {\n    return (this.__character?.audio.duration ?? 0) * 1000;\n  }\n\n  play(\n    playTime = 0,\n    loops = 0,\n    transform: SoundTransform | null = null\n  ): SoundChannel {\n    if (!this.__character) {\n      throw new Error(\"Sound character not exist\");\n    }\n\n    return new SoundChannel(\n      this.__character.audio,\n      transform ?? new SoundTransform(),\n      playTime / 1000,\n      loops\n    );\n  }\n}\n","import { SoundTransform } from \"./SoundTransform\";\nimport { channels } from \"./channels\";\nimport { Audio, globalVolumeNode } from \"../../../internal/audio\";\n\nexport class SoundMixer {\n  private static __soundTransform = new SoundTransform();\n\n  static get soundTransform() {\n    return SoundMixer.__soundTransform;\n  }\n\n  static set soundTransform(value) {\n    SoundMixer.__soundTransform.__source = null;\n    SoundMixer.__soundTransform = value;\n    SoundMixer.__soundTransform.__source = SoundMixer;\n    SoundMixer.__updateSoundTransform();\n  }\n\n  static stopAll() {\n    for (const channel of channels) {\n      channel.stop();\n    }\n  }\n\n  static __updateSoundTransform() {\n    globalVolumeNode.gain.setValueAtTime(\n      this.soundTransform.volume,\n      Audio.currentTime\n    );\n  }\n}\n","import { DisplayObject } from \"../display/DisplayObject\";\nimport { StaticTextInstance } from \"../../../internal/character/StaticTextInstance\";\n\nexport class StaticText extends DisplayObject {\n  static __character?: StaticTextInstance;\n\n  declare __character: StaticTextInstance | null;\n\n  constructor() {\n    super();\n\n    this.__character =\n      (this.constructor as typeof StaticText).__character ?? null;\n    this.__character?.applyTo(this);\n  }\n}\n","import { TextFormatAlign } from \"./TextFormatAlign\";\n\nexport class TextFormat {\n  align: TextFormatAlign = TextFormatAlign.LEFT;\n  bold = false;\n  italic = false;\n  color = 0x000000;\n  font = \"Times New Roman\";\n  size = 12;\n  leading = 0;\n\n  __clone() {\n    const format = new TextFormat();\n    format.align = this.align;\n    format.bold = this.bold;\n    format.italic = this.italic;\n    format.color = this.color;\n    format.font = this.font;\n    format.size = this.size;\n    format.leading = this.leading;\n    return format;\n  }\n}\n","export enum TextFormatAlign {\n  CENTER = \"center\",\n  END = \"end\",\n  JUSTIFY = \"justify\",\n  LEFT = \"left\",\n  RIGHT = \"right\",\n  START = \"start\",\n}\n","export enum TextFieldType {\n  DYNAMIC = \"dynamic\",\n  INPUT = \"input\",\n}\n","import { Container } from \"../../__internal/text/Container\";\nimport { InteractiveObject } from \"../display/InteractiveObject\";\nimport { EditTextInstance } from \"../../../internal/character/EditTextInstance\";\nimport { TextFieldType } from \"./TextFieldType\";\n\nexport class TextField extends InteractiveObject {\n  static __character?: EditTextInstance;\n\n  declare __character: EditTextInstance | null;\n\n  constructor() {\n    super();\n\n    this.__character =\n      (this.constructor as typeof TextField).__character ?? null;\n    this.__character?.applyTo(this);\n  }\n\n  readonly __container = new Container(this.__node);\n\n  type: TextFieldType = TextFieldType.DYNAMIC;\n\n  selectable = true;\n\n  get wordWrap() {\n    return this.__container.wordWrap;\n  }\n  set wordWrap(value) {\n    this.__container.wordWrap = value;\n  }\n\n  get multiline() {\n    return this.__container.multiline;\n  }\n  set multiline(value) {\n    this.__container.multiline = value;\n  }\n\n  get defaultTextFormat() {\n    return this.__container.defaultTextFormat;\n  }\n  set defaultTextFormat(value) {\n    this.__container.defaultTextFormat = value;\n  }\n\n  get textColor() {\n    return this.__container.defaultTextFormat.color;\n  }\n  set textColor(value) {\n    this.__container.defaultTextFormat.color = value;\n  }\n\n  get text() {\n    return this.__container.text;\n  }\n  set text(value) {\n    this.__container.text = value;\n  }\n\n  get htmlText() {\n    return this.__container.htmlText;\n  }\n  set htmlText(value) {\n    this.__container.htmlText = value;\n  }\n}\n","export class Keyboard {\n  static NUMBER_0: number = 48;\n  static NUMBER_1: number = 49;\n  static NUMBER_2: number = 50;\n  static NUMBER_3: number = 51;\n  static NUMBER_4: number = 52;\n  static NUMBER_5: number = 53;\n  static NUMBER_6: number = 54;\n  static NUMBER_7: number = 55;\n  static NUMBER_8: number = 56;\n  static NUMBER_9: number = 57;\n  static A: number = 65;\n  static B: number = 66;\n  static C: number = 67;\n  static D: number = 68;\n  static E: number = 69;\n  static F: number = 70;\n  static G: number = 71;\n  static H: number = 72;\n  static I: number = 73;\n  static J: number = 74;\n  static K: number = 75;\n  static L: number = 76;\n  static M: number = 77;\n  static N: number = 78;\n  static O: number = 79;\n  static P: number = 80;\n  static Q: number = 81;\n  static R: number = 82;\n  static S: number = 83;\n  static T: number = 84;\n  static U: number = 85;\n  static V: number = 86;\n  static W: number = 87;\n  static X: number = 88;\n  static Y: number = 89;\n  static Z: number = 90;\n  static SEMICOLON: number = 186;\n  static EQUAL: number = 187;\n  static COMMA: number = 188;\n  static MINUS: number = 189;\n  static PERIOD: number = 190;\n  static SLASH: number = 191;\n  static BACKQUOTE: number = 192;\n  static LEFTBRACKET: number = 219;\n  static BACKSLASH: number = 220;\n  static RIGHTBRACKET: number = 221;\n  static QUOTE: number = 222;\n  static ALTERNATE: number = 18;\n  static BACKSPACE: number = 8;\n  static CAPS_LOCK: number = 20;\n  static COMMAND: number = 15;\n  static CONTROL: number = 17;\n  static DELETE: number = 46;\n  static DOWN: number = 40;\n  static END: number = 35;\n  static ENTER: number = 13;\n  static ESCAPE: number = 27;\n  static F1: number = 112;\n  static F2: number = 113;\n  static F3: number = 114;\n  static F4: number = 115;\n  static F5: number = 116;\n  static F6: number = 117;\n  static F7: number = 118;\n  static F8: number = 119;\n  static F9: number = 120;\n  static F10: number = 121;\n  static F11: number = 122;\n  static F12: number = 123;\n  static F13: number = 124;\n  static F14: number = 125;\n  static F15: number = 126;\n  static HOME: number = 36;\n  static INSERT: number = 45;\n  static LEFT: number = 37;\n  static NUMPAD: number = 21;\n  static NUMPAD_0: number = 96;\n  static NUMPAD_1: number = 97;\n  static NUMPAD_2: number = 98;\n  static NUMPAD_3: number = 99;\n  static NUMPAD_4: number = 100;\n  static NUMPAD_5: number = 101;\n  static NUMPAD_6: number = 102;\n  static NUMPAD_7: number = 103;\n  static NUMPAD_8: number = 104;\n  static NUMPAD_9: number = 105;\n  static NUMPAD_ADD: number = 107;\n  static NUMPAD_DECIMAL: number = 110;\n  static NUMPAD_DIVIDE: number = 111;\n  static NUMPAD_ENTER: number = 108;\n  static NUMPAD_MULTIPLY: number = 106;\n  static NUMPAD_SUBTRACT: number = 109;\n  static PAGE_DOWN: number = 34;\n  static PAGE_UP: number = 33;\n  static RIGHT: number = 39;\n  static SHIFT: number = 16;\n  static SPACE: number = 32;\n  static TAB: number = 9;\n  static UP: number = 38;\n  static RED: number = 16777216;\n  static GREEN: number = 16777217;\n  static YELLOW: number = 16777218;\n  static BLUE: number = 16777219;\n  static CHANNEL_UP: number = 16777220;\n  static CHANNEL_DOWN: number = 16777221;\n  static RECORD: number = 16777222;\n  static PLAY: number = 16777223;\n  static PAUSE: number = 16777224;\n  static STOP: number = 16777225;\n  static FAST_FORWARD: number = 16777226;\n  static REWIND: number = 16777227;\n  static SKIP_FORWARD: number = 16777228;\n  static SKIP_BACKWARD: number = 16777229;\n  static NEXT: number = 16777230;\n  static PREVIOUS: number = 16777231;\n  static LIVE: number = 16777232;\n  static LAST: number = 16777233;\n  static MENU: number = 16777234;\n  static INFO: number = 16777235;\n  static GUIDE: number = 16777236;\n  static EXIT: number = 16777237;\n  static BACK: number = 16777238;\n  static AUDIO: number = 16777239;\n  static SUBTITLE: number = 16777240;\n  static DVR: number = 16777241;\n  static VOD: number = 16777242;\n  static INPUT: number = 16777243;\n  static SETUP: number = 16777244;\n  static HELP: number = 16777245;\n  static MASTER_SHELL: number = 16777246;\n  static SEARCH: number = 16777247;\n\n  static codeMap: Record<string, number> = {\n    Digit0: Keyboard.NUMBER_0,\n    Digit1: Keyboard.NUMBER_1,\n    Digit2: Keyboard.NUMBER_2,\n    Digit3: Keyboard.NUMBER_3,\n    Digit4: Keyboard.NUMBER_4,\n    Digit5: Keyboard.NUMBER_5,\n    Digit6: Keyboard.NUMBER_6,\n    Digit7: Keyboard.NUMBER_7,\n    Digit8: Keyboard.NUMBER_8,\n    Digit9: Keyboard.NUMBER_9,\n\n    KeyA: Keyboard.A,\n    KeyB: Keyboard.B,\n    KeyC: Keyboard.C,\n    KeyD: Keyboard.D,\n    KeyE: Keyboard.E,\n    KeyF: Keyboard.F,\n    KeyG: Keyboard.G,\n    KeyH: Keyboard.H,\n    KeyJ: Keyboard.J,\n    KeyK: Keyboard.K,\n    KeyL: Keyboard.L,\n    KeyM: Keyboard.M,\n    KeyN: Keyboard.N,\n    KeyO: Keyboard.O,\n    KeyP: Keyboard.P,\n    KeyQ: Keyboard.Q,\n    KeyR: Keyboard.R,\n    KeyS: Keyboard.S,\n    KeyT: Keyboard.T,\n    KeyU: Keyboard.U,\n    KeyV: Keyboard.V,\n    KeyW: Keyboard.W,\n    KeyX: Keyboard.X,\n    KeyY: Keyboard.Y,\n    KeyZ: Keyboard.Z,\n\n    Semicolon: Keyboard.SEMICOLON,\n    Equal: Keyboard.EQUAL,\n    Comma: Keyboard.COMMA,\n    Minus: Keyboard.MINUS,\n    Period: Keyboard.PERIOD,\n    Slash: Keyboard.SLASH,\n    Backquote: Keyboard.BACKQUOTE,\n    BracketLeft: Keyboard.LEFTBRACKET,\n    Backslash: Keyboard.BACKSLASH,\n    BracketRight: Keyboard.RIGHTBRACKET,\n    Quote: Keyboard.QUOTE,\n    AltLeft: Keyboard.ALTERNATE,\n    AltRight: Keyboard.ALTERNATE,\n    Backspace: Keyboard.BACKSPACE,\n    CapsLock: Keyboard.CAPS_LOCK,\n    ControlLeft: Keyboard.CONTROL,\n    ControlRight: Keyboard.CONTROL,\n    Delete: Keyboard.DELETE,\n    ArrowDown: Keyboard.DOWN,\n    End: Keyboard.END,\n    Enter: Keyboard.ENTER,\n    Escape: Keyboard.ESCAPE,\n    F1: Keyboard.F1,\n    F2: Keyboard.F2,\n    F3: Keyboard.F3,\n    F4: Keyboard.F4,\n    F5: Keyboard.F5,\n    F6: Keyboard.F6,\n    F7: Keyboard.F7,\n    F8: Keyboard.F8,\n    F9: Keyboard.F9,\n    F10: Keyboard.F10,\n    F11: Keyboard.F11,\n    F12: Keyboard.F12,\n    F13: Keyboard.F13,\n    F14: Keyboard.F14,\n    F15: Keyboard.F15,\n    Home: Keyboard.HOME,\n    Insert: Keyboard.INSERT,\n    ArrowLeft: Keyboard.LEFT,\n    Numpad0: Keyboard.NUMPAD_0,\n    Numpad1: Keyboard.NUMPAD_1,\n    Numpad2: Keyboard.NUMPAD_2,\n    Numpad3: Keyboard.NUMPAD_3,\n    Numpad4: Keyboard.NUMPAD_4,\n    Numpad5: Keyboard.NUMPAD_5,\n    Numpad6: Keyboard.NUMPAD_6,\n    Numpad7: Keyboard.NUMPAD_7,\n    Numpad8: Keyboard.NUMPAD_8,\n    Numpad9: Keyboard.NUMPAD_9,\n    NumpadAdd: Keyboard.NUMPAD_ADD,\n    NumpadDecimal: Keyboard.NUMPAD_DECIMAL,\n    NumpadDivide: Keyboard.NUMPAD_DIVIDE,\n    NumpadEnter: Keyboard.NUMPAD_ENTER,\n    NumpadMultiply: Keyboard.NUMPAD_MULTIPLY,\n    NumpadSubtract: Keyboard.NUMPAD_SUBTRACT,\n    PageDown: Keyboard.PAGE_DOWN,\n    PageUp: Keyboard.PAGE_UP,\n    ArrowRight: Keyboard.RIGHT,\n    ShiftLeft: Keyboard.SHIFT,\n    ShiftRight: Keyboard.SHIFT,\n    Space: Keyboard.SPACE,\n    Tab: Keyboard.TAB,\n    ArrowUp: Keyboard.UP,\n  };\n}\n","import { vec2 } from \"gl-matrix\";\nimport { BitmapFilter } from \"./BitmapFilter\";\nimport {\n  DropShadowFilterInstance,\n  DropShadowFilter as RenderDropShadowFilter,\n} from \"../../../internal/render2/filter/DropShadowFilter\";\n\nexport class GlowFilter extends BitmapFilter {\n  get __filter(): DropShadowFilterInstance {\n    return {\n      filter: RenderDropShadowFilter.instance,\n      paddings: vec2.fromValues(this.blurX, this.blurY),\n      blurX: this.blurX,\n      blurY: this.blurY,\n      passes: this.quality,\n      color: Math.floor(this.alpha * 0xff) * 0x1000000 + this.color,\n      strength: this.strength,\n      angle: 0,\n      distance: 0,\n      knockout: this.knockout,\n    };\n  }\n\n  constructor(\n    public color = 0xff0000,\n    public alpha = 1.0,\n    public blurX = 6.0,\n    public blurY = 6.0,\n    public strength = 2,\n    public quality = 1,\n    public inner = false,\n    public knockout = false\n  ) {\n    super();\n  }\n}\n","export class URLRequest {\n  url: string;\n\n  constructor(url: string) {\n    this.url = url;\n  }\n}\n","import { EventDispatcher } from \"../events/EventDispatcher\";\n\nexport class SharedObject extends EventDispatcher {\n  readonly data: any;\n\n  private constructor(private readonly name: string) {\n    super();\n    try {\n      this.data = JSON.parse(localStorage[name]) || {};\n    } catch {\n      this.data = {};\n    }\n  }\n\n  static getLocal(name: string): SharedObject {\n    return new SharedObject(name);\n  }\n\n  flush() {\n    localStorage[this.name] = JSON.stringify(this.data);\n  }\n}\n","import { URLRequest } from \"./URLRequest\";\n\nexport function navigateToURL(request: URLRequest, target?: string) {\n  window.open(request.url, target);\n}\n","import { EventDispatcher } from \"../events/EventDispatcher\";\n\nexport class Timer extends EventDispatcher {\n  constructor(public delay = 0, repeatCount = 0) {\n    super();\n  }\n\n  start() {}\n  stop() {}\n}\n","import { Class } from \"../../__internal/avm2/Class\";\nimport { ClassRegistry } from \"../../__internal\";\n\nexport function getTimer() {\n  return +new Date();\n}\n\nexport function getDefinitionByName(name: string): Class | null {\n  const classFn = ClassRegistry.instance.classes.get(name);\n  return classFn ?? null;\n}\n","import * as classes from \"./classes\";\n\nexport default classes;\n","export const Audio = new AudioContext();\n\nexport const globalVolumeNode = Audio.createGain();\n\nglobalVolumeNode.connect(Audio.destination);\n","import { SimpleButton } from \"../../classes/flash/display/SimpleButton\";\nimport { Sprite } from \"../../classes/flash/display/Sprite\";\nimport {\n  ButtonCharacter,\n  ButtonRecord,\n  ButtonSound,\n} from \"../../classes/__internal/character/Button\";\nimport { FrameActionKind } from \"../../classes/__internal/character/Sprite\";\nimport type { AssetLibrary } from \"../../classes/__internal\";\nimport { CharacterInstance } from \"./CharacterInstance\";\nimport {\n  executeActionPlaceObject,\n  updateFrameMasks,\n  executeActionStartSound,\n} from \"./frame\";\n\nexport enum ButtonState {\n  Up,\n  Over,\n  Down,\n  HitTest,\n}\n\nexport class ButtonInstance implements CharacterInstance {\n  constructor(\n    readonly id: number,\n    readonly def: ButtonCharacter,\n    readonly library: AssetLibrary\n  ) {}\n\n  applyTo(button: SimpleButton) {\n    this.instantiateState(button, ButtonState.Up);\n    this.instantiateState(button, ButtonState.Over);\n    this.instantiateState(button, ButtonState.Down);\n    this.instantiateState(button, ButtonState.HitTest);\n    button.trackAsMenu = this.def.trackAsMenu;\n  }\n\n  instantiateState(button: SimpleButton, state: ButtonState) {\n    const stateContainer = new Sprite();\n\n    let inState: (record: ButtonRecord) => boolean;\n    switch (state) {\n      case ButtonState.Up:\n        inState = (record) => record.up;\n        break;\n      case ButtonState.Over:\n        inState = (record) => record.over;\n        break;\n      case ButtonState.Down:\n        inState = (record) => record.down;\n        break;\n      case ButtonState.HitTest:\n        inState = (record) => record.hitTest;\n        break;\n    }\n\n    for (const record of this.def.characters) {\n      if (!inState(record)) {\n        continue;\n      }\n      executeActionPlaceObject(this.library, stateContainer, {\n        kind: FrameActionKind.PlaceObject,\n        depth: record.depth,\n        characterId: record.characterId,\n        moveCharacter: false,\n        version: 3,\n\n        matrix: record.matrix,\n        colorTransform: record.colorTransform,\n        filters: record.filters,\n        blendMode: record.blendMode,\n      });\n    }\n    updateFrameMasks(stateContainer);\n\n    switch (state) {\n      case ButtonState.Up:\n        button.upState = stateContainer;\n        break;\n      case ButtonState.Over:\n        button.overState = stateContainer;\n        break;\n      case ButtonState.Down:\n        button.downState = stateContainer;\n        break;\n      case ButtonState.HitTest:\n        button.hitTestState = stateContainer;\n        break;\n    }\n  }\n\n  stateTransition(button: SimpleButton, from: ButtonState, to: ButtonState) {\n    let sound: ButtonSound | undefined;\n    if (from === ButtonState.Over && to === ButtonState.Up) {\n      sound = this.def.overUpToIdle;\n    } else if (from === ButtonState.Up && to === ButtonState.Over) {\n      sound = this.def.idleToOverUp;\n    } else if (from === ButtonState.Over && to === ButtonState.Down) {\n      sound = this.def.overUpToOverDown;\n    } else if (from === ButtonState.Down && to === ButtonState.Over) {\n      sound = this.def.idleToOverUp;\n    }\n    if (!sound) {\n      return;\n    }\n\n    executeActionStartSound(this.library, button.__soundContext, {\n      kind: FrameActionKind.StartSound,\n      characterId: sound.characterId,\n      soundInfo: sound.soundInfo,\n    });\n  }\n}\n","export type Filter = FilterDropShadow | FilterBlur;\n\nexport enum FilterID {\n  DropShadow = 0,\n  Blur = 1,\n}\n\nexport interface FilterDropShadow {\n  id: FilterID.DropShadow;\n  color: number;\n  blurX: number;\n  blurY: number;\n  angle: number;\n  distance: number;\n  strength: number;\n  inner: boolean;\n  knockout: boolean;\n  compositeSource: boolean;\n  passes: number;\n}\n\nexport interface FilterBlur {\n  id: FilterID.Blur;\n  blurX: number;\n  blurY: number;\n  passes: number;\n}\n","import { mat2d, vec4 } from \"gl-matrix\";\nimport { DisplayObject } from \"../../classes/flash/display/DisplayObject\";\nimport { DisplayObjectContainer } from \"../../classes/flash/display/DisplayObjectContainer\";\nimport { MorphShape } from \"../../classes/flash/display/MorphShape\";\nimport { MovieClip } from \"../../classes/flash/display\";\nimport { BitmapFilter } from \"../../classes/flash/filters/BitmapFilter\";\nimport { BlurFilter } from \"../../classes/flash/filters/BlurFilter\";\nimport { DropShadowFilter } from \"../../classes/flash/filters/DropShadowFilter\";\nimport {\n  FrameActionPlaceObject,\n  FrameActionRemoveObject,\n  FrameActionStartSound,\n} from \"../../classes/__internal/character/Sprite\";\nimport { FilterID } from \"../../classes/__internal/character/filter\";\nimport { AssetLibrary } from \"../../classes/__internal/AssetLibrary\";\nimport { SoundContext } from \"../../classes/flash/media/context\";\nimport { Sound } from \"../../classes/flash/media\";\n\n// ref: https://github.com/mozilla/shumway/blob/16451d8836fa85f4b16eeda8b4bda2fa9e2b22b0/src/flash/display/DisplayObject.ts#L1137\n\nexport function executeActionPlaceObject(\n  library: AssetLibrary,\n  container: DisplayObjectContainer,\n  action: FrameActionPlaceObject\n) {\n  const children = container.__children;\n  let character: DisplayObject | undefined;\n  if (action.characterId) {\n    let index = children.findIndex((o) => o.__depth >= action.depth);\n    let oldCharacter: DisplayObject | null = null;\n    if (index === -1) {\n      index = children.length;\n    } else if (children[index].__depth === action.depth) {\n      const char = children[index].__character;\n      if (char?.id === action.characterId) {\n        character = children[index];\n      } else {\n        oldCharacter = children[index];\n        container.removeChildAt(index);\n      }\n    }\n\n    if (character) {\n      setupCharacter(container, character, action, !action.moveCharacter);\n    } else {\n      const { characterId, depth } = action;\n      DisplayObject.__initChar(\n        () => library.instantiateCharacter<DisplayObject>(characterId),\n        (char) => {\n          container.addChildAt(char, index);\n          char.__depth = depth;\n          if (oldCharacter) {\n            // When same depth is re-used for new character,\n            // it seems attributes of old character would carry over to new character.\n            copyCharacter(oldCharacter, char);\n          }\n          setupCharacter(container, char, action, !action.moveCharacter);\n        }\n      );\n    }\n  } else {\n    character = children.find((o) => o.__depth === action.depth);\n    if (character) {\n      setupCharacter(container, character, action, false);\n    }\n  }\n}\n\nexport function executeActionRemoveObject(\n  container: DisplayObjectContainer,\n  action: FrameActionRemoveObject\n) {\n  const index = container.__children.findIndex(\n    (o) => o.__depth === action.depth\n  );\n  if (index < 0) {\n    return;\n  }\n\n  container.removeChildAt(index);\n}\n\nexport function executeActionStartSound(\n  library: AssetLibrary,\n  ctx: SoundContext,\n  action: FrameActionStartSound\n) {\n  ctx.syncSound(library, action.characterId, action.soundInfo);\n}\n\nfunction copyCharacter(from: DisplayObject, to: DisplayObject) {\n  mat2d.copy(to.__node.transformLocal, from.__node.transformLocal);\n  vec4.copy(\n    to.__node.colorTransformLocalMul,\n    from.__node.colorTransformLocalMul\n  );\n  vec4.copy(\n    to.__node.colorTransformLocalAdd,\n    from.__node.colorTransformLocalMul\n  );\n  to.__clipDepth = from.__clipDepth;\n  to.name = from.name;\n  to.filters = from.filters;\n  to.cacheAsBitmap = from.cacheAsBitmap;\n  to.visible = from.visible;\n}\n\nfunction setupCharacter(\n  container: DisplayObjectContainer,\n  character: DisplayObject,\n  action: FrameActionPlaceObject,\n  reset: boolean\n) {\n  if (action.matrix != null) {\n    mat2d.copy(character.__node.transformLocal, action.matrix);\n    character.__node.transformLocal[4] /= 20;\n    character.__node.transformLocal[5] /= 20;\n    character.__node.markLayoutDirty();\n  } else if (reset) {\n    mat2d.identity(character.__node.transformLocal);\n    character.__node.markLayoutDirty();\n  }\n\n  if (action.colorTransform != null) {\n    vec4.copy(\n      character.__node.colorTransformLocalMul,\n      action.colorTransform.slice(0, 4) as vec4\n    );\n    vec4.copy(\n      character.__node.colorTransformLocalAdd,\n      action.colorTransform.slice(4, 8) as vec4\n    );\n  } else if (reset) {\n    vec4.set(character.__node.colorTransformLocalMul, 1, 1, 1, 1);\n    vec4.set(character.__node.colorTransformLocalAdd, 0, 0, 0, 0);\n  }\n\n  if (action.version <= 1) {\n    return;\n  }\n\n  if (action.clipDepth != null) {\n    character.__clipDepth = action.clipDepth;\n  } else if (reset) {\n    character.__clipDepth = -1;\n  }\n\n  if (character instanceof MorphShape) {\n    if (action.ratio != null) {\n      character.__ratio = action.ratio;\n      character.__character?.applyTo(character);\n    } else if (reset) {\n      character.__ratio = 0;\n      character.__character?.applyTo(character);\n    }\n  }\n\n  if (action.name != null) {\n    character.name = action.name;\n    (container as any)[character.name] = character;\n  }\n\n  if (action.version <= 2) {\n    return;\n  }\n\n  if (action.filters != null) {\n    const filters: BitmapFilter[] = [];\n    for (const f of action.filters) {\n      switch (f.id) {\n        case FilterID.Blur: {\n          const filter = new BlurFilter();\n          filter.blurX = f.blurX;\n          filter.blurY = f.blurY;\n          filter.quality = f.passes;\n\n          filters.push(filter);\n          break;\n        }\n        case FilterID.DropShadow: {\n          const filter = new DropShadowFilter();\n          filter.color = f.color;\n          filter.blurX = f.blurX;\n          filter.blurY = f.blurY;\n          filter.angle = (f.angle * 180) / Math.PI;\n          filter.distance = f.distance;\n          filter.strength = f.strength;\n          filter.inner = f.inner;\n          filter.knockout = f.knockout;\n          filter.quality = f.passes;\n\n          filters.push(filter);\n          break;\n        }\n      }\n    }\n    character.filters = filters;\n  } else if (reset) {\n    character.filters = [];\n  }\n\n  if (action.cacheAsBitmap != null) {\n    character.cacheAsBitmap = action.cacheAsBitmap;\n  } else if (reset) {\n    character.cacheAsBitmap = false;\n  }\n\n  if (action.visible != null) {\n    character.visible = action.visible;\n  } else if (reset) {\n    character.visible = true;\n  }\n\n  // TODO: blendMode\n}\n\nexport function updateFrameMasks(container: DisplayObjectContainer) {\n  const clips: DisplayObject[] = [];\n  for (const child of container.__children) {\n    if (child.__clipDepth >= 0) {\n      clips.push(child);\n    }\n  }\n  for (const child of container.__children) {\n    for (const clip of clips) {\n      if (child.__depth > clip.__depth && child.__depth <= clip.__clipDepth) {\n        child.mask = clip;\n      }\n    }\n  }\n}\n","import { vec4 } from \"gl-matrix\";\n\nexport function preMultiplyAlpha(color: number): number {\n  let a = (color >>> 24) & 0xff;\n  let r = (color >>> 16) & 0xff;\n  let g = (color >>> 8) & 0xff;\n  let b = (color >>> 0) & 0xff;\n  const alpha = a / 0xff;\n  r = Math.round(r * alpha) & 0xff;\n  g = Math.round(g * alpha) & 0xff;\n  b = Math.round(b * alpha) & 0xff;\n  return r * 0x1 + g * 0x100 + b * 0x10000 + a * 0x1000000;\n}\n\nexport function decomposeColorVec(out: vec4, color: number): vec4 {\n  out[0] = ((color >>> 0) & 0xff) / 0xff;\n  out[1] = ((color >>> 8) & 0xff) / 0xff;\n  out[2] = ((color >>> 16) & 0xff) / 0xff;\n  out[3] = ((color >>> 24) & 0xff) / 0xff;\n  return out;\n}\n\nexport function multiplyColorTransform(\n  outMul: vec4,\n  outAdd: vec4,\n  parentMul: vec4,\n  parentAdd: vec4,\n  childMul: vec4,\n  childAdd: vec4\n) {\n  vec4.mul(outMul, childMul, parentMul);\n  vec4.mul(outAdd, childAdd, parentMul);\n  vec4.add(outAdd, outAdd, parentAdd);\n}\n","import { mat2d } from \"gl-matrix\";\n\nexport function projection(\n  out: mat2d,\n  width: number,\n  height: number,\n  invertY: boolean\n) {\n  mat2d.identity(out);\n  out[0] = 2 / width;\n  out[3] = (invertY ? -2 : 2) / height;\n  out[4] = -1;\n  out[5] = invertY ? 1 : -1;\n  return out;\n}\n","import { mat2d, vec2 } from \"gl-matrix\";\n\nexport type rect = Float32Array;\n\nconst epsilon = 1e-6;\n\nexport const rect = {\n  create(): rect {\n    return Float32Array.of(0, 0, 0, 0);\n  },\n  fromValues(x: number, y: number, width: number, height: number): rect {\n    return Float32Array.of(x, y, width, height);\n  },\n  copy(out: rect, rect: rect) {\n    out[0] = rect[0];\n    out[1] = rect[1];\n    out[2] = rect[2];\n    out[3] = rect[3];\n    return out;\n  },\n  equals(a: rect, b: rect) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n  },\n  intersects(a: rect, b: rect) {\n    return (\n      a[0] - (b[0] + b[2]) < -epsilon &&\n      b[0] - (a[0] + a[2]) < -epsilon &&\n      a[1] - (b[1] + b[3]) < -epsilon &&\n      b[1] - (a[1] + a[3]) < -epsilon\n    );\n  },\n  contains(rect: rect, x: number, y: number) {\n    return (\n      x >= rect[0] &&\n      x < rect[0] + rect[2] &&\n      y >= rect[1] &&\n      y < rect[1] + rect[3]\n    );\n  },\n  clear(out: rect) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    return out;\n  },\n  scale(out: rect, rect: rect, factor: number) {\n    out[0] = rect[0] * factor;\n    out[1] = rect[1] * factor;\n    out[2] = rect[2] * factor;\n    out[3] = rect[3] * factor;\n    return out;\n  },\n  translate(out: rect, rect: rect, t: vec2) {\n    out[0] = rect[0] + t[0];\n    out[1] = rect[1] + t[1];\n    out[2] = rect[2];\n    out[3] = rect[3];\n    return out;\n  },\n  union(out: rect, a: rect, b: rect) {\n    if (a[2] === 0 || a[3] === 0) {\n      rect.copy(out, b);\n    } else if (b[2] === 0 || b[3] === 0) {\n      rect.copy(out, a);\n    }\n\n    const minX = Math.min(a[0], b[0]);\n    const minY = Math.min(a[1], b[1]);\n    const maxX = Math.max(a[0] + a[2], b[0] + b[2]);\n    const maxY = Math.max(a[1] + a[3], b[1] + b[3]);\n\n    out[0] = minX;\n    out[1] = minY;\n    out[2] = maxX - minX;\n    out[3] = maxY - minY;\n    return out;\n  },\n  apply(out: rect, rect: rect, mat: mat2d) {\n    const vec: [number, number] = [0, 0];\n    let [x, y] = vec2.transformMat2d(vec, [rect[0], rect[1]], mat);\n    let minX = x,\n      minY = y,\n      maxX = x,\n      maxY = y;\n\n    [x, y] = vec2.transformMat2d(vec, [rect[0] + rect[2], rect[1]], mat);\n    minX = Math.min(minX, x);\n    minY = Math.min(minY, y);\n    maxX = Math.max(maxX, x);\n    maxY = Math.max(maxY, y);\n\n    [x, y] = vec2.transformMat2d(vec, [rect[0], rect[1] + rect[3]], mat);\n    minX = Math.min(minX, x);\n    minY = Math.min(minY, y);\n    maxX = Math.max(maxX, x);\n    maxY = Math.max(maxY, y);\n\n    [x, y] = vec2.transformMat2d(\n      vec,\n      [rect[0] + rect[2], rect[1] + rect[3]],\n      mat\n    );\n    minX = Math.min(minX, x);\n    minY = Math.min(minY, y);\n    maxX = Math.max(maxX, x);\n    maxY = Math.max(maxY, y);\n\n    out[0] = minX;\n    out[1] = minY;\n    out[2] = maxX - minX;\n    out[3] = maxY - minY;\n    return out;\n  },\n};\n","import { rect } from \"../math/rect\";\nimport { mat2d, vec2 } from \"gl-matrix\";\nimport { Texture } from \"./gl/Texture\";\n\ninterface RenderObjectMerge {\n  renderObject: RenderObject;\n  color?: number;\n  transform: mat2d;\n}\n\ninterface RenderObjectRectOptions {\n  invertY?: boolean;\n  texWidth?: number;\n  texHeight?: number;\n}\n\nexport type RenderObjectKind = \"shape\" | \"text\";\n\nexport class RenderObject {\n  constructor(\n    readonly kind: RenderObjectKind,\n    readonly vertices: Float32Array,\n    readonly colors: Uint32Array,\n    readonly indices: Uint16Array,\n    readonly uvMatrix: mat2d,\n    public texture: HTMLImageElement | HTMLCanvasElement | Texture | null,\n    readonly fillMode: number,\n    readonly bounds: rect\n  ) {}\n\n  static rect(\n    bounds: rect,\n    texture: Texture,\n    opts?: RenderObjectRectOptions\n  ): RenderObject {\n    const {\n      invertY = false,\n      texWidth = texture.width,\n      texHeight = texture.height,\n    } = opts ?? {};\n\n    const vertices = new Float32Array(8);\n    vertices[0] = bounds[2];\n    vertices[1] = 0;\n    vertices[2] = 0;\n    vertices[3] = bounds[3];\n    vertices[4] = 0;\n    vertices[5] = 0;\n    vertices[6] = bounds[2];\n    vertices[7] = bounds[3];\n\n    const colors = new Uint32Array(4);\n    colors.fill(0xffffffff);\n\n    const indices = new Uint16Array(6);\n    indices[0] = 0;\n    indices[1] = 1;\n    indices[2] = 2;\n    indices[3] = 1;\n    indices[4] = 0;\n    indices[5] = 3;\n\n    const uvMatrix = mat2d.create();\n    mat2d.scale(uvMatrix, uvMatrix, [1 / texWidth, 1 / texHeight]);\n    if (invertY) {\n      mat2d.scale(uvMatrix, uvMatrix, [1, -1]);\n      mat2d.translate(uvMatrix, uvMatrix, [0, -texHeight]);\n    }\n    mat2d.translate(uvMatrix, uvMatrix, [bounds[0], bounds[1]]);\n\n    return new RenderObject(\n      \"shape\",\n      vertices,\n      colors,\n      indices,\n      uvMatrix,\n      texture,\n      0,\n      bounds\n    );\n  }\n\n  static line(\n    ax: number,\n    ay: number,\n    bx: number,\n    by: number,\n    width: number,\n    color: number\n  ): RenderObject {\n    const norm = normal(ax, ay, bx, by);\n    const radius = width / 2;\n\n    const vertices = new Float32Array(8);\n    vertices[0] = bx - norm[0] * radius;\n    vertices[1] = by - norm[1] * radius;\n    vertices[2] = ax + norm[0] * radius;\n    vertices[3] = ay + norm[1] * radius;\n    vertices[4] = ax - norm[0] * radius;\n    vertices[5] = ay - norm[1] * radius;\n    vertices[6] = bx + norm[0] * radius;\n    vertices[7] = by + norm[1] * radius;\n\n    const colors = new Uint32Array(4);\n    colors.fill(color);\n\n    const indices = new Uint16Array(6);\n    indices[0] = 0;\n    indices[1] = 1;\n    indices[2] = 2;\n    indices[3] = 1;\n    indices[4] = 0;\n    indices[5] = 3;\n\n    const uvMatrix = mat2d.create();\n    const bounds = rect.create();\n    bounds[0] = Math.min(ax, bx);\n    bounds[1] = Math.min(ay, by);\n    bounds[2] = Math.max(ax, bx) - bounds[0];\n    bounds[3] = Math.max(ay, by) - bounds[1];\n\n    return new RenderObject(\n      \"shape\",\n      vertices,\n      colors,\n      indices,\n      uvMatrix,\n      Texture.WHITE,\n      0,\n      bounds\n    );\n  }\n\n  hitTest(x: number, y: number, exact: boolean): boolean {\n    if (!exact) {\n      return rect.contains(this.bounds, x, y);\n    }\n    // https://stackoverflow.com/a/2049593\n    const sign = (ax: number, ay: number, bx: number, by: number) => {\n      return (x - bx) * (ay - by) - (ax - bx) * (y - by);\n    };\n\n    const vertices = this.vertices;\n    const indices = this.indices;\n    const numTriangles = indices.length / 3;\n    for (let i = 0; i < numTriangles; i++) {\n      const ax = vertices[indices[i * 3 + 0] * 2 + 0];\n      const ay = vertices[indices[i * 3 + 0] * 2 + 1];\n      const bx = vertices[indices[i * 3 + 1] * 2 + 0];\n      const by = vertices[indices[i * 3 + 1] * 2 + 1];\n      const cx = vertices[indices[i * 3 + 2] * 2 + 0];\n      const cy = vertices[indices[i * 3 + 2] * 2 + 1];\n\n      const d1 = sign(ax, ay, bx, by);\n      const d2 = sign(bx, by, cx, cy);\n      const d3 = sign(cx, cy, ax, ay);\n\n      const hasNegative = d1 < 0 || d2 < 0 || d3 < 0;\n      const hasPositive = d1 > 0 || d2 > 0 || d3 > 0;\n      if (!hasNegative || !hasPositive) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  static merge(\n    kind: RenderObjectKind,\n    input: RenderObjectMerge[]\n  ): RenderObject[] {\n    let numVertex = 0;\n    let numIndex = 0;\n    const subInput: RenderObjectMerge[] = [];\n    const result: RenderObject[] = [];\n\n    for (const i of input) {\n      if (numIndex + i.renderObject.indices.length >= 0x10000) {\n        result.push(doMerge(kind, subInput, numVertex, numIndex));\n        numVertex = 0;\n        numIndex = 0;\n        subInput.length = 0;\n      }\n\n      numVertex += i.renderObject.vertices.length / 2;\n      numIndex += i.renderObject.indices.length;\n      subInput.push(i);\n    }\n\n    if (numIndex > 0) {\n      result.push(doMerge(kind, subInput, numVertex, numIndex));\n    }\n    return result;\n  }\n}\n\nfunction doMerge(\n  kind: RenderObjectKind,\n  input: RenderObjectMerge[],\n  numVertex: number,\n  numIndex: number\n): RenderObject {\n  const vertices = new Float32Array(numVertex * 2);\n  const colors = new Uint32Array(numVertex);\n  const indices = new Uint16Array(numIndex);\n  const bounds = rect.create();\n  let vertexI = 0;\n  let indexI = 0;\n  for (const { renderObject, color, transform } of input) {\n    for (let i = 0; i < renderObject.vertices.length; i += 2) {\n      const outV = vertices.subarray(vertexI * 2 + i, vertexI * 2 + i + 2);\n      const inV = renderObject.vertices.subarray(i, i + 2);\n      vec2.transformMat2d(outV, inV, transform);\n    }\n    if (color == null) {\n      colors.set(renderObject.colors, vertexI);\n    } else {\n      colors.fill(color, vertexI, vertexI + renderObject.colors.length);\n    }\n    indices.set(\n      renderObject.indices.map((i) => i + vertexI),\n      indexI\n    );\n    rect.union(\n      bounds,\n      bounds,\n      rect.apply(rect.create(), renderObject.bounds, transform)\n    );\n\n    vertexI += renderObject.vertices.length / 2;\n    indexI += renderObject.indices.length;\n  }\n\n  return new RenderObject(\n    kind,\n    vertices,\n    colors,\n    indices,\n    mat2d.identity(mat2d.create()),\n    null,\n    0,\n    bounds\n  );\n}\n\nfunction normal(\n  ax: number,\n  ay: number,\n  bx: number,\n  by: number\n): [number, number] {\n  const dx = bx - ax;\n  const dy = by - ay;\n  const l = Math.sqrt(dx * dx + dy * dy);\n  return [-dy / l, dx / l];\n}\n","import { mat2d, vec2, vec4 } from \"gl-matrix\";\nimport { RenderObject } from \"./RenderObject\";\nimport { rect } from \"../math/rect\";\nimport { FilterInstance } from \"./filter/Filter\";\nimport { RenderContext } from \"./RenderContext\";\nimport { Texture } from \"./gl/Texture\";\nimport { CachedRender } from \"./CachedRender\";\n\nexport function roundTwips(value: number) {\n  return Math.round(value * 20) / 20;\n}\n\nconst enum Flags {\n  DirtyBounds = 1,\n  DirtyTransform = 2,\n  DirtyChildTransform = 4,\n  DirtyRender = 8, // FIXME: apply this flag correctly\n\n  DirtyAll = 15,\n\n  IsRoot = 128,\n}\n\nconst tmpRect1 = rect.create();\nconst tmpRect2 = rect.create();\nconst tmpMat2d1 = mat2d.create();\nconst tmpMat2d2 = mat2d.create();\nconst tmpVec2 = vec2.create();\n\nexport class SceneNode {\n  flags: number = Flags.DirtyAll;\n\n  parent: SceneNode | null = null;\n  mask: SceneNode | null = null;\n  children: SceneNode[] = [];\n\n  visible = true;\n  isMask = false;\n  buttonState = -1;\n  renderObjects: RenderObject[] = [];\n  readonly boundsIntrinsic = rect.create();\n\n  cacheAsBitmap = false;\n  cachedRender: CachedRender | null = null;\n  filters: FilterInstance[] = [];\n\n  readonly transformLocal = mat2d.create();\n  readonly colorTransformLocalMul = vec4.fromValues(1, 1, 1, 1);\n  readonly colorTransformLocalAdd = vec4.fromValues(0, 0, 0, 0);\n\n  readonly boundsLocal = rect.create();\n  readonly boundsWorld = rect.create();\n  readonly transformRender = mat2d.create();\n  readonly transformWorld = mat2d.create();\n  readonly transformWorldInvert = mat2d.create();\n\n  constructor(readonly object: unknown) {}\n\n  markRenderDirty() {\n    let node: SceneNode | null = this;\n    while (node) {\n      if ((node.flags & Flags.DirtyRender) !== 0) {\n        break;\n      }\n      node.flags |= Flags.DirtyRender;\n      node = node.parent;\n    }\n  }\n\n  markLayoutDirty(dirtyTransform = true) {\n    // Mark parent bounds dirty.\n    let node: SceneNode | null | undefined = this;\n    while (node) {\n      node.flags |= Flags.DirtyBounds;\n      node = node.parent;\n    }\n\n    if (!dirtyTransform) {\n      return;\n    }\n\n    // Mark parent child transform dirty.\n    node = this;\n    while (node) {\n      node.flags |= Flags.DirtyChildTransform;\n      node = node.parent;\n    }\n\n    // Mark children transform dirty.\n    const nodes: SceneNode[] = [this];\n    while ((node = nodes.pop())) {\n      node.flags |= Flags.DirtyTransform | Flags.DirtyChildTransform;\n      for (const child of node.children) {\n        nodes.push(child);\n      }\n    }\n  }\n\n  ensureLayout() {\n    const queue: SceneNode[] = [this];\n    let node: SceneNode | undefined;\n    while ((node = queue.pop())) {\n      // Ensure parent transform.\n      if (node.parent && (node.parent.flags & Flags.DirtyTransform) !== 0) {\n        queue.push(node.parent);\n        continue;\n      }\n\n      // Enqueue children to traverse.\n      if (node.flags & Flags.DirtyChildTransform) {\n        queue.push(...node.children);\n        node.flags &= ~Flags.DirtyChildTransform;\n      }\n\n      if ((node.flags & Flags.DirtyTransform) === 0) {\n        continue;\n      }\n\n      // Compute world/render transform.\n      if (!node.parent) {\n        mat2d.copy(tmpMat2d1, node.transformLocal);\n        mat2d.copy(tmpMat2d2, node.transformLocal);\n      } else {\n        mat2d.multiply(\n          tmpMat2d1,\n          node.parent.transformWorld,\n          node.transformLocal\n        );\n        mat2d.multiply(\n          tmpMat2d2,\n          node.parent.transformRender,\n          node.transformLocal\n        );\n      }\n      if (node.cacheAsBitmap) {\n        mat2d.identity(tmpMat2d2);\n      }\n      const updated = !mat2d.exactEquals(tmpMat2d1, node.transformWorld);\n      const renderDirty = !mat2d.exactEquals(tmpMat2d2, node.transformRender);\n      node.flags &= ~Flags.DirtyTransform;\n\n      // Propagate computation.\n      if (updated) {\n        mat2d.copy(node.transformWorld, tmpMat2d1);\n        mat2d.invert(node.transformWorldInvert, node.transformWorld);\n        rect.apply(node.boundsWorld, node.boundsLocal, node.transformWorld);\n\n        let dirtyParent = node.parent;\n        while (dirtyParent) {\n          dirtyParent.flags |= Flags.DirtyBounds;\n          dirtyParent = dirtyParent.parent;\n        }\n        for (const child of node.children) {\n          child.flags |= Flags.DirtyTransform;\n        }\n      }\n      if (renderDirty) {\n        mat2d.copy(node.transformRender, tmpMat2d2);\n\n        let dirtyNode: SceneNode | null = node;\n        while (dirtyNode) {\n          dirtyNode.flags |= Flags.DirtyRender;\n          dirtyNode = dirtyNode.parent;\n        }\n      }\n    }\n\n    queue.push(this);\n    while ((node = queue.pop())) {\n      if ((node.flags & Flags.DirtyBounds) === 0) {\n        continue;\n      }\n\n      // Ensure children bounds.\n      let needChildrenBounds = false;\n      for (const child of node.children) {\n        if ((child.flags & Flags.DirtyBounds) === 0) {\n          continue;\n        }\n\n        if (!needChildrenBounds) {\n          needChildrenBounds = true;\n          queue.push(node);\n        }\n        queue.push(child);\n      }\n      if (needChildrenBounds) {\n        continue;\n      }\n\n      // Compute local & world bounds.\n      rect.copy(tmpRect1, node.boundsIntrinsic);\n      for (const child of node.children) {\n        rect.apply(tmpRect2, child.boundsLocal, child.transformLocal);\n        rect.union(tmpRect1, tmpRect1, tmpRect2);\n      }\n      const updated = !rect.equals(tmpRect1, node.boundsLocal);\n      node.flags &= ~Flags.DirtyBounds;\n\n      // Propagate to parent.\n      if (updated) {\n        mat2d.copy(node.boundsLocal, tmpRect1);\n        rect.apply(node.boundsWorld, node.boundsLocal, node.transformWorld);\n\n        if (node.parent) {\n          node.parent.flags |= Flags.DirtyBounds;\n          queue.push(node.parent);\n        }\n      }\n    }\n  }\n\n  setParent(parent: SceneNode | null, index: number) {\n    if (this.parent === parent) {\n      if (parent) {\n        const i = parent.children.indexOf(this);\n        parent.children.splice(i, 1);\n        parent.children.splice(index, 0, this);\n        parent.markRenderDirty();\n      }\n      return;\n    }\n\n    if (this.parent) {\n      const i = this.parent.children.indexOf(this);\n      this.parent.children.splice(i, 1);\n      this.parent.markLayoutDirty(false);\n    }\n\n    this.parent = parent;\n\n    if (this.parent) {\n      this.parent.children.splice(index, 0, this);\n    } else if ((this.flags & Flags.IsRoot) === 0) {\n      this.onRemoveFromStage();\n    }\n\n    this.markLayoutDirty();\n  }\n\n  setRenderObjects(objects: RenderObject[], intrinsicBounds: rect) {\n    this.renderObjects = objects;\n\n    rect.copy(this.boundsIntrinsic, intrinsicBounds);\n    this.markLayoutDirty(false);\n  }\n\n  render(ctx: RenderContext) {\n    this.ensureLayout();\n    this.renderRecursive(ctx);\n  }\n\n  private renderRecursive(ctx: RenderContext) {\n    ctx.pushTransform(this.transformLocal, {\n      colorMul: this.colorTransformLocalMul,\n      colorAdd: this.colorTransformLocalAdd,\n    });\n\n    this.doRender(ctx);\n\n    ctx.popTransform();\n  }\n\n  private doRender(ctx: RenderContext) {\n    if (!this.visible) {\n      return;\n    }\n    if (this.isMask && ctx.transform.renderMask !== this) {\n      return;\n    }\n\n    rect.apply(tmpRect1, this.boundsLocal, ctx.transform.view);\n    if (ctx.viewport && !rect.intersects(tmpRect1, ctx.viewport)) {\n      return;\n    }\n\n    if (\n      this.cacheAsBitmap &&\n      this.cachedRender &&\n      (this.flags & Flags.DirtyRender) === 0\n    ) {\n      ctx.pushTransform(this.cachedRender.view);\n      ctx.renderObject(this.cachedRender.renderObject);\n      ctx.popTransform();\n      return;\n    }\n\n    this.flags &= ~Flags.DirtyRender;\n\n    this.cachedRender?.return();\n    this.cachedRender = null;\n\n    this.doRenderMask(ctx);\n  }\n\n  private doRenderMask(ctx: RenderContext) {\n    const mask = this.mask;\n    if (mask) {\n      mat2d.invert(tmpMat2d1, this.transformWorld);\n      mat2d.multiply(tmpMat2d1, tmpMat2d1, mask.transformWorld);\n\n      ctx.pushTransform(tmpMat2d1, { renderMask: mask });\n      mask.doRender(ctx);\n      ctx.popTransform();\n\n      ctx.transform.useMask.push(mask);\n    }\n\n    this.doRenderFilter(ctx);\n  }\n\n  private doRenderFilter(ctx: RenderContext) {\n    if (this.cacheAsBitmap || this.filters.length > 0) {\n      const paddings = vec2.create();\n      for (const filter of this.filters) {\n        vec2.max(paddings, paddings, filter.paddings);\n      }\n      vec2.ceil(paddings, paddings);\n\n      const viewMat = ctx.transform.view;\n\n      const filters = this.filters.slice();\n      const onRenderTexture = (\n        ctx: RenderContext,\n        tex: Texture,\n        bounds: rect\n      ) => {\n        const nextFilter = filters.shift();\n        if (nextFilter) {\n          ctx.renderFilter(tex, bounds, nextFilter, onRenderTexture);\n          return;\n        }\n\n        if (this.cacheAsBitmap) {\n          ctx.renderCache(tex, bounds, viewMat, (render) => {\n            this.cachedRender = render;\n          });\n          ctx.renderObject(RenderObject.rect(bounds, tex));\n        } else {\n          ctx.renderObject(RenderObject.rect(bounds, tex));\n        }\n      };\n\n      ctx.renderTexture(\n        this.boundsLocal,\n        paddings,\n        (ctx) => this.doRenderContent(ctx),\n        onRenderTexture\n      );\n    } else {\n      this.doRenderContent(ctx);\n    }\n  }\n\n  private doRenderContent(ctx: RenderContext) {\n    for (const o of this.renderObjects) {\n      ctx.renderObject(o);\n    }\n\n    if (this.buttonState >= 0) {\n      this.children[this.buttonState].render(ctx);\n    } else {\n      for (const child of this.children) {\n        child.renderRecursive(ctx);\n      }\n    }\n  }\n\n  onRemoveFromStage() {\n    this.cachedRender?.return();\n    this.cachedRender = null;\n    for (const child of this.children) {\n      child.onRemoveFromStage();\n    }\n  }\n\n  hitTest(worldPt: vec2, exact: boolean): boolean {\n    if (this.buttonState >= 0) {\n      return this.children[3].hitTest(worldPt, true);\n    }\n    if (this.mask && !this.mask.hitTest(worldPt, exact)) {\n      return false;\n    }\n\n    if (!exact) {\n      this.ensureLayout();\n      vec2.transformMat2d(tmpVec2, worldPt, this.transformWorldInvert);\n      return rect.contains(this.boundsLocal, tmpVec2[0], tmpVec2[1]);\n    }\n\n    const nodes: SceneNode[] = [this];\n    let node: SceneNode | undefined;\n    while ((node = nodes.pop())) {\n      if (node.renderObjects.length > 0) {\n        vec2.transformMat2d(tmpVec2, worldPt, node.transformWorldInvert);\n        if (\n          node.renderObjects.some((obj) =>\n            obj.hitTest(tmpVec2[0], tmpVec2[1], exact)\n          )\n        ) {\n          return true;\n        }\n      }\n\n      for (const child of node.children) {\n        nodes.push(child);\n      }\n    }\n    return false;\n  }\n\n  clone() {\n    const nodeMap = new Map<SceneNode, SceneNode>();\n    const clone = (n: SceneNode): SceneNode => {\n      let node = nodeMap.get(n);\n      if (node) {\n        return node;\n      }\n      node = new SceneNode(n.object);\n      nodeMap.set(n, node);\n\n      node.visible = n.visible;\n      node.isMask = n.isMask;\n      node.buttonState = n.buttonState;\n      node.renderObjects = n.renderObjects.slice();\n      node.cacheAsBitmap = n.cacheAsBitmap;\n      node.filters = n.filters.slice();\n      rect.copy(node.boundsIntrinsic, n.boundsIntrinsic);\n      mat2d.copy(node.transformLocal, n.transformLocal);\n      vec4.copy(node.colorTransformLocalMul, n.colorTransformLocalMul);\n      vec4.copy(node.colorTransformLocalAdd, n.colorTransformLocalAdd);\n\n      node.mask = n.mask && clone(n.mask);\n      for (const child of n.children) {\n        const clonedChild = clone(child);\n        node.children.push(clonedChild);\n        clonedChild.parent = node;\n      }\n\n      return node;\n    };\n\n    return clone(this);\n  }\n}\n","import { mat2d, vec2, vec4 } from \"gl-matrix\";\nimport { Filter, FilterInput, FilterInstance } from \"./Filter\";\nimport { Renderer } from \"../Renderer\";\nimport { TextureTarget } from \"../gl/targets\";\nimport { Texture } from \"../gl/Texture\";\nimport {\n  attrs,\n  attrFloat,\n  attrUint,\n  programBlur,\n  vertexArray,\n  programShadow,\n} from \"./programs\";\nimport { projection } from \"../../math/matrix\";\nimport { preMultiplyAlpha, decomposeColorVec } from \"../../math/color\";\n\nexport interface DropShadowFilterInstance extends FilterInstance {\n  blurX: number;\n  blurY: number;\n  passes: number;\n  color: number;\n  strength: number;\n  angle: number;\n  distance: number;\n  knockout: boolean;\n}\n\nconst outProjection = mat2d.create();\nconst inTexScale = vec2.create();\nconst outTexScale = vec2.create();\n\nexport class DropShadowFilter implements Filter<DropShadowFilterInstance> {\n  static readonly instance = new DropShadowFilter();\n\n  isEffective(instance: DropShadowFilterInstance): boolean {\n    return instance.blurX > 0 || instance.blurY > 0 || instance.distance > 0;\n  }\n\n  apply(\n    renderer: Renderer,\n    input: FilterInput<DropShadowFilterInstance>[],\n    out: TextureTarget\n  ): void {\n    const state = renderer.glState;\n    const gl = state.gl;\n\n    const { width, height } = out.texture;\n    projection(outProjection, width, height, false);\n    vec2.set(outTexScale, 1 / width, 1 / height);\n\n    state.setViewport(0, 0, width, height);\n    state.disable(gl.BLEND);\n    state.setClearColor(0, 0, 0, 0);\n\n    const texA = renderer.renderPool.takeTexture(width, height);\n    const texB = renderer.renderPool.takeTexture(width, height);\n    try {\n      const batchInput: FilterInput<DropShadowFilterInstance>[] = [];\n      let radius = 0;\n      let texture: Texture | null = null;\n      let passes: number | null = null;\n      const flush = () => {\n        if (!texture || !passes) {\n          return;\n        }\n\n        const blurProgram = programBlur(radius);\n\n        const numRect = batchInput.length;\n        attrs.update(state, 0, numRect * 4 * 17);\n\n        let front = texA;\n        let back = texB;\n        for (let i = 0; i < passes * 2; i++) {\n          let passFront = front;\n          let passBack = back.texture;\n          let mode = i % 2;\n          if (i === 0) {\n            passBack = texture;\n            mode += 2;\n          }\n\n          passFront.framebuffer.ensure(state);\n          state.bindFramebuffer(\n            gl.FRAMEBUFFER,\n            passFront.framebuffer.framebuffer\n          );\n\n          blurProgram.ensure(state);\n          vertexArray.ensure(state);\n          passBack.ensure(state);\n\n          state.useProgram(blurProgram.program);\n          const texUnit = state.bindTextures([passBack.texture])[0];\n          blurProgram.uniform(state, \"uTexture\", texUnit);\n          blurProgram.uniform(state, \"uMode\", mode);\n          vertexArray.bind(state);\n          gl.drawElements(gl.TRIANGLES, numRect * 6, gl.UNSIGNED_SHORT, 0);\n\n          let tmp = back;\n          back = front;\n          front = tmp;\n        }\n\n        for (let i = 0; i < batchInput.length; i++) {\n          const color = decomposeColorVec(\n            vec4.create(),\n            preMultiplyAlpha(batchInput[i].instance.color)\n          );\n          vec4.scale(color, color, batchInput[i].instance.strength);\n          const delta = vec2.fromValues(batchInput[i].instance.distance, 0);\n          vec2.rotate(delta, delta, [0, 0], batchInput[i].instance.angle);\n          vec2.mul(delta, delta, outTexScale);\n          let mode = 0;\n          if (batchInput[i].instance.knockout) {\n            mode |= 1;\n          }\n          for (let j = 0; j < 4; j++) {\n            const attrI = (i * 4 + j) * 17;\n            attrFloat[attrI + 0] = delta[0];\n            attrFloat[attrI + 1] = delta[1];\n\n            attrFloat[attrI + 8] = color[0];\n            attrFloat[attrI + 9] = color[1];\n            attrFloat[attrI + 10] = color[2];\n            attrFloat[attrI + 11] = color[3];\n\n            attrUint[attrI + 16] = mode;\n          }\n        }\n        attrs.update(state, 0, numRect * 4 * 17);\n\n        out.framebuffer.ensure(state);\n        state.bindFramebuffer(gl.FRAMEBUFFER, out.framebuffer.framebuffer);\n\n        programShadow.ensure(state);\n        state.useProgram(programShadow.program);\n        const texUnits = state.bindTextures([\n          back.texture.texture,\n          texture.texture,\n        ]);\n        programShadow.uniform(state, \"uTextures[0]\", texUnits);\n        gl.drawElements(gl.TRIANGLES, numRect * 6, gl.UNSIGNED_SHORT, 0);\n\n        batchInput.length = 0;\n        passes = null;\n        texture = null;\n      };\n\n      for (const i of input) {\n        if (i.texture !== texture || i.instance.passes !== passes) {\n          flush();\n          texture = i.texture;\n          passes = i.instance.passes;\n          radius = 0;\n          vec2.set(inTexScale, 1 / texture.width, 1 / texture.height);\n        }\n\n        const deltaX = i.instance.blurX / 2;\n        const deltaY = i.instance.blurY / 2;\n        radius = Math.max(radius, deltaX, deltaY);\n\n        let attrI = batchInput.length * 4 * 17;\n        for (let j = 0; j < 4; j++) {\n          attrFloat[attrI + 0] = deltaX;\n          attrFloat[attrI + 1] = deltaY;\n          switch (j) {\n            case 0:\n              attrFloat[attrI + 2] = i.outBounds[0] + i.outBounds[2];\n              attrFloat[attrI + 3] = i.outBounds[1];\n              attrFloat[attrI + 4] = i.inBounds[0] + i.inBounds[2];\n              attrFloat[attrI + 5] = i.inBounds[1];\n              attrFloat[attrI + 6] = i.outBounds[0] + i.outBounds[2];\n              attrFloat[attrI + 7] = i.outBounds[1];\n              break;\n            case 1:\n              attrFloat[attrI + 2] = i.outBounds[0];\n              attrFloat[attrI + 3] = i.outBounds[1] + i.outBounds[3];\n              attrFloat[attrI + 4] = i.inBounds[0];\n              attrFloat[attrI + 5] = i.inBounds[1] + i.inBounds[3];\n              attrFloat[attrI + 6] = i.outBounds[0];\n              attrFloat[attrI + 7] = i.outBounds[1] + i.outBounds[3];\n              break;\n            case 2:\n              attrFloat[attrI + 2] = i.outBounds[0];\n              attrFloat[attrI + 3] = i.outBounds[1];\n              attrFloat[attrI + 4] = i.inBounds[0];\n              attrFloat[attrI + 5] = i.inBounds[1];\n              attrFloat[attrI + 6] = i.outBounds[0];\n              attrFloat[attrI + 7] = i.outBounds[1];\n              break;\n            case 3:\n              attrFloat[attrI + 2] = i.outBounds[0] + i.outBounds[2];\n              attrFloat[attrI + 3] = i.outBounds[1] + i.outBounds[3];\n              attrFloat[attrI + 4] = i.inBounds[0] + i.inBounds[2];\n              attrFloat[attrI + 5] = i.inBounds[1] + i.inBounds[3];\n              attrFloat[attrI + 6] = i.outBounds[0] + i.outBounds[2];\n              attrFloat[attrI + 7] = i.outBounds[1] + i.outBounds[3];\n              break;\n          }\n\n          attrFloat[attrI + 8] = i.inBounds[0] + 0.5;\n          attrFloat[attrI + 9] = i.inBounds[1] + 0.5;\n          attrFloat[attrI + 10] = i.inBounds[0] + i.inBounds[2] - 1.5;\n          attrFloat[attrI + 11] = i.inBounds[1] + i.inBounds[3] - 1.5;\n\n          attrFloat[attrI + 12] = i.outBounds[0] + 0.5;\n          attrFloat[attrI + 13] = i.outBounds[1] + 0.5;\n          attrFloat[attrI + 14] = i.outBounds[0] + i.outBounds[2] - 1.5;\n          attrFloat[attrI + 15] = i.outBounds[1] + i.outBounds[3] - 1.5;\n\n          const delta = attrFloat.subarray(attrI + 0, attrI + 2);\n          const vertex = attrFloat.subarray(attrI + 2, attrI + 4);\n          const inTexCoords = attrFloat.subarray(attrI + 4, attrI + 6);\n          const outTexCoords = attrFloat.subarray(attrI + 6, attrI + 8);\n          const inBoundsMin = attrFloat.subarray(attrI + 8, attrI + 10);\n          const inBoundsMax = attrFloat.subarray(attrI + 10, attrI + 12);\n          const outBoundsMin = attrFloat.subarray(attrI + 12, attrI + 14);\n          const outBoundsMax = attrFloat.subarray(attrI + 14, attrI + 16);\n\n          vec2.mul(delta, delta, inTexScale);\n          vec2.transformMat2d(vertex, vertex, outProjection);\n          vec2.mul(inTexCoords, inTexCoords, inTexScale);\n          vec2.mul(inBoundsMin, inBoundsMin, inTexScale);\n          vec2.mul(inBoundsMax, inBoundsMax, inTexScale);\n          vec2.mul(outTexCoords, outTexCoords, outTexScale);\n          vec2.mul(outBoundsMin, outBoundsMin, outTexScale);\n          vec2.mul(outBoundsMax, outBoundsMax, outTexScale);\n\n          attrI += 17;\n        }\n\n        batchInput.push(i);\n      }\n      flush();\n    } finally {\n      renderer.renderPool.returnTexture(texA);\n      renderer.renderPool.returnTexture(texB);\n    }\n  }\n}\n","import { Program } from \"../gl/Program\";\nimport { blurVertexShader, blurFragmentShader } from \"../programs/blur\";\nimport { shadowVertexShader, shadowFragmentShader } from \"../programs/shadow\";\nimport { Buffer } from \"../gl/Buffer\";\nimport { VertexArray } from \"../gl/VertexArray\";\n\nconst programBlurCache = new Map<number, Program>();\n\nexport const programBlur = (blurRadius: number) => {\n  const kernelWidth = Math.max(1, Math.ceil(blurRadius / 2));\n  let prog = programBlurCache.get(kernelWidth);\n  if (!prog) {\n    prog = new Program(blurVertexShader, blurFragmentShader(kernelWidth));\n    programBlurCache.set(kernelWidth, prog);\n  }\n  return prog;\n};\nexport const programShadow = new Program(\n  shadowVertexShader,\n  shadowFragmentShader\n);\n\nexport const maxRect = 100;\nexport const indices = Buffer.index(\n  new Uint16Array(maxRect * 6),\n  \"STREAM_DRAW\"\n);\n\nconst attrData = new ArrayBuffer(maxRect * 4 * 68);\nexport const attrFloat = new Float32Array(attrData);\nexport const attrUint = new Uint32Array(attrData);\nexport const attrs = Buffer.vertex(attrFloat, \"STREAM_DRAW\");\nexport const vertexArray = new VertexArray(\n  [\n    {\n      index: 0,\n      buffer: attrs,\n      type: \"float\",\n      components: 4,\n      offset: 0,\n      stride: 68,\n    },\n    {\n      index: 1,\n      buffer: attrs,\n      type: \"float\",\n      components: 4,\n      offset: 16,\n      stride: 68,\n    },\n    {\n      index: 2,\n      buffer: attrs,\n      type: \"float\",\n      components: 4,\n      offset: 32,\n      stride: 68,\n    },\n    {\n      index: 3,\n      buffer: attrs,\n      type: \"float\",\n      components: 4,\n      offset: 48,\n      stride: 68,\n    },\n    {\n      index: 4,\n      buffer: attrs,\n      type: \"uint\",\n      components: 1,\n      integer: true,\n      offset: 64,\n      stride: 68,\n    },\n  ],\n  indices\n);\n\nfor (let i = 0; i < maxRect; i++) {\n  indices.data[i * 6 + 0] = i * 4 + 0;\n  indices.data[i * 6 + 1] = i * 4 + 1;\n  indices.data[i * 6 + 2] = i * 4 + 2;\n  indices.data[i * 6 + 3] = i * 4 + 1;\n  indices.data[i * 6 + 4] = i * 4 + 0;\n  indices.data[i * 6 + 5] = i * 4 + 3;\n}\n","export const blurVertexShader = `\n#version 300 es\n\nlayout(location=0) in vec4 aVertex;\nlayout(location=1) in vec4 aTexCoords;\nlayout(location=2) in vec4 aBoundsIn;\nlayout(location=3) in vec4 aBoundsOut;\nlayout(location=4) in uint x;\n\nout vec2 vTextureCoords;\nout vec2 vDelta;\nout vec4 vBounds;\n\nuniform uint uMode;\n\nvoid main(void) {\n    gl_Position = vec4(aVertex.zw, 0.0, 1.0);\n\n    vec2 delta;\n    vec2 texCoords;\n    vec4 bounds;\n    if (int(uMode) % 2 != 0) {\n      delta = aVertex.xy * vec2(1.0, 0.0);\n    } else {\n      delta = aVertex.xy * vec2(0.0, 1.0);\n    }\n    if (int(uMode) / 2 != 0) {\n      texCoords = aTexCoords.xy;\n      bounds = aBoundsIn;\n    } else {\n      texCoords = aTexCoords.zw;\n      bounds = aBoundsOut;\n    }\n\n    vTextureCoords = texCoords;\n    vDelta = delta;\n    vBounds = bounds;\n}\n`;\n\nexport const blurFragmentShader = (kernelWidth: number) => {\n  const samples: number[] = [0];\n  for (let i = 0; i < kernelWidth; i++) {\n    const offset = i + 1;\n    samples.push(offset / kernelWidth);\n    samples.unshift(-offset / kernelWidth);\n  }\n\n  return `\n#version 300 es\nprecision highp float;\n\nin vec2 vTextureCoords;\nin vec2 vDelta;\nin vec4 vBounds;\n\nuniform sampler2D uTexture;\n\nout vec4 fragColor;\n\nvec4 sampleTex(float offset) {\n  vec2 coords = vTextureCoords + vDelta * offset;\n  coords = clamp(coords, vBounds.xy, vBounds.zw);\n  return texture(uTexture, coords);\n}\n\nvoid main(void) {\n  fragColor = vec4(0.0);\n  ${samples\n    .map(\n      (offset) =>\n        `fragColor += sampleTex(${offset.toFixed(20)}) * ${1 / samples.length};`\n    )\n    .join(\"\\n\")}\n}\n`;\n};\n","export const shadowVertexShader = `\n#version 300 es\n\nlayout(location=0) in vec4 aVertex;\nlayout(location=1) in vec4 aTexCoords;\nlayout(location=2) in vec4 aColor;\nlayout(location=3) in vec4 aBounds;\nlayout(location=4) in uint aMode;\n\nout vec2 vInTexCoords;\nout vec2 vOutTexCoords;\nout vec2 vDelta;\nout vec4 vBounds;\nout vec4 vColor;\nflat out uint vMode;\n\nvoid main(void) {\n    gl_Position = vec4(aVertex.zw, 0.0, 1.0);\n\n    vInTexCoords = aTexCoords.xy;\n    vOutTexCoords = aTexCoords.zw;\n    vDelta = aVertex.xy;\n    vBounds = aBounds;\n    vColor = aColor;\n    vMode = aMode;\n}\n`;\n\nexport const shadowFragmentShader = `\n#version 300 es\nprecision highp float;\n\nin vec2 vInTexCoords;\nin vec2 vOutTexCoords;\nin vec2 vDelta;\nin vec4 vBounds;\nin vec4 vColor;\nflat in uint vMode;\n\nuniform sampler2D uTextures[2];\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 shadowCoords = clamp(vOutTexCoords - vDelta, vBounds.xy, vBounds.zw);\n  vec4 shadow = vColor * texture(uTextures[0], shadowCoords).a;\n  vec4 color = texture(uTextures[1], vInTexCoords);\n  if (int(vMode) % 2 != 0) {\n    fragColor = shadow * (1.0 - color.a);\n  } else {\n    fragColor = shadow * (1.0 - color.a) + color;\n  }\n}\n`;\n","import { GLState } from \"./GLState\";\nimport { TypedArray } from \"./typed-array\";\n\nexport class Buffer<T extends TypedArray = TypedArray> {\n  readonly data: T;\n\n  state: GLState | null = null;\n  buffer: WebGLBuffer | null = null;\n\n  get length() {\n    return this.data.length;\n  }\n\n  private constructor(\n    data: T,\n    readonly binding: \"ARRAY_BUFFER\" | \"ELEMENT_ARRAY_BUFFER\",\n    readonly usage: \"STATIC_DRAW\" | \"DYNAMIC_DRAW\" | \"STREAM_DRAW\"\n  ) {\n    this.data = data;\n  }\n\n  static index<T extends TypedArray>(data: T, usage: Buffer<T>[\"usage\"]) {\n    return new Buffer(data, \"ELEMENT_ARRAY_BUFFER\", usage);\n  }\n\n  static vertex<T extends TypedArray>(data: T, usage: Buffer<T>[\"usage\"]) {\n    return new Buffer(data, \"ARRAY_BUFFER\", usage);\n  }\n\n  ensure(state: GLState) {\n    if (this.buffer) {\n      return;\n    }\n    const gl = state.gl;\n\n    const buffer = gl.createBuffer();\n    state.bindBuffer(gl[this.binding], buffer);\n    gl.bufferData(gl[this.binding], this.data, gl[this.usage]);\n\n    this.state = state;\n    this.buffer = buffer;\n\n    state.contextLost.subscribe(this.onContextLost);\n  }\n\n  bind(state: GLState) {\n    this.ensure(state);\n    state.bindBuffer(state.gl[this.binding], this.buffer);\n  }\n\n  update(state: GLState, offset: number, length: number) {\n    this.bind(state);\n    const gl = state.gl;\n    gl.bufferSubData(gl[this.binding], 0, this.data, offset, length);\n    return this;\n  }\n\n  private onContextLost = () => {\n    if (this.state) {\n      this.state.contextLost.unsubscribe(this.onContextLost);\n      this.state = null;\n    }\n    this.buffer = null;\n  };\n}\n","import { GLState } from \"./GLState\";\nimport { TypedArray, TypedArrayConstructor } from \"./typed-array\";\n\ninterface TypeDef {\n  type: \"float\" | \"int\" | \"uint\" | \"bool\" | \"mat\" | \"sampler2D\";\n  components: number;\n  setter: string;\n}\n\nfunction toTypedArray<T extends TypedArray>(\n  value: unknown,\n  cls: TypedArrayConstructor<T>\n): T {\n  if (typeof value === \"number\" || typeof value === \"boolean\") {\n    const array = new cls(1);\n    array[0] = Number(value);\n    return array;\n  } else if (Array.isArray(value)) {\n    return cls.from(value);\n  } else if (value instanceof cls) {\n    return value.slice();\n  } else {\n    throw new Error(\"Invalid typed array value\");\n  }\n}\n\nfunction arrayEquals<T extends ArrayLike<unknown>>(\n  oldArray: T | null,\n  newArray: T\n): boolean {\n  if (!oldArray || oldArray.length !== newArray.length) {\n    return false;\n  }\n  for (let i = 0; i < oldArray.length; i++) {\n    if (newArray[i] !== oldArray[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport class Uniform {\n  readonly state: GLState;\n  readonly name: string;\n  readonly type: GLenum;\n  readonly size: number;\n  readonly location: WebGLUniformLocation;\n  readonly typeDef: TypeDef;\n  value: unknown = null;\n\n  constructor(\n    state: GLState,\n    info: WebGLActiveInfo,\n    location: WebGLUniformLocation\n  ) {\n    this.state = state;\n    this.name = info.name;\n    this.type = info.type;\n    this.size = info.size;\n    this.location = location;\n\n    const gl = this.state.gl;\n    const types: Record<GLenum, TypeDef> = {\n      [gl.FLOAT]: { type: \"float\", components: 1, setter: \"uniform1fv\" },\n      [gl.FLOAT_VEC2]: { type: \"float\", components: 2, setter: \"uniform2fv\" },\n      [gl.FLOAT_VEC3]: { type: \"float\", components: 3, setter: \"uniform3fv\" },\n      [gl.FLOAT_VEC4]: { type: \"float\", components: 4, setter: \"uniform4fv\" },\n      [gl.INT]: { type: \"int\", components: 1, setter: \"uniform1iv\" },\n      [gl.INT_VEC2]: { type: \"int\", components: 2, setter: \"uniform2iv\" },\n      [gl.INT_VEC3]: { type: \"int\", components: 3, setter: \"uniform3iv\" },\n      [gl.INT_VEC4]: { type: \"int\", components: 4, setter: \"uniform4iv\" },\n      [gl.UNSIGNED_INT]: { type: \"uint\", components: 1, setter: \"uniform1uiv\" },\n      [gl.UNSIGNED_INT_VEC2]: {\n        type: \"uint\",\n        components: 2,\n        setter: \"uniform2uiv\",\n      },\n      [gl.UNSIGNED_INT_VEC3]: {\n        type: \"uint\",\n        components: 3,\n        setter: \"uniform3uiv\",\n      },\n      [gl.UNSIGNED_INT_VEC4]: {\n        type: \"uint\",\n        components: 4,\n        setter: \"uniform4uiv\",\n      },\n      [gl.BOOL]: { type: \"bool\", components: 1, setter: \"uniform1iv\" },\n      [gl.BOOL_VEC2]: { type: \"bool\", components: 2, setter: \"uniform2iv\" },\n      [gl.BOOL_VEC3]: { type: \"bool\", components: 3, setter: \"uniform3iv\" },\n      [gl.BOOL_VEC4]: { type: \"bool\", components: 4, setter: \"uniform4iv\" },\n      [gl.FLOAT_MAT2]: {\n        type: \"mat\",\n        components: 4,\n        setter: \"uniformMatrix2fv\",\n      },\n      [gl.FLOAT_MAT3]: {\n        type: \"mat\",\n        components: 9,\n        setter: \"uniformMatrix3fv\",\n      },\n      [gl.FLOAT_MAT4]: {\n        type: \"mat\",\n        components: 16,\n        setter: \"uniformMatrix4fv\",\n      },\n      [gl.SAMPLER_2D]: { type: \"bool\", components: 1, setter: \"uniform1iv\" },\n    };\n    const typeDef = types[info.type];\n    if (!typeDef) {\n      throw new Error(`Unsupported uniform type: ${info.type}`);\n    }\n    this.typeDef = typeDef;\n  }\n\n  set(program: WebGLProgram | null, value: unknown) {\n    this.state.useProgram(program);\n    switch (this.typeDef.type) {\n      case \"float\": {\n        const newValue = toTypedArray(value, Float32Array);\n        const oldValue = (this.value as Float32Array) ?? new Float32Array(0);\n        if (arrayEquals(oldValue, newValue)) {\n          return;\n        }\n        (this.state.gl as any)[this.typeDef.setter](this.location, newValue);\n        this.value = newValue;\n        break;\n      }\n      case \"int\":\n      case \"bool\": {\n        const newValue = toTypedArray(value, Int32Array);\n        const oldValue = (this.value as Int32Array) ?? new Int32Array(0);\n        if (arrayEquals(oldValue, newValue)) {\n          return;\n        }\n        (this.state.gl as any)[this.typeDef.setter](this.location, newValue);\n        this.value = newValue;\n        break;\n      }\n      case \"uint\": {\n        const newValue = toTypedArray(value, Uint32Array);\n        const oldValue = (this.value as Uint32Array) ?? new Uint32Array(0);\n        if (arrayEquals(oldValue, newValue)) {\n          return;\n        }\n        (this.state.gl as any)[this.typeDef.setter](this.location, newValue);\n        this.value = newValue;\n        break;\n      }\n      case \"mat\": {\n        const newValue = toTypedArray(value, Float32Array);\n        const oldValue = (this.value as Float32Array) ?? new Float32Array(0);\n        if (arrayEquals(oldValue, newValue)) {\n          return;\n        }\n        (this.state.gl as any)[this.typeDef.setter](\n          this.location,\n          false,\n          newValue\n        );\n        this.value = newValue;\n        break;\n      }\n      case \"sampler2D\": {\n        const newValue = Array.isArray(value)\n          ? (value.slice() as WebGLTexture[])\n          : [value as WebGLTexture];\n        const oldValue = (this.value as WebGLTexture[]) ?? [];\n        if (arrayEquals(oldValue, newValue)) {\n          return;\n        }\n        (this.state.gl as any)[this.typeDef.setter](\n          this.location,\n          false,\n          newValue\n        );\n        this.value = newValue;\n        break;\n      }\n    }\n  }\n}\n","import { GLState } from \"./GLState\";\nimport { Uniform } from \"./Uniform\";\n\nexport class Program {\n  readonly vertexShader: string;\n  readonly fragmentShader: string;\n\n  state: GLState | null = null;\n  program: WebGLProgram | null = null;\n  private readonly uniforms = new Map<string, Uniform>();\n\n  constructor(vertexShader: string, fragmentShader: string) {\n    this.vertexShader = vertexShader;\n    this.fragmentShader = fragmentShader;\n  }\n\n  ensure(state: GLState) {\n    if (this.program) {\n      return;\n    }\n    const gl = state.gl;\n\n    const vertexShader = gl.createShader(gl.VERTEX_SHADER)!;\n    gl.shaderSource(vertexShader, this.vertexShader.trim());\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      const log = gl.getShaderInfoLog(vertexShader);\n      gl.deleteShader(vertexShader);\n      throw new Error(\"Cannot compile vertex shader: \" + log);\n    }\n\n    const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER)!;\n    gl.shaderSource(fragmentShader, this.fragmentShader.trim());\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      const log = gl.getShaderInfoLog(fragmentShader);\n      gl.deleteShader(fragmentShader);\n      throw new Error(\"Cannot compile fragment shader: \" + log);\n    }\n\n    const program = gl.createProgram()!;\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      const log = gl.getProgramInfoLog(program);\n      gl.deleteProgram(program);\n      throw new Error(\"Cannot link program: \" + log);\n    }\n\n    this.uniforms.clear();\n    const numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n    for (let i = 0; i < numUniforms; ++i) {\n      const info = gl.getActiveUniform(program, i)!;\n      const location = gl.getUniformLocation(program, info.name)!;\n      this.uniforms.set(info.name, new Uniform(state, info, location));\n    }\n\n    this.program = program;\n    this.state = state;\n\n    state.contextLost.subscribe(this.onContextLost);\n  }\n\n  uniform(state: GLState, name: string, value: unknown) {\n    this.ensure(state);\n    const uniform = this.uniforms.get(name);\n    if (!uniform) {\n      return;\n    }\n    uniform.set(this.program, value);\n  }\n\n  private onContextLost = () => {\n    if (this.state) {\n      this.state.contextLost.unsubscribe(this.onContextLost);\n      this.state = null;\n    }\n    this.program = null;\n  };\n}\n","import { GLState } from \"./GLState\";\n\nexport class Texture {\n  readonly data:\n    | HTMLImageElement\n    | {\n        width: number;\n        height: number;\n      };\n  readonly width: number;\n  readonly height: number;\n\n  state: GLState | null = null;\n  texture: WebGLTexture | null = null;\n\n  static readonly WHITE: Texture = (() => {\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = 16;\n    canvas.height = 16;\n\n    const ctx = canvas.getContext(\"2d\")!;\n    ctx.fillStyle = \"#ffffff\";\n    ctx.fillRect(0, 0, 16, 16);\n\n    return new Texture(canvas);\n  })();\n\n  private constructor(data: Texture[\"data\"]) {\n    this.data = data;\n    this.width = data.width;\n    this.height = data.height;\n  }\n\n  static image(image: HTMLImageElement | HTMLCanvasElement) {\n    return new Texture(image);\n  }\n\n  static size(width: number, height: number) {\n    return new Texture({ width, height });\n  }\n\n  ensure(state: GLState) {\n    if (this.texture) {\n      return;\n    }\n    const gl = state.gl;\n\n    const tex = gl.createTexture();\n    state.bindTexture(0, tex);\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n    if (this.data instanceof HTMLElement) {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        gl.RGBA,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        this.data\n      );\n    } else {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        gl.RGBA,\n        this.width,\n        this.height,\n        0,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        null\n      );\n    }\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\n    this.state = state;\n    this.texture = tex;\n\n    state.contextLost.subscribe(this.onContextLost);\n  }\n\n  delete() {\n    if (!this.state) {\n      return;\n    }\n    this.state.gl.deleteTexture(this.texture);\n    this.state.contextLost.unsubscribe(this.onContextLost);\n    this.state = null;\n    this.texture = null;\n  }\n\n  private onContextLost = () => {\n    if (this.state) {\n      this.state.contextLost.unsubscribe(this.onContextLost);\n      this.state = null;\n    }\n    this.texture = null;\n  };\n}\n","import { GLState } from \"./GLState\";\nimport { Buffer } from \"./Buffer\";\n\ninterface VertexArrayAttribute {\n  index: number;\n  buffer: Buffer;\n  type: \"byte\" | \"ushort\" | \"uint\" | \"float\";\n  components: number;\n  normalized?: boolean;\n  stride?: number;\n  offset?: number;\n  integer?: boolean;\n}\n\nexport class VertexArray {\n  state: GLState | null = null;\n  vertexArray: WebGLVertexArrayObject | null = null;\n\n  attributes: VertexArrayAttribute[];\n  indexBuffer: Buffer | null = null;\n\n  constructor(\n    attributes: VertexArrayAttribute[],\n    indexBuffer: Buffer | null = null\n  ) {\n    this.attributes = attributes;\n    this.indexBuffer = indexBuffer;\n  }\n\n  ensure(state: GLState) {\n    if (this.vertexArray) {\n      return;\n    }\n    const gl = state.gl;\n\n    const vertexArray = gl.createVertexArray();\n    state.bindVertexArray(vertexArray);\n\n    if (this.indexBuffer) {\n      this.indexBuffer.ensure(state);\n      state.bindBuffer(gl[this.indexBuffer.binding], this.indexBuffer.buffer);\n    }\n\n    for (const attr of this.attributes) {\n      const {\n        index,\n        buffer,\n        type,\n        components,\n        normalized = false,\n        stride = 0,\n        offset = 0,\n        integer = false,\n      } = attr;\n\n      let glType: GLenum;\n      switch (type) {\n        case \"byte\":\n          glType = gl.UNSIGNED_BYTE;\n          break;\n        case \"ushort\":\n          glType = gl.UNSIGNED_SHORT;\n          break;\n        case \"uint\":\n          glType = gl.UNSIGNED_INT;\n          break;\n        case \"float\":\n          glType = gl.FLOAT;\n          break;\n      }\n\n      buffer.ensure(state);\n      state.bindBuffer(gl[buffer.binding], buffer.buffer);\n      if (integer) {\n        gl.vertexAttribIPointer(index, components, glType, stride, offset);\n      } else {\n        gl.vertexAttribPointer(\n          index,\n          components,\n          glType,\n          normalized,\n          stride,\n          offset\n        );\n      }\n      gl.enableVertexAttribArray(index);\n    }\n\n    this.vertexArray = vertexArray;\n    this.state = state;\n\n    state.contextLost.subscribe(this.onContextLost);\n  }\n\n  bind(state: GLState) {\n    this.ensure(state);\n    state.bindVertexArray(this.vertexArray);\n    // HACK: Always rebind index buffer due to driver bugs:\n    // ref: https://stackoverflow.com/a/11261922\n    this.indexBuffer?.bind(state);\n  }\n\n  private onContextLost = () => {\n    if (this.state) {\n      this.state.contextLost.unsubscribe(this.onContextLost);\n      this.state = null;\n    }\n    this.vertexArray = null;\n  };\n}\n","/**\r\n * Common utilities\r\n * @module glMatrix\r\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\r\n * Sets the type of array used when creating new vectors and matrices\r\n *\r\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\r\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\r\n * Convert Degree To Radian\r\n *\r\n * @param {Number} a Angle in Degrees\r\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\r\n * Tests whether or not the arguments have approximately the same value, within an absolute\r\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\r\n * than or equal to 1.0, and a relative tolerance is used for larger values)\r\n *\r\n * @param {Number} a The first number to test.\r\n * @param {Number} b The second number to test.\r\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\r\n * 2x3 Matrix\r\n * @module mat2d\r\n * @description\r\n * A mat2d contains six elements defined as:\r\n * <pre>\r\n * [a, b,\r\n *  c, d,\r\n *  tx, ty]\r\n * </pre>\r\n * This is a short form for the 3x3 matrix:\r\n * <pre>\r\n * [a, b, 0,\r\n *  c, d, 0,\r\n *  tx, ty, 1]\r\n * </pre>\r\n * The last column is ignored so the array is shorter and operations are faster.\r\n */\n\n/**\r\n * Creates a new identity mat2d\r\n *\r\n * @returns {mat2d} a new 2x3 matrix\r\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(6);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[4] = 0;\n    out[5] = 0;\n  }\n\n  out[0] = 1;\n  out[3] = 1;\n  return out;\n}\n/**\r\n * Creates a new mat2d initialized with values from an existing matrix\r\n *\r\n * @param {ReadonlyMat2d} a matrix to clone\r\n * @returns {mat2d} a new 2x3 matrix\r\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(6);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  return out;\n}\n/**\r\n * Copy the values from one mat2d to another\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the source matrix\r\n * @returns {mat2d} out\r\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  return out;\n}\n/**\r\n * Set a mat2d to the identity matrix\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @returns {mat2d} out\r\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 1;\n  out[4] = 0;\n  out[5] = 0;\n  return out;\n}\n/**\r\n * Create a new mat2d with the given values\r\n *\r\n * @param {Number} a Component A (index 0)\r\n * @param {Number} b Component B (index 1)\r\n * @param {Number} c Component C (index 2)\r\n * @param {Number} d Component D (index 3)\r\n * @param {Number} tx Component TX (index 4)\r\n * @param {Number} ty Component TY (index 5)\r\n * @returns {mat2d} A new mat2d\r\n */\n\nexport function fromValues(a, b, c, d, tx, ty) {\n  var out = new glMatrix.ARRAY_TYPE(6);\n  out[0] = a;\n  out[1] = b;\n  out[2] = c;\n  out[3] = d;\n  out[4] = tx;\n  out[5] = ty;\n  return out;\n}\n/**\r\n * Set the components of a mat2d to the given values\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {Number} a Component A (index 0)\r\n * @param {Number} b Component B (index 1)\r\n * @param {Number} c Component C (index 2)\r\n * @param {Number} d Component D (index 3)\r\n * @param {Number} tx Component TX (index 4)\r\n * @param {Number} ty Component TY (index 5)\r\n * @returns {mat2d} out\r\n */\n\nexport function set(out, a, b, c, d, tx, ty) {\n  out[0] = a;\n  out[1] = b;\n  out[2] = c;\n  out[3] = d;\n  out[4] = tx;\n  out[5] = ty;\n  return out;\n}\n/**\r\n * Inverts a mat2d\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the source matrix\r\n * @returns {mat2d} out\r\n */\n\nexport function invert(out, a) {\n  var aa = a[0],\n      ab = a[1],\n      ac = a[2],\n      ad = a[3];\n  var atx = a[4],\n      aty = a[5];\n  var det = aa * ad - ab * ac;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = ad * det;\n  out[1] = -ab * det;\n  out[2] = -ac * det;\n  out[3] = aa * det;\n  out[4] = (ac * aty - ad * atx) * det;\n  out[5] = (ab * atx - aa * aty) * det;\n  return out;\n}\n/**\r\n * Calculates the determinant of a mat2d\r\n *\r\n * @param {ReadonlyMat2d} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\n\nexport function determinant(a) {\n  return a[0] * a[3] - a[1] * a[2];\n}\n/**\r\n * Multiplies two mat2d's\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the first operand\r\n * @param {ReadonlyMat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\n\nexport function multiply(out, a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3],\n      a4 = a[4],\n      a5 = a[5];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3],\n      b4 = b[4],\n      b5 = b[5];\n  out[0] = a0 * b0 + a2 * b1;\n  out[1] = a1 * b0 + a3 * b1;\n  out[2] = a0 * b2 + a2 * b3;\n  out[3] = a1 * b2 + a3 * b3;\n  out[4] = a0 * b4 + a2 * b5 + a4;\n  out[5] = a1 * b4 + a3 * b5 + a5;\n  return out;\n}\n/**\r\n * Rotates a mat2d by the given angle\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2d} out\r\n */\n\nexport function rotate(out, a, rad) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3],\n      a4 = a[4],\n      a5 = a[5];\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  out[0] = a0 * c + a2 * s;\n  out[1] = a1 * c + a3 * s;\n  out[2] = a0 * -s + a2 * c;\n  out[3] = a1 * -s + a3 * c;\n  out[4] = a4;\n  out[5] = a5;\n  return out;\n}\n/**\r\n * Scales the mat2d by the dimensions in the given vec2\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the matrix to translate\r\n * @param {ReadonlyVec2} v the vec2 to scale the matrix by\r\n * @returns {mat2d} out\r\n **/\n\nexport function scale(out, a, v) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3],\n      a4 = a[4],\n      a5 = a[5];\n  var v0 = v[0],\n      v1 = v[1];\n  out[0] = a0 * v0;\n  out[1] = a1 * v0;\n  out[2] = a2 * v1;\n  out[3] = a3 * v1;\n  out[4] = a4;\n  out[5] = a5;\n  return out;\n}\n/**\r\n * Translates the mat2d by the dimensions in the given vec2\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the matrix to translate\r\n * @param {ReadonlyVec2} v the vec2 to translate the matrix by\r\n * @returns {mat2d} out\r\n **/\n\nexport function translate(out, a, v) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3],\n      a4 = a[4],\n      a5 = a[5];\n  var v0 = v[0],\n      v1 = v[1];\n  out[0] = a0;\n  out[1] = a1;\n  out[2] = a2;\n  out[3] = a3;\n  out[4] = a0 * v0 + a2 * v1 + a4;\n  out[5] = a1 * v0 + a3 * v1 + a5;\n  return out;\n}\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.rotate(dest, dest, rad);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2d} out\r\n */\n\nexport function fromRotation(out, rad) {\n  var s = Math.sin(rad),\n      c = Math.cos(rad);\n  out[0] = c;\n  out[1] = s;\n  out[2] = -s;\n  out[3] = c;\n  out[4] = 0;\n  out[5] = 0;\n  return out;\n}\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.scale(dest, dest, vec);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {ReadonlyVec2} v Scaling vector\r\n * @returns {mat2d} out\r\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = v[1];\n  out[4] = 0;\n  out[5] = 0;\n  return out;\n}\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.translate(dest, dest, vec);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {ReadonlyVec2} v Translation vector\r\n * @returns {mat2d} out\r\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 1;\n  out[4] = v[0];\n  out[5] = v[1];\n  return out;\n}\n/**\r\n * Returns a string representation of a mat2d\r\n *\r\n * @param {ReadonlyMat2d} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\n\nexport function str(a) {\n  return \"mat2d(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \")\";\n}\n/**\r\n * Returns Frobenius norm of a mat2d\r\n *\r\n * @param {ReadonlyMat2d} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], 1);\n}\n/**\r\n * Adds two mat2d's\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the first operand\r\n * @param {ReadonlyMat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  return out;\n}\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the first operand\r\n * @param {ReadonlyMat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  return out;\n}\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {ReadonlyMat2d} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat2d} out\r\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  return out;\n}\n/**\r\n * Adds two mat2d's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat2d} out the receiving vector\r\n * @param {ReadonlyMat2d} a the first operand\r\n * @param {ReadonlyMat2d} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat2d} out\r\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  return out;\n}\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {ReadonlyMat2d} a The first matrix.\r\n * @param {ReadonlyMat2d} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5];\n}\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {ReadonlyMat2d} a The first matrix.\r\n * @param {ReadonlyMat2d} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3],\n      a4 = a[4],\n      a5 = a[5];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3],\n      b4 = b[4],\n      b5 = b[5];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5));\n}\n/**\r\n * Alias for {@link mat2d.multiply}\r\n * @function\r\n */\n\nexport var mul = multiply;\n/**\r\n * Alias for {@link mat2d.subtract}\r\n * @function\r\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\r\n * 2 Dimensional Vector\r\n * @module vec2\r\n */\n\n/**\r\n * Creates a new, empty vec2\r\n *\r\n * @returns {vec2} a new 2D vector\r\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(2);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n  }\n\n  return out;\n}\n/**\r\n * Creates a new vec2 initialized with values from an existing vector\r\n *\r\n * @param {ReadonlyVec2} a vector to clone\r\n * @returns {vec2} a new 2D vector\r\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n/**\r\n * Creates a new vec2 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @returns {vec2} a new 2D vector\r\n */\n\nexport function fromValues(x, y) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n/**\r\n * Copy the values from one vec2 to another\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the source vector\r\n * @returns {vec2} out\r\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n/**\r\n * Set the components of a vec2 to the given values\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @returns {vec2} out\r\n */\n\nexport function set(out, x, y) {\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n/**\r\n * Adds two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {vec2} out\r\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {vec2} out\r\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n/**\r\n * Multiplies two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {vec2} out\r\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n/**\r\n * Divides two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {vec2} out\r\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n/**\r\n * Math.ceil the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a vector to ceil\r\n * @returns {vec2} out\r\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  return out;\n}\n/**\r\n * Math.floor the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a vector to floor\r\n * @returns {vec2} out\r\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  return out;\n}\n/**\r\n * Returns the minimum of two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {vec2} out\r\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  return out;\n}\n/**\r\n * Returns the maximum of two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {vec2} out\r\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  return out;\n}\n/**\r\n * Math.round the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a vector to round\r\n * @returns {vec2} out\r\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  return out;\n}\n/**\r\n * Scales a vec2 by a scalar number\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec2} out\r\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  return out;\n}\n/**\r\n * Adds two vec2's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec2} out\r\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  return out;\n}\n/**\r\n * Calculates the euclidian distance between two vec2's\r\n *\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1];\n  return Math.hypot(x, y);\n}\n/**\r\n * Calculates the squared euclidian distance between two vec2's\r\n *\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1];\n  return x * x + y * y;\n}\n/**\r\n * Calculates the length of a vec2\r\n *\r\n * @param {ReadonlyVec2} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\n\nexport function length(a) {\n  var x = a[0],\n      y = a[1];\n  return Math.hypot(x, y);\n}\n/**\r\n * Calculates the squared length of a vec2\r\n *\r\n * @param {ReadonlyVec2} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\n\nexport function squaredLength(a) {\n  var x = a[0],\n      y = a[1];\n  return x * x + y * y;\n}\n/**\r\n * Negates the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a vector to negate\r\n * @returns {vec2} out\r\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  return out;\n}\n/**\r\n * Returns the inverse of the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a vector to invert\r\n * @returns {vec2} out\r\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  return out;\n}\n/**\r\n * Normalize a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a vector to normalize\r\n * @returns {vec2} out\r\n */\n\nexport function normalize(out, a) {\n  var x = a[0],\n      y = a[1];\n  var len = x * x + y * y;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  return out;\n}\n/**\r\n * Calculates the dot product of two vec2's\r\n *\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n/**\r\n * Computes the cross product of two vec2's\r\n * Note that the cross product must by definition produce a 3D vector\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @returns {vec3} out\r\n */\n\nexport function cross(out, a, b) {\n  var z = a[0] * b[1] - a[1] * b[0];\n  out[0] = out[1] = 0;\n  out[2] = z;\n  return out;\n}\n/**\r\n * Performs a linear interpolation between two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the first operand\r\n * @param {ReadonlyVec2} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec2} out\r\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0],\n      ay = a[1];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  return out;\n}\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec2} out\r\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  out[0] = Math.cos(r) * scale;\n  out[1] = Math.sin(r) * scale;\n  return out;\n}\n/**\r\n * Transforms the vec2 with a mat2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the vector to transform\r\n * @param {ReadonlyMat2} m matrix to transform with\r\n * @returns {vec2} out\r\n */\n\nexport function transformMat2(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[2] * y;\n  out[1] = m[1] * x + m[3] * y;\n  return out;\n}\n/**\r\n * Transforms the vec2 with a mat2d\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the vector to transform\r\n * @param {ReadonlyMat2d} m matrix to transform with\r\n * @returns {vec2} out\r\n */\n\nexport function transformMat2d(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[2] * y + m[4];\n  out[1] = m[1] * x + m[3] * y + m[5];\n  return out;\n}\n/**\r\n * Transforms the vec2 with a mat3\r\n * 3rd vector component is implicitly '1'\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the vector to transform\r\n * @param {ReadonlyMat3} m matrix to transform with\r\n * @returns {vec2} out\r\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[3] * y + m[6];\n  out[1] = m[1] * x + m[4] * y + m[7];\n  return out;\n}\n/**\r\n * Transforms the vec2 with a mat4\r\n * 3rd vector component is implicitly '0'\r\n * 4th vector component is implicitly '1'\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {ReadonlyVec2} a the vector to transform\r\n * @param {ReadonlyMat4} m matrix to transform with\r\n * @returns {vec2} out\r\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0];\n  var y = a[1];\n  out[0] = m[0] * x + m[4] * y + m[12];\n  out[1] = m[1] * x + m[5] * y + m[13];\n  return out;\n}\n/**\r\n * Rotate a 2D vector\r\n * @param {vec2} out The receiving vec2\r\n * @param {ReadonlyVec2} a The vec2 point to rotate\r\n * @param {ReadonlyVec2} b The origin of the rotation\r\n * @param {Number} rad The angle of rotation in radians\r\n * @returns {vec2} out\r\n */\n\nexport function rotate(out, a, b, rad) {\n  //Translate point to the origin\n  var p0 = a[0] - b[0],\n      p1 = a[1] - b[1],\n      sinC = Math.sin(rad),\n      cosC = Math.cos(rad); //perform rotation and translate to correct position\n\n  out[0] = p0 * cosC - p1 * sinC + b[0];\n  out[1] = p0 * sinC + p1 * cosC + b[1];\n  return out;\n}\n/**\r\n * Get the angle between two 2D vectors\r\n * @param {ReadonlyVec2} a The first operand\r\n * @param {ReadonlyVec2} b The second operand\r\n * @returns {Number} The angle in radians\r\n */\n\nexport function angle(a, b) {\n  var x1 = a[0],\n      y1 = a[1],\n      x2 = b[0],\n      y2 = b[1],\n      // mag is the product of the magnitudes of a and b\n  mag = Math.sqrt(x1 * x1 + y1 * y1) * Math.sqrt(x2 * x2 + y2 * y2),\n      // mag &&.. short circuits if mag == 0\n  cosine = mag && (x1 * x2 + y1 * y2) / mag; // Math.min(Math.max(cosine, -1), 1) clamps the cosine between -1 and 1\n\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\r\n * Set the components of a vec2 to zero\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @returns {vec2} out\r\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  return out;\n}\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {ReadonlyVec2} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\n\nexport function str(a) {\n  return \"vec2(\" + a[0] + \", \" + a[1] + \")\";\n}\n/**\r\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\r\n *\r\n * @param {ReadonlyVec2} a The first vector.\r\n * @param {ReadonlyVec2} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1];\n}\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {ReadonlyVec2} a The first vector.\r\n * @param {ReadonlyVec2} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1];\n  var b0 = b[0],\n      b1 = b[1];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\n}\n/**\r\n * Alias for {@link vec2.length}\r\n * @function\r\n */\n\nexport var len = length;\n/**\r\n * Alias for {@link vec2.subtract}\r\n * @function\r\n */\n\nexport var sub = subtract;\n/**\r\n * Alias for {@link vec2.multiply}\r\n * @function\r\n */\n\nexport var mul = multiply;\n/**\r\n * Alias for {@link vec2.divide}\r\n * @function\r\n */\n\nexport var div = divide;\n/**\r\n * Alias for {@link vec2.distance}\r\n * @function\r\n */\n\nexport var dist = distance;\n/**\r\n * Alias for {@link vec2.squaredDistance}\r\n * @function\r\n */\n\nexport var sqrDist = squaredDistance;\n/**\r\n * Alias for {@link vec2.squaredLength}\r\n * @function\r\n */\n\nexport var sqrLen = squaredLength;\n/**\r\n * Perform some operation over an array of vec2s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 2;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n    }\n\n    return a;\n  };\n}();","import * as glMatrix from \"./common.js\";\n/**\r\n * 4 Dimensional Vector\r\n * @module vec4\r\n */\n\n/**\r\n * Creates a new, empty vec4\r\n *\r\n * @returns {vec4} a new 4D vector\r\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n  }\n\n  return out;\n}\n/**\r\n * Creates a new vec4 initialized with values from an existing vector\r\n *\r\n * @param {ReadonlyVec4} a vector to clone\r\n * @returns {vec4} a new 4D vector\r\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\r\n * Creates a new vec4 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} a new 4D vector\r\n */\n\nexport function fromValues(x, y, z, w) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\r\n * Copy the values from one vec4 to another\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the source vector\r\n * @returns {vec4} out\r\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\r\n * Set the components of a vec4 to the given values\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} out\r\n */\n\nexport function set(out, x, y, z, w) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\r\n * Adds two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  return out;\n}\n/**\r\n * Multiplies two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n/**\r\n * Divides two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  out[3] = a[3] / b[3];\n  return out;\n}\n/**\r\n * Math.ceil the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a vector to ceil\r\n * @returns {vec4} out\r\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  out[3] = Math.ceil(a[3]);\n  return out;\n}\n/**\r\n * Math.floor the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a vector to floor\r\n * @returns {vec4} out\r\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  out[3] = Math.floor(a[3]);\n  return out;\n}\n/**\r\n * Returns the minimum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  out[3] = Math.min(a[3], b[3]);\n  return out;\n}\n/**\r\n * Returns the maximum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {vec4} out\r\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  out[3] = Math.max(a[3], b[3]);\n  return out;\n}\n/**\r\n * Math.round the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a vector to round\r\n * @returns {vec4} out\r\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  out[3] = Math.round(a[3]);\n  return out;\n}\n/**\r\n * Scales a vec4 by a scalar number\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec4} out\r\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  return out;\n}\n/**\r\n * Adds two vec4's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec4} out\r\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  return out;\n}\n/**\r\n * Calculates the euclidian distance between two vec4's\r\n *\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\r\n * Calculates the squared euclidian distance between two vec4's\r\n *\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\r\n * Calculates the length of a vec4\r\n *\r\n * @param {ReadonlyVec4} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\r\n * Calculates the squared length of a vec4\r\n *\r\n * @param {ReadonlyVec4} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\r\n * Negates the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a vector to negate\r\n * @returns {vec4} out\r\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = -a[3];\n  return out;\n}\n/**\r\n * Returns the inverse of the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a vector to invert\r\n * @returns {vec4} out\r\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  out[3] = 1.0 / a[3];\n  return out;\n}\n/**\r\n * Normalize a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a vector to normalize\r\n * @returns {vec4} out\r\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  var len = x * x + y * y + z * z + w * w;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = x * len;\n  out[1] = y * len;\n  out[2] = z * len;\n  out[3] = w * len;\n  return out;\n}\n/**\r\n * Calculates the dot product of two vec4's\r\n *\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n/**\r\n * Returns the cross-product of three vectors in a 4-dimensional space\r\n *\r\n * @param {ReadonlyVec4} result the receiving vector\r\n * @param {ReadonlyVec4} U the first vector\r\n * @param {ReadonlyVec4} V the second vector\r\n * @param {ReadonlyVec4} W the third vector\r\n * @returns {vec4} result\r\n */\n\nexport function cross(out, u, v, w) {\n  var A = v[0] * w[1] - v[1] * w[0],\n      B = v[0] * w[2] - v[2] * w[0],\n      C = v[0] * w[3] - v[3] * w[0],\n      D = v[1] * w[2] - v[2] * w[1],\n      E = v[1] * w[3] - v[3] * w[1],\n      F = v[2] * w[3] - v[3] * w[2];\n  var G = u[0];\n  var H = u[1];\n  var I = u[2];\n  var J = u[3];\n  out[0] = H * F - I * E + J * D;\n  out[1] = -(G * F) + I * C - J * B;\n  out[2] = G * E - H * C + J * A;\n  out[3] = -(G * D) + H * B - I * A;\n  return out;\n}\n/**\r\n * Performs a linear interpolation between two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the first operand\r\n * @param {ReadonlyVec4} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec4} out\r\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  var aw = a[3];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  out[3] = aw + t * (b[3] - aw);\n  return out;\n}\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec4} out\r\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0; // Marsaglia, George. Choosing a Point from the Surface of a\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\n  // http://projecteuclid.org/euclid.aoms/1177692644;\n\n  var v1, v2, v3, v4;\n  var s1, s2;\n\n  do {\n    v1 = glMatrix.RANDOM() * 2 - 1;\n    v2 = glMatrix.RANDOM() * 2 - 1;\n    s1 = v1 * v1 + v2 * v2;\n  } while (s1 >= 1);\n\n  do {\n    v3 = glMatrix.RANDOM() * 2 - 1;\n    v4 = glMatrix.RANDOM() * 2 - 1;\n    s2 = v3 * v3 + v4 * v4;\n  } while (s2 >= 1);\n\n  var d = Math.sqrt((1 - s1) / s2);\n  out[0] = scale * v1;\n  out[1] = scale * v2;\n  out[2] = scale * v3 * d;\n  out[3] = scale * v4 * d;\n  return out;\n}\n/**\r\n * Transforms the vec4 with a mat4.\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the vector to transform\r\n * @param {ReadonlyMat4} m matrix to transform with\r\n * @returns {vec4} out\r\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n  return out;\n}\n/**\r\n * Transforms the vec4 with a quat\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {ReadonlyVec4} a the vector to transform\r\n * @param {ReadonlyQuat} q quaternion to transform with\r\n * @returns {vec4} out\r\n */\n\nexport function transformQuat(out, a, q) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3]; // calculate quat * vec\n\n  var ix = qw * x + qy * z - qz * y;\n  var iy = qw * y + qz * x - qx * z;\n  var iz = qw * z + qx * y - qy * x;\n  var iw = -qx * x - qy * y - qz * z; // calculate result * inverse quat\n\n  out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n  out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n  out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n  out[3] = a[3];\n  return out;\n}\n/**\r\n * Set the components of a vec4 to zero\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @returns {vec4} out\r\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  return out;\n}\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {ReadonlyVec4} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\n\nexport function str(a) {\n  return \"vec4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \")\";\n}\n/**\r\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {ReadonlyVec4} a The first vector.\r\n * @param {ReadonlyVec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {ReadonlyVec4} a The first vector.\r\n * @param {ReadonlyVec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\n}\n/**\r\n * Alias for {@link vec4.subtract}\r\n * @function\r\n */\n\nexport var sub = subtract;\n/**\r\n * Alias for {@link vec4.multiply}\r\n * @function\r\n */\n\nexport var mul = multiply;\n/**\r\n * Alias for {@link vec4.divide}\r\n * @function\r\n */\n\nexport var div = divide;\n/**\r\n * Alias for {@link vec4.distance}\r\n * @function\r\n */\n\nexport var dist = distance;\n/**\r\n * Alias for {@link vec4.squaredDistance}\r\n * @function\r\n */\n\nexport var sqrDist = squaredDistance;\n/**\r\n * Alias for {@link vec4.length}\r\n * @function\r\n */\n\nexport var len = length;\n/**\r\n * Alias for {@link vec4.squaredLength}\r\n * @function\r\n */\n\nexport var sqrLen = squaredLength;\n/**\r\n * Perform some operation over an array of vec4s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 4;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      vec[3] = a[i + 3];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n      a[i + 3] = vec[3];\n    }\n\n    return a;\n  };\n}();","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n"],"sourceRoot":""}